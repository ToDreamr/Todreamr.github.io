<!DOCTYPE html>
<html lang="zh-CN" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-CN" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>SpringCloud 3 &middot; æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ</title>
  <meta name="title" content="SpringCloud 3 &middot; æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" />
  
  <meta name="description" content="A powerful, lightweight theme for Hugo built with Tailwind CSS." />
  
  
  
  <link rel="canonical" href="//localhost:1313/doc/cloud/%E4%BA%8C/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.ac59a1b8eaafef739c129d12787ac29f6a420bcb348c7aeec8949a8d0b7d6c2023766c169d14b9031b751504eb3c976efe786fec135b340a49868acd8caa4127.css"
    integrity="sha512-rFmhuOqv73OcEp0SeHrCn2pCC8s0jHruyJSajQt9bCAjdmwWnRS5Axt1FQTrPJdu/nhv7BNbNApJhorNjKpBJw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.949e93ad68f98f91b41032983a7aee8da40cd845c548ac475ad1b4771bb9d273da1fb4d059d4d2f8f724a6a7ce5962b522b302ed72b43b8a1057a0e4e3ffc58e.js"
    integrity="sha512-lJ6TrWj5j5G0EDKYOnrujaQM2EXFSKxHWtG0dxu50nPaH7TQWdTS&#43;PckpqfOWWK1IrMC7XK0O4oQV6Dk4//Fjg==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:url" content="//localhost:1313/doc/cloud/%E4%BA%8C/">
  <meta property="og:site_name" content="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ">
  <meta property="og:title" content="SpringCloud 3">
  <meta property="og:description" content="å¾®æœåŠ¡åº”ç”¨ #å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†SpringCloudAlibabaçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„æ¶æ„ä½“ç³»å·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œé‚£ä¹ˆæœ¬ç« æˆ‘ä»¬å°†åœ¨åº”ç”¨å±‚é¢ç»§ç»­æ¢è®¨å¾®æœåŠ¡ã€‚
åˆ†å¸ƒå¼æƒé™æ ¡éªŒ #è™½ç„¶å®Œæˆå‰é¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªå·±å»ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒä¸­è§„ä¸­çŸ©çš„å¾®æœåŠ¡é¡¹ç›®äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬æ²¡æœ‰è§£å†³ï¼Œç™»å½•é—®é¢˜ã€‚å‡å¦‚ç°åœ¨è¦æ±‚ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œå›¾ä¹¦çš„æŸ¥è¯¢ã€å€Ÿé˜…ç­‰æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•è®¾è®¡è¿™ä¸ªç³»ç»Ÿå‘¢ï¼Ÿ
å›é¡¾æˆ‘ä»¬ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒçš„åŸç†ï¼ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•åˆ¤å®šä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„å‘¢ï¼Ÿ
é¦–å…ˆæµè§ˆå™¨ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ã€‚ æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸€ä¸ªSESSION IDï¼Œå¹¶æš‚æ—¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç„¶åä¼šå‘é€ç»™æµè§ˆå™¨ä½œä¸ºCookieä¿å­˜ã€‚ ä¹‹åæµè§ˆå™¨ä¼šä¸€ç›´æºå¸¦æ­¤Cookieè®¿é—®æœåŠ¡å™¨ï¼Œè¿™æ ·åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±èƒ½æ ¹æ®æºå¸¦çš„Cookieä¸­çš„SESSION IDåˆ¤æ–­æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚ è¿™æ ·æœåŠ¡ç«¯å’Œæµè§ˆå™¨ä¹‹é—´å¯ä»¥è½»æ¾åœ°å»ºç«‹ä¼šè¯äº†ã€‚ ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨é‡‡ç”¨çš„æ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æœåŠ¡è¿›è¡Œç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚å›¾ä¹¦æœåŠ¡å’Œå€Ÿé˜…æœåŠ¡ï¼Œå®ƒä»¬ä¼šçŸ¥é“ç”¨æˆ·ç™»å½•äº†å—ï¼Ÿ
å®é™…ä¸Šæˆ‘ä»¬ç™»å½•åˆ°ç”¨æˆ·æœåŠ¡ä¹‹åï¼ŒSessionä¸­çš„ç”¨æˆ·æ•°æ®åªä¼šåœ¨ç”¨æˆ·æœåŠ¡çš„åº”ç”¨ä¸­ä¿å­˜ï¼Œè€Œåœ¨å…¶ä»–æœåŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½èƒ½å¤ŸåŒæ­¥è¿™äº›Sessionä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å®ç°åœ¨ç”¨æˆ·æœåŠ¡ç™»å½•ä¹‹åå…¶ä»–æœåŠ¡éƒ½èƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°Sessionçš„åŒæ­¥å‘¢ï¼Ÿ
æˆ‘ä»¬å¯ä»¥åœ¨æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤åˆ¶ä¸€ä»½Sessionï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ï¼Œå¹¶ä¸”ç”¨æˆ·éªŒè¯æ•°æ®å ç”¨çš„å†…å­˜ä¼šæˆå€çš„å¢åŠ ã€‚ å°†Sessionç§»å‡ºæœåŠ¡å™¨ï¼Œç”¨ç»Ÿä¸€å­˜å‚¨æ¥å­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Redisæˆ–æ˜¯MySQLä¸­å­˜æ”¾ç”¨æˆ·çš„Sessionä¿¡æ¯ï¼Œè¿™æ ·æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨éœ€è¦è·å–Sessionä¿¡æ¯æ—¶ï¼Œç»Ÿä¸€è®¿é—®Redisæˆ–æ˜¯MySQLå³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥åŒæ­¥Sessionäº†ï¼ˆæ˜¯ä¸æ˜¯è¶Šæ¥è¶Šæ„Ÿè§‰åªè¦æœ‰é—®é¢˜ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´ä»¶è§£å†³ä¸äº†çš„ï¼‰ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç€é‡æ¥ç ”ç©¶ä¸€ä¸‹ï¼Œç„¶åå®ç°2å·æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨Redisä½œä¸ºSessionç»Ÿä¸€å­˜å‚¨ï¼Œæˆ‘ä»¬æŠŠä¸€å¼€å§‹çš„å‹ç¼©åŒ…é‡æ–°è§£å‹ä¸€æ¬¡ï¼Œåˆæ¥ä»å¤´å¼€å§‹ç¼–å†™å§ã€‚
è¿™é‡Œæˆ‘ä»¬å°±åªä½¿ç”¨Nacoså°±è¡Œäº†ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠNacosçš„åŒ…å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œä¸€äº›é…ç½®ï¼š
ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡éƒ½æ·»åŠ éªŒè¯æœºåˆ¶ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š
&lt;!-- SpringSession Redisæ”¯æŒ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.session&lt;/groupId&gt; &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- æ·»åŠ Redisçš„Starter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="doc">
    <meta property="og:image" content="//localhost:1313/doc/cloud/%E4%BA%8C/featured.jpeg">
      <meta property="og:see_also" content="//localhost:1313/doc/cloud/%E4%B8%80/">
      <meta property="og:see_also" content="//localhost:1313/doc/cloud/%E4%B8%89/">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//localhost:1313/doc/cloud/%E4%BA%8C/featured.jpeg">
  <meta name="twitter:title" content="SpringCloud 3">
  <meta name="twitter:description" content="å¾®æœåŠ¡åº”ç”¨ #å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†SpringCloudAlibabaçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„æ¶æ„ä½“ç³»å·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œé‚£ä¹ˆæœ¬ç« æˆ‘ä»¬å°†åœ¨åº”ç”¨å±‚é¢ç»§ç»­æ¢è®¨å¾®æœåŠ¡ã€‚
åˆ†å¸ƒå¼æƒé™æ ¡éªŒ #è™½ç„¶å®Œæˆå‰é¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªå·±å»ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒä¸­è§„ä¸­çŸ©çš„å¾®æœåŠ¡é¡¹ç›®äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬æ²¡æœ‰è§£å†³ï¼Œç™»å½•é—®é¢˜ã€‚å‡å¦‚ç°åœ¨è¦æ±‚ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œå›¾ä¹¦çš„æŸ¥è¯¢ã€å€Ÿé˜…ç­‰æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•è®¾è®¡è¿™ä¸ªç³»ç»Ÿå‘¢ï¼Ÿ
å›é¡¾æˆ‘ä»¬ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒçš„åŸç†ï¼ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•åˆ¤å®šä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„å‘¢ï¼Ÿ
é¦–å…ˆæµè§ˆå™¨ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ã€‚ æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸€ä¸ªSESSION IDï¼Œå¹¶æš‚æ—¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç„¶åä¼šå‘é€ç»™æµè§ˆå™¨ä½œä¸ºCookieä¿å­˜ã€‚ ä¹‹åæµè§ˆå™¨ä¼šä¸€ç›´æºå¸¦æ­¤Cookieè®¿é—®æœåŠ¡å™¨ï¼Œè¿™æ ·åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±èƒ½æ ¹æ®æºå¸¦çš„Cookieä¸­çš„SESSION IDåˆ¤æ–­æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚ è¿™æ ·æœåŠ¡ç«¯å’Œæµè§ˆå™¨ä¹‹é—´å¯ä»¥è½»æ¾åœ°å»ºç«‹ä¼šè¯äº†ã€‚ ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨é‡‡ç”¨çš„æ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æœåŠ¡è¿›è¡Œç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚å›¾ä¹¦æœåŠ¡å’Œå€Ÿé˜…æœåŠ¡ï¼Œå®ƒä»¬ä¼šçŸ¥é“ç”¨æˆ·ç™»å½•äº†å—ï¼Ÿ
å®é™…ä¸Šæˆ‘ä»¬ç™»å½•åˆ°ç”¨æˆ·æœåŠ¡ä¹‹åï¼ŒSessionä¸­çš„ç”¨æˆ·æ•°æ®åªä¼šåœ¨ç”¨æˆ·æœåŠ¡çš„åº”ç”¨ä¸­ä¿å­˜ï¼Œè€Œåœ¨å…¶ä»–æœåŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½èƒ½å¤ŸåŒæ­¥è¿™äº›Sessionä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å®ç°åœ¨ç”¨æˆ·æœåŠ¡ç™»å½•ä¹‹åå…¶ä»–æœåŠ¡éƒ½èƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°Sessionçš„åŒæ­¥å‘¢ï¼Ÿ
æˆ‘ä»¬å¯ä»¥åœ¨æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤åˆ¶ä¸€ä»½Sessionï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ï¼Œå¹¶ä¸”ç”¨æˆ·éªŒè¯æ•°æ®å ç”¨çš„å†…å­˜ä¼šæˆå€çš„å¢åŠ ã€‚ å°†Sessionç§»å‡ºæœåŠ¡å™¨ï¼Œç”¨ç»Ÿä¸€å­˜å‚¨æ¥å­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Redisæˆ–æ˜¯MySQLä¸­å­˜æ”¾ç”¨æˆ·çš„Sessionä¿¡æ¯ï¼Œè¿™æ ·æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨éœ€è¦è·å–Sessionä¿¡æ¯æ—¶ï¼Œç»Ÿä¸€è®¿é—®Redisæˆ–æ˜¯MySQLå³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥åŒæ­¥Sessionäº†ï¼ˆæ˜¯ä¸æ˜¯è¶Šæ¥è¶Šæ„Ÿè§‰åªè¦æœ‰é—®é¢˜ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´ä»¶è§£å†³ä¸äº†çš„ï¼‰ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç€é‡æ¥ç ”ç©¶ä¸€ä¸‹ï¼Œç„¶åå®ç°2å·æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨Redisä½œä¸ºSessionç»Ÿä¸€å­˜å‚¨ï¼Œæˆ‘ä»¬æŠŠä¸€å¼€å§‹çš„å‹ç¼©åŒ…é‡æ–°è§£å‹ä¸€æ¬¡ï¼Œåˆæ¥ä»å¤´å¼€å§‹ç¼–å†™å§ã€‚
è¿™é‡Œæˆ‘ä»¬å°±åªä½¿ç”¨Nacoså°±è¡Œäº†ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠNacosçš„åŒ…å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œä¸€äº›é…ç½®ï¼š
ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡éƒ½æ·»åŠ éªŒè¯æœºåˆ¶ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š
&lt;!-- SpringSession Redisæ”¯æŒ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.session&lt;/groupId&gt; &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- æ·»åŠ Redisçš„Starter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Docs",
    "name": "SpringCloud 3",
    "headline": "SpringCloud 3",
    
    "abstract": "å¾®æœåŠ¡åº”ç”¨ #\rå‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†SpringCloudAlibabaçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„æ¶æ„ä½“ç³»å·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œé‚£ä¹ˆæœ¬ç« æˆ‘ä»¬å°†åœ¨åº”ç”¨å±‚é¢ç»§ç»­æ¢è®¨å¾®æœåŠ¡ã€‚\nåˆ†å¸ƒå¼æƒé™æ ¡éªŒ #\rè™½ç„¶å®Œæˆå‰é¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªå·±å»ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒä¸­è§„ä¸­çŸ©çš„å¾®æœåŠ¡é¡¹ç›®äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬æ²¡æœ‰è§£å†³ï¼Œç™»å½•é—®é¢˜ã€‚å‡å¦‚ç°åœ¨è¦æ±‚ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œå›¾ä¹¦çš„æŸ¥è¯¢ã€å€Ÿé˜…ç­‰æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•è®¾è®¡è¿™ä¸ªç³»ç»Ÿå‘¢ï¼Ÿ\nå›é¡¾æˆ‘ä»¬ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒçš„åŸç†ï¼ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•åˆ¤å®šä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„å‘¢ï¼Ÿ\né¦–å…ˆæµè§ˆå™¨ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ã€‚ æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸€ä¸ªSESSION IDï¼Œå¹¶æš‚æ—¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç„¶åä¼šå‘é€ç»™æµè§ˆå™¨ä½œä¸ºCookieä¿å­˜ã€‚ ä¹‹åæµè§ˆå™¨ä¼šä¸€ç›´æºå¸¦æ­¤Cookieè®¿é—®æœåŠ¡å™¨ï¼Œè¿™æ ·åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±èƒ½æ ¹æ®æºå¸¦çš„Cookieä¸­çš„SESSION IDåˆ¤æ–­æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚ è¿™æ ·æœåŠ¡ç«¯å’Œæµè§ˆå™¨ä¹‹é—´å¯ä»¥è½»æ¾åœ°å»ºç«‹ä¼šè¯äº†ã€‚ ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨é‡‡ç”¨çš„æ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æœåŠ¡è¿›è¡Œç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚å›¾ä¹¦æœåŠ¡å’Œå€Ÿé˜…æœåŠ¡ï¼Œå®ƒä»¬ä¼šçŸ¥é“ç”¨æˆ·ç™»å½•äº†å—ï¼Ÿ\nå®é™…ä¸Šæˆ‘ä»¬ç™»å½•åˆ°ç”¨æˆ·æœåŠ¡ä¹‹åï¼ŒSessionä¸­çš„ç”¨æˆ·æ•°æ®åªä¼šåœ¨ç”¨æˆ·æœåŠ¡çš„åº”ç”¨ä¸­ä¿å­˜ï¼Œè€Œåœ¨å…¶ä»–æœåŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½èƒ½å¤ŸåŒæ­¥è¿™äº›Sessionä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å®ç°åœ¨ç”¨æˆ·æœåŠ¡ç™»å½•ä¹‹åå…¶ä»–æœåŠ¡éƒ½èƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°Sessionçš„åŒæ­¥å‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥åœ¨æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤åˆ¶ä¸€ä»½Sessionï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ï¼Œå¹¶ä¸”ç”¨æˆ·éªŒè¯æ•°æ®å ç”¨çš„å†…å­˜ä¼šæˆå€çš„å¢åŠ ã€‚ å°†Sessionç§»å‡ºæœåŠ¡å™¨ï¼Œç”¨ç»Ÿä¸€å­˜å‚¨æ¥å­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Redisæˆ–æ˜¯MySQLä¸­å­˜æ”¾ç”¨æˆ·çš„Sessionä¿¡æ¯ï¼Œè¿™æ ·æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨éœ€è¦è·å–Sessionä¿¡æ¯æ—¶ï¼Œç»Ÿä¸€è®¿é—®Redisæˆ–æ˜¯MySQLå³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥åŒæ­¥Sessionäº†ï¼ˆæ˜¯ä¸æ˜¯è¶Šæ¥è¶Šæ„Ÿè§‰åªè¦æœ‰é—®é¢˜ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´ä»¶è§£å†³ä¸äº†çš„ï¼‰ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç€é‡æ¥ç ”ç©¶ä¸€ä¸‹ï¼Œç„¶åå®ç°2å·æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨Redisä½œä¸ºSessionç»Ÿä¸€å­˜å‚¨ï¼Œæˆ‘ä»¬æŠŠä¸€å¼€å§‹çš„å‹ç¼©åŒ…é‡æ–°è§£å‹ä¸€æ¬¡ï¼Œåˆæ¥ä»å¤´å¼€å§‹ç¼–å†™å§ã€‚\nè¿™é‡Œæˆ‘ä»¬å°±åªä½¿ç”¨Nacoså°±è¡Œäº†ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠNacosçš„åŒ…å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œä¸€äº›é…ç½®ï¼š\nç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡éƒ½æ·»åŠ éªŒè¯æœºåˆ¶ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š\n\u0026lt;!-- SpringSession Redisæ”¯æŒ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.session\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-session-data-redis\u0026lt;\/artifactId\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;!-- æ·»åŠ Redisçš„Starter --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.",
    "inLanguage": "zh-CN",
    "url" : "\/\/localhost:1313\/doc\/cloud\/%E4%BA%8C\/",
    "author" : {
      "@type": "Person",
      "name": "æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "2108"
  }]
  </script>


  
  
  <meta name="author" content="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" />
  
  
  
  <link href="https://space.bilibili.com/159283119?spm_id_from=333.1007.0.0" rel="me" />
  
  
  <link href="https://github.com/ToDreamr" rel="me" />
  
  
  <link href="mailto:aruixrain@gmail.com" rel="me" />
  
  
  <link href="https://music.163.com/#/user/home?id=568083850" rel="me" />
  
  
  <link href="https://gitee.com/rainyheights" rel="me" />
  
  
  <link href="https://www.zhihu.com/people/san-qiu-luo-yue" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-PEDMYR1V0K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PEDMYR1V0K');
</script>


  
  
  <meta name="theme-color"/>

  
  

  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade"></head>


<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>è·³åˆ°æ–‡ç« å¼€å¤´</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div id="top-menu" style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px ;height: 70px;font-family: åæ–‡ä¸­å®‹,serif;"
     class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3" >
  
  
  
  <div>
    <a href="/" class="flex">
    <span class="sr-only">æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ</span>

    <img src="/img/author.png" width="16" height="16"
         class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" />

    </a>
  </div>
  

  <div class="flex flex-1 items-center justify-between">

    <nav class="flex space-x-3">

      
      <a id="title-href" href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ</a>
      

    </nav>
    <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

      
      
      
  <a href="/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        é¦–é¡µ
    </p>
</a>


      
      
  <a href="/all/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        å…¨éƒ¨
    </p>
</a>


      
      
  <a href="/algorithm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        ç®—æ³•
    </p>
</a>


      
      
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        å½’ç±»
    </p>
</a>


      
      
  <a href="/friend/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        å‹é“¾ğŸ§‘â€ğŸ¤â€ğŸ§‘
    </p>
</a>


      
       
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      æ›´å¤šğŸ˜º
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/media/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç”µå½±ğŸ¥
          </p>
        </a>
        
        <a href="/life-about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç”Ÿæ´»ç›¸å…³ğŸŒ¿
          </p>
        </a>
        
        <a href="/music/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            éŸ³ä¹ğŸµ
          </p>
        </a>
        
        <a href="/%E7%AC%94%E8%AE%B0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç¬”è®°(æ¯”è¾ƒä¹±)ğŸ¦
          </p>
        </a>
        
        <a href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç¼–ç¨‹è¯­è¨€ğŸ’»
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



      
      

      


      
      <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12"
              title="">
      

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


      </button>

      


      
      
      <div
              class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400">
        <button id="appearance-switcher" aria-label="Dark mode switcher" type="button">
          <div class="flex items-center justify-center h-12 dark:hidden">
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


          </div>
          <div class="items-center justify-center hidden h-12 dark:flex">
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


          </div>
        </button>

      </div>
      

    </nav>
    <div class="flex md:hidden items-center space-x-5 md:ml-12">

      <span></span>

      


      
      <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="">
      

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


      </button>
      

      
      
      <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" style="margin-right:5px">
        <div class="flex items-center justify-center h-12 dark:hidden">
          

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


        </div>
        <div class="items-center justify-center hidden h-12 dark:flex">
          

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


        </div>
      </button>
      

    </div>

  </div>
  <div class="-my-2 -mr-2 md:hidden">

    <label id="menu-button" for="menu-controller" class="block">
      <input type="checkbox" id="menu-controller" class="hidden" />
      
      <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


      </div>
      <div id="menu-wrapper" style="padding-top:5px;"
           class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
        <ul
                class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

          <li>
                        <span
                                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
          </li>

          

          
  <li class="mt-1">
    <a href="/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            é¦–é¡µ
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/all/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            å…¨éƒ¨
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/algorithm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            ç®—æ³•
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            å½’ç±»
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/friend/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            å‹é“¾ğŸ§‘â€ğŸ¤â€ğŸ§‘
        </p>
    </a>
</li>



          

           
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            æ›´å¤šğŸ˜º
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/media/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç”µå½±ğŸ¥
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/life-about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç”Ÿæ´»ç›¸å…³ğŸŒ¿
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/music/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            éŸ³ä¹ğŸµ
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/%E7%AC%94%E8%AE%B0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç¬”è®°(æ¯”è¾ƒä¹±)ğŸ¦
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç¼–ç¨‹è¯­è¨€ğŸ’»
        </p>
    </a>
</li>

<li class="mb-2"></li>



          

        </ul>
        
        

      </div>
    </label>
  </div>






  </div>
<style>
  .change-music{
    margin-top: 20px;
    width: 8%;
    height: 50%;
    font-family: åæ–‡ä¸­å®‹,serif;
     
     
     
  }
</style>
<script>
  
  var MusicLists=[];
  var musicUrl="";
  function getMusicList()
  {
    
    MusicLists.push
    (29567192,1974443814,447926067,447925058,1974444808,
            1974444807,29567187
    );
    var musicIndex=Math.floor(Math.random()*MusicLists.length+1);
    console.log(musicIndex);
    
    musicUrl="https://music.163.com/outchain/player?type=2&id="+MusicLists[musicIndex]+"&auto=1&height=66";
    var frame=document.getElementById("music");
    var player=document.getElementsByName('player');
    console.log(player);
    frame.src=musicUrl;
  }
</script>






<script>
  (function () {
    var $mainmenu = $('.main-menu');
    var path = window.location.pathname;
    $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
      $(e).children('p').addClass('active');
    });
  })();
  
  (function (){
    var title=document.getElementById('title-href');
    var music=document.getElementById('music');
    var button=document.getElementById('music-button');
    var width=window.innerWidth;
    var height=window.innerHeight;
    if (width<420||height<820){
      title.innerText='Rainy-Heights'
      button.innerText='';
      music.style.width=0;
      music.style.height=0;
      button.style.height=0;
      button.style.height=0;
      var child = document.getElementById('music-div');
      var father = document.getElementById('top-menu');
      father.removeChild(child)
      father.removeChild(button)
    }
  })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
    
    
    
    
    
    


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/doc/cloud/%E4%BA%8C/featured_hu12660636931170872844.jpeg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

    
    

    <header id="single_header" class="mt-5 max-w-prose">
        
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      ></a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/doc/"
      >Docs</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/doc/cloud/%E4%BA%8C/"
      >SpringCloud 3</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


        
        <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral" style="font-family: åæ–‡ä¸­å®‹,serif">
            SpringCloud 3
        </h1>
        <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
            





  
  







  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">10 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



        </div>

        
        
        
        
        

        
        
        
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" src="/img/%E4%B8%89%E5%8F%B6_hu18175999898255885363.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      ä½œè€…
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">é‡æ¹–å ğª©˜æ¸…å˜‰ã€‚æœ‰ä¸‰ç§‹æ¡‚å­ï¼Œåé‡Œè·èŠ±ã€‚ç¾Œç®¡å¼„æ™´ï¼Œè±æ­Œæ³›å¤œï¼Œå¬‰å¬‰é’“åŸè²å¨ƒã€‚åƒéª‘æ‹¥é«˜ç‰™ã€‚ä¹˜é†‰å¬ç®«é¼“ï¼ŒåŸèµçƒŸéœã€‚å¼‚æ—¥å›¾å°†å¥½æ™¯ï¼Œå½’å»å‡¤æ± å¤¸ã€‚</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://space.bilibili.com/159283119?spm_id_from=333.1007.0.0"
          target="_blank"
          aria-label="Bilibili"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1699377062375" class="icon" viewBox="0 0 1129 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4167" xmlns:xlink="http://www.w3.org/1999/xlink" width="220.5078125" height="200"><path d="M234.909 9.656a80.468 80.468 0 0 1 68.398 0 167.374 167.374 0 0 1 41.843 30.578l160.937 140.82h115.07l160.936-140.82a168.983 168.983 0 0 1 41.843-30.578A80.468 80.468 0 0 1 930.96 76.445a80.468 80.468 0 0 1-17.703 53.914 449.818 449.818 0 0 1-35.406 32.187 232.553 232.553 0 0 1-22.531 18.508h100.585a170.593 170.593 0 0 1 118.289 53.109 171.397 171.397 0 0 1 53.914 118.288v462.693a325.897 325.897 0 0 1-4.024 70.007 178.64 178.64 0 0 1-80.468 112.656 173.007 173.007 0 0 1-92.539 25.75h-738.7a341.186 341.186 0 0 1-72.421-4.024A177.835 177.835 0 0 1 28.91 939.065a172.202 172.202 0 0 1-27.36-92.539V388.662a360.498 360.498 0 0 1 0-66.789A177.03 177.03 0 0 1 162.487 178.64h105.414c-16.899-12.07-31.383-26.555-46.672-39.43a80.468 80.468 0 0 1-25.75-65.984 80.468 80.468 0 0 1 39.43-63.57M216.4 321.873a80.468 80.468 0 0 0-63.57 57.937 108.632 108.632 0 0 0 0 30.578v380.615a80.468 80.468 0 0 0 55.523 80.469 106.218 106.218 0 0 0 34.601 5.632h654.208a80.468 80.468 0 0 0 76.444-47.476 112.656 112.656 0 0 0 8.047-53.109v-354.06a135.187 135.187 0 0 0 0-38.625 80.468 80.468 0 0 0-52.304-54.719 129.554 129.554 0 0 0-49.89-7.242H254.22a268.764 268.764 0 0 0-37.82 0z m0 0" fill="#20B0E3" p-id="4168"></path><path d="M348.369 447.404a80.468 80.468 0 0 1 55.523 18.507 80.468 80.468 0 0 1 28.164 59.547v80.468a80.468 80.468 0 0 1-16.094 51.5 80.468 80.468 0 0 1-131.968-9.656 104.609 104.609 0 0 1-10.46-54.719v-80.468a80.468 80.468 0 0 1 70.007-67.593z m416.02 0a80.468 80.468 0 0 1 86.102 75.64v80.468a94.148 94.148 0 0 1-12.07 53.11 80.468 80.468 0 0 1-132.773 0 95.757 95.757 0 0 1-12.875-57.133V519.02a80.468 80.468 0 0 1 70.007-70.812z m0 0" fill="#20B0E3" p-id="4169"></path></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/ToDreamr"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:aruixrain@gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://music.163.com/#/user/home?id=568083850"
          target="_blank"
          aria-label="Wangyi"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1707154946293" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2586" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M0 0m184.32 0l655.36 0q184.32 0 184.32 184.32l0 655.36q0 184.32-184.32 184.32l-655.36 0q-184.32 0-184.32-184.32l0-655.36q0-184.32 184.32-184.32Z" fill="#EA3E3C" p-id="2587"></path><path d="M527.616 849.43872a373.6064 373.6064 0 0 1-162.54976-39.00416c-112.36352-55.16288-180.00896-176.29184-172.55424-308.67456 7.41376-130.34496 85.10464-237.4656 202.752-279.552a35.85024 35.85024 0 0 1 24.15616 67.51232c-107.66336 38.49216-150.81472 136.86784-155.29984 216.13568-5.86752 103.51616 46.08 197.79584 132.34176 240.13824 124.69248 60.30336 216.91392 22.35392 260.82304-5.64224 59.8016-38.16448 97.86368-100.01408 96.95232-157.55264-1.024-63.72352-24.064-120.99584-63.27296-157.14304a145.408 145.408 0 0 0-65.5872-35.28704q2.82624 9.76896 5.64224 19.32288c13.38368 45.63968 24.94464 85.05344 25.6 114.40128a134.26688 134.26688 0 0 1-37.69344 97.76128 139.1104 139.1104 0 0 1-100.6592 40.45824 140.10368 140.10368 0 0 1-100.47488-42.24 169.12384 169.12384 0 0 1-46.2848-122.76736c1.19808-85.12512 80.11776-153.28256 162.816-175.104a324.80256 324.80256 0 0 1-6.71744-67.05152 92.0576 92.0576 0 0 1 69.18144-91.81184c46.21312-12.53376 104.448 5.19168 124.66176 37.888a35.84 35.84 0 0 1-11.70432 49.31584 35.84 35.84 0 0 1-49.26464-11.65312 62.34112 62.34112 0 0 0-48.45568-5.21216c-4.32128 1.71008-12.35968 4.90496-12.76928 23.10144a270.87872 270.87872 0 0 0 6.73792 58.51136 217.4976 217.4976 0 0 1 133.56032 57.6512c53.57568 49.38752 85.0432 125.46048 86.35392 208.71168 1.29024 81.85856-49.7664 167.86432-130.048 219.136a310.14912 310.14912 0 0 1-168.2432 48.65024z m23.6544-457.55392c-56.77056 15.6672-107.4688 63.03744-108.07296 106.42432a98.304 98.304 0 0 0 25.6512 71.43424 68.0448 68.0448 0 0 0 49.36704 20.87936 67.24608 67.24608 0 0 0 49.44896-18.944 63.19104 63.19104 0 0 0 17.23392-46.08c-0.4096-19.79392-11.7248-58.368-22.67136-95.6928-3.61472-12.42112-7.35232-25.14944-10.9568-38.02112z" fill="#FFFFFF" p-id="2588"></path></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://gitee.com/rainyheights"
          target="_blank"
          aria-label="Gitee"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1714489642084" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6457" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M512 960A448 448 0 1 1 512 64a448 448 0 0 1 0 896z m226.752-497.792H484.352a22.144 22.144 0 0 0-22.144 22.144v55.296c0 12.224 9.92 22.144 22.08 22.144h154.88c12.288 0 22.144 9.92 22.144 22.08v11.072c0 36.672-29.696 66.368-66.368 66.368H384.768a22.144 22.144 0 0 1-22.08-22.08V429.056c0-36.672 29.696-66.368 66.304-66.368h309.76c12.16 0 22.08-9.92 22.08-22.144v-55.296a22.144 22.144 0 0 0-22.08-22.144h-309.76a165.888 165.888 0 0 0-165.888 165.952v309.696c0 12.224 9.92 22.144 22.144 22.144h326.272a149.312 149.312 0 0 0 149.376-149.312V484.352a22.144 22.144 0 0 0-22.144-22.144z" fill="#C71D23" p-id="6458"></path></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.zhihu.com/people/san-qiu-luo-yue"
          target="_blank"
          aria-label="Zhihu"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1707288662942" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5244" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M564.7 230.1V803h60l25.2 71.4L756.3 803h131.5V230.1H564.7z m247.7 497h-59.9l-75.1 50.4-17.8-50.4h-18V308.3h170.7v418.8zM526.1 486.9H393.3c2.1-44.9 4.3-104.3 6.6-172.9h130.9l-0.1-8.1c0-0.6-0.2-14.7-2.3-29.1-2.1-15-6.6-34.9-21-34.9H287.8c4.4-20.6 15.7-69.7 29.4-93.8l6.4-11.2-12.9-0.7c-0.8 0-19.6-0.9-41.4 10.6-35.7 19-51.7 56.4-58.7 84.4-18.4 73.1-44.6 123.9-55.7 145.6-3.3 6.4-5.3 10.2-6.2 12.8-1.8 4.9-0.8 9.8 2.8 13 10.5 9.5 38.2-2.9 38.5-3 0.6-0.3 1.3-0.6 2.2-1 13.9-6.3 55.1-25 69.8-84.5h56.7c0.7 32.2 3.1 138.4 2.9 172.9h-141l-2.1 1.5c-23.1 16.9-30.5 63.2-30.8 65.2l-1.4 9.2h167c-12.3 78.3-26.5 113.4-34 127.4-3.7 7-7.3 14-10.7 20.8-21.3 42.2-43.4 85.8-126.3 153.6-3.6 2.8-7 8-4.8 13.7 2.4 6.3 9.3 9.1 24.6 9.1 5.4 0 11.8-0.3 19.4-1 49.9-4.4 100.8-18 135.1-87.6 17-35.1 31.7-71.7 43.9-108.9L497 850l5-12c0.8-1.9 19-46.3 5.1-95.9l-0.5-1.8-108.1-123-22 16.6c6.4-26.1 10.6-49.9 12.5-71.1h158.7v-8c0-40.1-18.5-63.9-19.2-64.9l-2.4-3z" fill="#1296DB" p-id="5245"></path></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

        

        

        

        
        <div class="mb-5"></div>
        

    </header>

    
    
    <div  class="meta-item">&nbspÂ·&nbsp
        <span id="busuanzi_container_page_pv">é¡µé¢ç‚¹å‡»é‡:<span id="busuanzi_value_page_pv"></span>æ¬¡</span>
    </div>


    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row" style="font-family: åæ–‡ä¸­å®‹,serif">

        
        <div style="width: 28%" class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
            <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

             <details open class="toc-right mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    ç›®å½•
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#å¾®æœåŠ¡åº”ç”¨">å¾®æœåŠ¡åº”ç”¨</a>
      <ul>
        <li><a href="#åˆ†å¸ƒå¼æƒé™æ ¡éªŒ">åˆ†å¸ƒå¼æƒé™æ ¡éªŒ</a></li>
        <li><a href="#oauth-20-å®ç°å•ç‚¹ç™»å½•">OAuth 2.0 å®ç°å•ç‚¹ç™»å½•</a>
          <ul>
            <li><a href="#å››ç§æˆæƒæ¨¡å¼">å››ç§æˆæƒæ¨¡å¼</a></li>
            <li><a href="#æ­å»ºéªŒè¯æœåŠ¡å™¨">æ­å»ºéªŒè¯æœåŠ¡å™¨</a></li>
            <li><a href="#åŸºäºenableoauth2ssoå®ç°">åŸºäº@EnableOAuth2Ssoå®ç°</a></li>
            <li><a href="#åŸºäºenableresourceserverå®ç°">åŸºäº@EnableResourceServerå®ç°</a></li>
            <li><a href="#ä½¿ç”¨jwtå­˜å‚¨token">ä½¿ç”¨jwtå­˜å‚¨Token</a></li>
          </ul>
        </li>
        <li><a href="#redisä¸åˆ†å¸ƒå¼">Redisä¸åˆ†å¸ƒå¼</a>
          <ul>
            <li><a href="#ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</a></li>
            <li><a href="#å“¨å…µæ¨¡å¼">å“¨å…µæ¨¡å¼</a></li>
            <li><a href="#é›†ç¾¤æ­å»º">é›†ç¾¤æ­å»º</a></li>
            <li><a href="#åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</a></li>
          </ul>
        </li>
        <li><a href="#mysqlä¸åˆ†å¸ƒå¼">MySQLä¸åˆ†å¸ƒå¼</a>
          <ul>
            <li><a href="#ä¸»ä»å¤åˆ¶-1">ä¸»ä»å¤åˆ¶</a></li>
            <li><a href="#åˆ†åº“åˆ†è¡¨">åˆ†åº“åˆ†è¡¨</a></li>
            <li><a href="#sharding-jdbc">Sharding JDBC</a></li>
            <li><a href="#åˆ†å¸ƒå¼åºåˆ—ç®—æ³•">åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</a></li>
            <li><a href="#è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    ç›®å½•
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#å¾®æœåŠ¡åº”ç”¨">å¾®æœåŠ¡åº”ç”¨</a>
      <ul>
        <li><a href="#åˆ†å¸ƒå¼æƒé™æ ¡éªŒ">åˆ†å¸ƒå¼æƒé™æ ¡éªŒ</a></li>
        <li><a href="#oauth-20-å®ç°å•ç‚¹ç™»å½•">OAuth 2.0 å®ç°å•ç‚¹ç™»å½•</a>
          <ul>
            <li><a href="#å››ç§æˆæƒæ¨¡å¼">å››ç§æˆæƒæ¨¡å¼</a></li>
            <li><a href="#æ­å»ºéªŒè¯æœåŠ¡å™¨">æ­å»ºéªŒè¯æœåŠ¡å™¨</a></li>
            <li><a href="#åŸºäºenableoauth2ssoå®ç°">åŸºäº@EnableOAuth2Ssoå®ç°</a></li>
            <li><a href="#åŸºäºenableresourceserverå®ç°">åŸºäº@EnableResourceServerå®ç°</a></li>
            <li><a href="#ä½¿ç”¨jwtå­˜å‚¨token">ä½¿ç”¨jwtå­˜å‚¨Token</a></li>
          </ul>
        </li>
        <li><a href="#redisä¸åˆ†å¸ƒå¼">Redisä¸åˆ†å¸ƒå¼</a>
          <ul>
            <li><a href="#ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</a></li>
            <li><a href="#å“¨å…µæ¨¡å¼">å“¨å…µæ¨¡å¼</a></li>
            <li><a href="#é›†ç¾¤æ­å»º">é›†ç¾¤æ­å»º</a></li>
            <li><a href="#åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</a></li>
          </ul>
        </li>
        <li><a href="#mysqlä¸åˆ†å¸ƒå¼">MySQLä¸åˆ†å¸ƒå¼</a>
          <ul>
            <li><a href="#ä¸»ä»å¤åˆ¶-1">ä¸»ä»å¤åˆ¶</a></li>
            <li><a href="#åˆ†åº“åˆ†è¡¨">åˆ†åº“åˆ†è¡¨</a></li>
            <li><a href="#sharding-jdbc">Sharding JDBC</a></li>
            <li><a href="#åˆ†å¸ƒå¼åºåˆ—ç®—æ³•">åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</a></li>
            <li><a href="#è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

 
<script>
  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = e.attr('id');
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();
</script>
  
        </div>
        </div>
        

        
        <div class="min-w-0 min-h-0 max-w-fit" style="width: 100%">
            
<details style="margin-left:0px" class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5"  open >
    
    <summary
        class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">
        cloud - è¿™æ˜¯ç³»åˆ—æ–‡ç« ä¹‹ä¸€.
    </summary>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%B8%80/">
            éƒ¨åˆ† 1: SpringCloud 1
        </a>
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%B8%89/">
            éƒ¨åˆ† 2: SpringCloud 2
        </a>
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        éƒ¨åˆ† 3: æœ¬æ–‡
    </div>
    
    


</details>



            <div class="article-content max-w-prose mb-20">
                

<h1 class="relative group">å¾®æœåŠ¡åº”ç”¨ 
    <div id="%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h1>
<p>å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†SpringCloudAlibabaçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„æ¶æ„ä½“ç³»å·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œé‚£ä¹ˆæœ¬ç« æˆ‘ä»¬å°†åœ¨åº”ç”¨å±‚é¢ç»§ç»­æ¢è®¨å¾®æœåŠ¡ã€‚</p>


<h2 class="relative group">åˆ†å¸ƒå¼æƒé™æ ¡éªŒ 
    <div id="%E5%88%86%E5%B8%83%E5%BC%8F%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p>è™½ç„¶å®Œæˆå‰é¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªå·±å»ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒä¸­è§„ä¸­çŸ©çš„å¾®æœåŠ¡é¡¹ç›®äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬æ²¡æœ‰è§£å†³ï¼Œç™»å½•é—®é¢˜ã€‚å‡å¦‚ç°åœ¨è¦æ±‚ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œå›¾ä¹¦çš„æŸ¥è¯¢ã€å€Ÿé˜…ç­‰æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•è®¾è®¡è¿™ä¸ªç³»ç»Ÿå‘¢ï¼Ÿ</p>
<p>å›é¡¾æˆ‘ä»¬ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒçš„åŸç†ï¼ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•åˆ¤å®šä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„å‘¢ï¼Ÿ</p>
<ul>
<li>é¦–å…ˆæµè§ˆå™¨ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ã€‚</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸€ä¸ªSESSION IDï¼Œå¹¶æš‚æ—¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç„¶åä¼šå‘é€ç»™æµè§ˆå™¨ä½œä¸ºCookieä¿å­˜ã€‚</li>
<li>ä¹‹åæµè§ˆå™¨ä¼šä¸€ç›´æºå¸¦æ­¤Cookieè®¿é—®æœåŠ¡å™¨ï¼Œè¿™æ ·åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±èƒ½æ ¹æ®æºå¸¦çš„Cookieä¸­çš„SESSION IDåˆ¤æ–­æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚</li>
<li>è¿™æ ·æœåŠ¡ç«¯å’Œæµè§ˆå™¨ä¹‹é—´å¯ä»¥è½»æ¾åœ°å»ºç«‹ä¼šè¯äº†ã€‚</li>
</ul>
<p>ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨é‡‡ç”¨çš„æ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æœåŠ¡è¿›è¡Œç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚å›¾ä¹¦æœåŠ¡å’Œå€Ÿé˜…æœåŠ¡ï¼Œå®ƒä»¬ä¼šçŸ¥é“ç”¨æˆ·ç™»å½•äº†å—ï¼Ÿ</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/hV2JkERda4qKtjB.png" alt="image-20230306234928969" />
    
  </figure>

</p>
<p>å®é™…ä¸Šæˆ‘ä»¬ç™»å½•åˆ°ç”¨æˆ·æœåŠ¡ä¹‹åï¼ŒSessionä¸­çš„ç”¨æˆ·æ•°æ®åªä¼šåœ¨ç”¨æˆ·æœåŠ¡çš„åº”ç”¨ä¸­ä¿å­˜ï¼Œè€Œåœ¨å…¶ä»–æœåŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½èƒ½å¤ŸåŒæ­¥è¿™äº›Sessionä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å®ç°åœ¨ç”¨æˆ·æœåŠ¡ç™»å½•ä¹‹åå…¶ä»–æœåŠ¡éƒ½èƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°Sessionçš„åŒæ­¥å‘¢ï¼Ÿ</p>
<ol>
<li>æˆ‘ä»¬å¯ä»¥åœ¨æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤åˆ¶ä¸€ä»½Sessionï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ï¼Œå¹¶ä¸”ç”¨æˆ·éªŒè¯æ•°æ®å ç”¨çš„å†…å­˜ä¼šæˆå€çš„å¢åŠ ã€‚</li>
<li>å°†Sessionç§»å‡ºæœåŠ¡å™¨ï¼Œç”¨ç»Ÿä¸€å­˜å‚¨æ¥å­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Redisæˆ–æ˜¯MySQLä¸­å­˜æ”¾ç”¨æˆ·çš„Sessionä¿¡æ¯ï¼Œè¿™æ ·æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨éœ€è¦è·å–Sessionä¿¡æ¯æ—¶ï¼Œç»Ÿä¸€è®¿é—®Redisæˆ–æ˜¯MySQLå³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥åŒæ­¥Sessionäº†ï¼ˆæ˜¯ä¸æ˜¯è¶Šæ¥è¶Šæ„Ÿè§‰åªè¦æœ‰é—®é¢˜ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´ä»¶è§£å†³ä¸äº†çš„ï¼‰</li>
</ol>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/pqZolFN6eIPza52.png" alt="image-20230306234940672" />
    
  </figure>

</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç€é‡æ¥ç ”ç©¶ä¸€ä¸‹ï¼Œç„¶åå®ç°2å·æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨Redisä½œä¸ºSessionç»Ÿä¸€å­˜å‚¨ï¼Œæˆ‘ä»¬æŠŠä¸€å¼€å§‹çš„å‹ç¼©åŒ…é‡æ–°è§£å‹ä¸€æ¬¡ï¼Œåˆæ¥ä»å¤´å¼€å§‹ç¼–å†™å§ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å°±åªä½¿ç”¨Nacoså°±è¡Œäº†ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠNacosçš„åŒ…å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œä¸€äº›é…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/FYcNvAuZ7z8rj2V.png" alt="image-20230306234948408" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡éƒ½æ·»åŠ éªŒè¯æœºåˆ¶ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--  SpringSession Redisæ”¯æŒ  --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.session<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-session-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--  æ·»åŠ Redisçš„Starter  --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨SpringSecurityæ¡†æ¶ä½œä¸ºæƒé™æ ¡éªŒæ¡†æ¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åœ¨æ¯ä¸ªæœåŠ¡éƒ½ç¼–å†™ä¸€ä¸‹å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">session</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c"># å­˜å‚¨ç±»å‹ä¿®æ”¹ä¸ºredis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">store-type</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c"># RedisæœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œè¯¥å’‹å†™å’‹å†™</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="m">1.14.121.107</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæœåŠ¡çš„æ¥å£éƒ½ä¼šè¢«SpringSecurityæ‰€ä¿æŠ¤ï¼Œåªæœ‰ç™»å½•æˆåŠŸä¹‹åï¼Œæ‰å¯ä»¥è¢«è®¿é—®ã€‚</p>
<p>æˆ‘ä»¬æ¥æ‰“å¼€Nacosçœ‹çœ‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/SyCJXKgO3qGx8EL.png" alt="image-20230306234959085" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæœåŠ¡éƒ½æ­£å¸¸æ³¨å†Œäº†ï¼Œæ¥ç€æˆ‘ä»¬å»è®¿é—®å›¾ä¹¦æœåŠ¡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/gytqnZjTMvVEUm3.png" alt="image-20230306235007563" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè®¿é—®å¤±è´¥ï¼Œç›´æ¥æŠŠæˆ‘ä»¬ç»™é‡å®šå‘åˆ°ç™»é™†é¡µé¢äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ç™»é™†ä¹‹åæ‰èƒ½è®¿é—®ï¼ŒåŒæ ·çš„æ–¹å¼å»è®¿é—®å…¶ä»–æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</p>
<p>ç”±äºç°åœ¨æ˜¯ç»Ÿä¸€Sessionå­˜å‚¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªæœåŠ¡ç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œç°åœ¨æˆ‘ä»¬åœ¨å½“å‰é¡µé¢ç™»å½•ï¼Œç™»å½•ä¹‹åå¯ä»¥çœ‹åˆ°å›¾ä¹¦æœåŠ¡èƒ½å¤Ÿæ­£å¸¸è®¿é—®äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/xfV5oYGvc1jKqTM.png" alt="image-20230306235015909" />
    
  </figure>

</p>
<p>åŒæ—¶ç”¨æˆ·æœåŠ¡ä¹Ÿèƒ½æ­£å¸¸è®¿é—®äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/OH6wjLVreot4IiA.png" alt="image-20230306235021694" />
    
  </figure>

</p>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹RedisæœåŠ¡å™¨ä¸­æ˜¯ä¸æ˜¯å­˜å‚¨äº†æˆ‘ä»¬çš„Sessionä¿¡æ¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/nNIkoXOAYuMH8aV.png" alt="image-20230306235046117" />
    
  </figure>

</p>
<p>è™½ç„¶çœ‹èµ·æ¥å¥½åƒç¡®å®æ²¡å•¥é—®é¢˜äº†ï¼Œä½†æ˜¯å€Ÿé˜…æœåŠ¡ç‚¸äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/wls5vCajnuMBOkU.png" alt="image-20230306235053840" />
    
  </figure>

</p>
<p>åœ¨RestTemplateè¿›è¡Œè¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œç”±äºæˆ‘ä»¬çš„è¯·æ±‚æ²¡æœ‰æºå¸¦å¯¹åº”SESSIONçš„Cookieï¼Œæ‰€ä»¥å¯¼è‡´éªŒè¯å¤±è´¥ï¼Œè®¿é—®ä¸æˆåŠŸï¼Œè¿”å›401ï¼Œæ‰€ä»¥è™½ç„¶è¿™ç§æ–¹æ¡ˆçœ‹èµ·æ¥æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„å®é™…ä½¿ç”¨ä¸­ï¼Œè¿˜æ˜¯å­˜åœ¨ä¸€äº›ä¸ä¾¿çš„ã€‚</p>
<hr>


<h2 class="relative group">OAuth 2.0 å®ç°å•ç‚¹ç™»å½• 
    <div id="oauth-20-%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#oauth-20-%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p><strong>æ³¨æ„ï¼š</strong> ç¬¬ä¸€æ¬¡æ¥è§¦å¯èƒ½ä¼šæ¯”è¾ƒéš¾ï¼Œä¸å¤ªå¥½ç†è§£ï¼Œéœ€è¦å¤šå®è·µå’Œè§‚å¯Ÿã€‚</p>
<p>å‰é¢æˆ‘ä»¬è™½ç„¶ä½¿ç”¨äº†ç»Ÿä¸€å­˜å‚¨æ¥è§£å†³Sessionå…±äº«é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å°±ç®—å®ç°äº†Sessionå…±äº«ï¼Œä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œç”±äºæˆ‘ä»¬æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„éªŒè¯æ¨¡å—ï¼Œå®é™…ä¸Šæ•´ä¸ªç³»ç»Ÿæ˜¯å­˜åœ¨å†—ä½™åŠŸèƒ½çš„ã€åŒæ—¶è¿˜æœ‰æˆ‘ä»¬ä¸Šé¢å‡ºç°çš„é—®é¢˜ï¼Œé‚£ä¹ˆèƒ½å¦å®ç°åªåœ¨ä¸€ä¸ªæœåŠ¡è¿›è¡Œç™»å½•ï¼Œå°±å¯ä»¥è®¿é—®å…¶ä»–çš„æœåŠ¡å‘¢ï¼Ÿ</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/46ukOAiDzMZBX15.png" alt="image-20230306235102514" />
    
  </figure>

</p>
<p>å®é™…ä¸Šä¹‹å‰çš„ç™»å½•æ¨¡å¼ç§°ä¸ºå¤šç‚¹ç™»å½•ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯å®ç°å•ç‚¹ç™»é™†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾—æ‰¾ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ç§å…¨æ–°çš„ç™»å½•æ–¹å¼ï¼š<strong>OAuth 2.0</strong>ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°ä¸€äº›ç½‘ç«™æ”¯æŒç¬¬ä¸‰æ–¹ç™»å½•ï¼Œæ¯”å¦‚æ·˜å®ã€å’¸é±¼æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ”¯ä»˜å®è¿›è¡Œç™»å½•ï¼Œè…¾è®¯æ¸¸æˆå¯ä»¥ç”¨QQæˆ–æ˜¯å¾®ä¿¡ç™»é™†ï¼Œä»¥åŠå¾®ä¿¡å°ç¨‹åºéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨å¾®ä¿¡è¿›è¡Œç™»å½•ã€‚æˆ‘ä»¬çŸ¥é“å®ƒä»¬å¹¶ä¸æ˜¯å±äºåŒä¸€ä¸ªç³»ç»Ÿï¼Œæ¯”å¦‚æ·˜å®å’Œå’¸é±¼éƒ½ä¸å±äºæ”¯ä»˜å®è¿™ä¸ªåº”ç”¨ï¼Œä½†æ˜¯ç”±äºéœ€è¦è·å–æ”¯ä»˜å®çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ OAuth2.0 æ¥å®ç°ç¬¬ä¸‰æ–¹æˆæƒï¼ŒåŸºäºç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ç”¨æˆ·ä¿¡æ¯çš„æƒé™ï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯ç»™åˆ«äººè°ƒç”¨è‡ªå·±æœåŠ¡æ¥å£çš„æƒé™)ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>


<h3 class="relative group">å››ç§æˆæƒæ¨¡å¼ 
    <div id="%E5%9B%9B%E7%A7%8D%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%9B%9B%E7%A7%8D%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»ç†è®ºå¼€å§‹è®²è§£ï¼ŒOAuth 2.0ä¸€å…±æœ‰å››ç§æˆæƒæ¨¡å¼ï¼š</p>
<ol>
<li>
<p><strong>å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆClient Credentialsï¼‰</strong></p>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘éªŒè¯æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªTokenï¼ˆè¿™é‡Œå¯èƒ½æœ‰äº›å°ä¼™ä¼´å¯¹Tokençš„æ¦‚å¿µä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ŒTokenç›¸å½“äºæ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦åœ¨éªŒè¯æœåŠ¡å™¨**ï¼ˆUser Account And Authenticationï¼‰**æœåŠ¡æ‹¿åˆ°ä»¤ç‰Œä¹‹åï¼Œæ‰èƒ½å»è®¿é—®èµ„æºï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€å€Ÿé˜…ä¿¡æ¯ç­‰ï¼Œè¿™æ ·èµ„æºæœåŠ¡å™¨æ‰èƒ½çŸ¥é“æˆ‘ä»¬æ˜¯è°ä»¥åŠæ˜¯å¦æˆåŠŸç™»å½•äº†ï¼‰</p>
<p>å½“ç„¶ï¼Œè¿™é‡Œçš„å‰ç«¯é¡µé¢åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ƒè¿˜å¯ä»¥æ˜¯å…¶ä»–ä»»ä½•ç±»å‹çš„<strong>å®¢æˆ·ç«¯</strong>ï¼Œæ¯”å¦‚Appã€å°ç¨‹åºç”šè‡³æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨çš„æœåŠ¡ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/4i16wzqOnYeaB2c.png" alt="image-20230306235141113" />
    
  </figure>

</p>
<p>è™½ç„¶è¿™ç§æ¨¡å¼æ¯”è¾ƒç®€ä¾¿ï¼Œä½†æ˜¯å·²ç»å¤±å»äº†ç”¨æˆ·éªŒè¯çš„æ„ä¹‰ï¼Œå‹æ ¹å°±ä¸æ˜¯ç»™ç”¨æˆ·æ ¡éªŒå‡†å¤‡çš„ï¼Œè€Œæ˜¯æ›´é€‚ç”¨äºæœåŠ¡å†…éƒ¨è°ƒç”¨çš„åœºæ™¯ã€‚</p>
</li>
<li>
<p><strong>å¯†ç æ¨¡å¼ï¼ˆResource Owner Password Credentialsï¼‰</strong></p>
<p>å¯†ç æ¨¡å¼ç›¸æ¯”å®¢æˆ·ç«¯æ¨¡å¼ï¼Œå°±å¤šäº†ç”¨æˆ·åå’Œå¯†ç çš„ä¿¡æ¯ï¼Œç”¨æˆ·éœ€è¦æä¾›å¯¹åº”è´¦å·çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰èƒ½è·å–åˆ°Tokenã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/JEreS9nQD8ojMca.png" alt="image-20230306235151635" />
    
  </figure>

</p>
<p>è™½ç„¶è¿™æ ·çœ‹èµ·æ¥æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯ä¼šç›´æ¥å°†è´¦å·å’Œå¯†ç æ³„éœ²ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦åå°å®Œå…¨ä¿¡ä»»å®¢æˆ·ç«¯ä¸ä¼šæ‹¿è´¦å·å¯†ç å»å¹²å…¶ä»–åäº‹ï¼Œæ‰€ä»¥è¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬å¸¸è§çš„ã€‚</p>
</li>
<li>
<p><strong>éšå¼æˆæƒæ¨¡å¼ï¼ˆImplicit Grantï¼‰</strong></p>
<p>é¦–å…ˆç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼Œä¼šé‡å®šå‘åˆ°è®¤è¯æœåŠ¡å™¨ï¼Œæ¥ç€è®¤è¯æœåŠ¡å™¨ç»™ç”¨æˆ·ä¸€ä¸ªè®¤è¯é¡µé¢ï¼Œç­‰å¾…ç”¨æˆ·æˆæƒï¼Œç”¨æˆ·å¡«å†™ä¿¡æ¯å®Œæˆæˆæƒåï¼Œè®¤è¯æœåŠ¡å™¨è¿”å›Tokenã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/MRxnKyWT3br5Zj2.png" alt="image-20230306235200365" />
    
  </figure>

</p>
<p>å®ƒé€‚ç”¨äºæ²¡æœ‰æœåŠ¡ç«¯çš„ç¬¬ä¸‰æ–¹åº”ç”¨é¡µé¢ï¼Œå¹¶ä¸”ç›¸æ¯”å‰é¢ä¸€ç§å½¢å¼ï¼ŒéªŒè¯éƒ½æ˜¯åœ¨éªŒè¯æœåŠ¡å™¨è¿›è¡Œçš„ï¼Œæ•æ„Ÿä¿¡æ¯ä¸ä¼šè½»æ˜“æ³„éœ²ï¼Œä½†æ˜¯Tokenä¾ç„¶å­˜åœ¨æ³„éœ²çš„é£é™©ã€‚</p>
</li>
<li>
<p><strong>æˆæƒç æ¨¡å¼ï¼ˆAuthrization Codeï¼‰</strong></p>
<p>è¿™ç§æ¨¡å¼æ˜¯æœ€å®‰å…¨çš„ä¸€ç§æ¨¡å¼ï¼Œä¹Ÿæ˜¯æ¨èä½¿ç”¨çš„ä¸€ç§ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰‹æœºä¸Šçš„å¾ˆå¤šAppéƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§æ¨¡å¼ã€‚</p>
<p>ç›¸æ¯”éšå¼æˆæƒæ¨¡å¼ï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥è¿”å›Tokenï¼Œè€Œæ˜¯è¿”å›æˆæƒç ï¼ŒçœŸæ­£çš„Tokenæ˜¯é€šè¿‡åº”ç”¨æœåŠ¡å™¨è®¿é—®éªŒè¯æœåŠ¡å™¨è·å¾—çš„ã€‚åœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œåº”ç”¨æœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯é€šè¿‡è®¿é—®è‡ªå·±çš„åº”ç”¨æœåŠ¡å™¨æ¥è¿›è€Œè®¿é—®å…¶ä»–æœåŠ¡ï¼‰å’ŒéªŒè¯æœåŠ¡å™¨ä¹‹é—´ä¼šå…±äº«ä¸€ä¸ª<code>secret</code>ï¼Œè¿™ä¸ªä¸œè¥¿æ²¡æœ‰å…¶ä»–äººçŸ¥é“ï¼Œè€ŒéªŒè¯æœåŠ¡å™¨åœ¨ç”¨æˆ·éªŒè¯å®Œæˆä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ªæˆæƒç ï¼Œåº”ç”¨æœåŠ¡å™¨æœ€åå°†æˆæƒç å’Œ<code>secret</code>ä¸€èµ·äº¤ç»™éªŒè¯æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”Tokenä¹Ÿæ˜¯åœ¨æœåŠ¡ç«¯ä¹‹é—´ä¼ é€’ï¼Œä¸ä¼šç›´æ¥ç»™åˆ°å®¢æˆ·ç«¯ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/2EIPfirBOKbcndk.png" alt="image-20230306235211335" />
    
  </figure>

</p>
<p>è¿™æ ·å°±ç®—æœ‰äººä¸­é€”çªƒå–äº†æˆæƒç ï¼Œä¹Ÿæ¯«æ— æ„ä¹‰ï¼Œå› ä¸ºï¼ŒTokençš„è·å–å¿…é¡»åŒæ—¶æºå¸¦æˆæƒç å’Œsecretï¼Œä½†æ˜¯<code>secret</code>ç¬¬ä¸‰æ–¹æ˜¯æ— æ³•å¾—çŸ¥çš„ï¼Œå¹¶ä¸”Tokenä¸ä¼šç›´æ¥ä¸¢ç»™å®¢æˆ·ç«¯ï¼Œå¤§å¤§å‡å°‘äº†æ³„éœ²çš„é£é™©ã€‚</p>
</li>
</ol>
<p>ä½†æ˜¯ä¹ä¸€çœ‹ï¼ŒOAuth 2.0ä¸åº”è¯¥æ˜¯é‚£ç§ç¬¬ä¸‰æ–¹åº”ç”¨ä¸ºäº†è¯·æ±‚æˆ‘ä»¬çš„æœåŠ¡è€Œä½¿ç”¨çš„å—ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œéœ€è¦çš„åªæ˜¯å®ç°åŒä¸€ä¸ªåº”ç”¨å†…éƒ¨æœåŠ¡ä¹‹é—´çš„è®¤è¯ï¼Œå…¶å®æˆ‘ä¹Ÿå¯ä»¥åˆ©ç”¨ OAuth2.0 æ¥å®ç°å•ç‚¹ç™»å½•ï¼Œåªæ˜¯å°‘äº†èµ„æºæœåŠ¡å™¨è¿™ä¸€è§’è‰²ï¼Œå®¢æˆ·ç«¯å°±æ˜¯æˆ‘ä»¬çš„æ•´ä¸ªç³»ç»Ÿï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ã€‚</p>


<h3 class="relative group">æ­å»ºéªŒè¯æœåŠ¡å™¨ 
    <div id="%E6%90%AD%E5%BB%BA%E9%AA%8C%E8%AF%81%E6%9C%8D%E5%8A%A1%E5%99%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%90%AD%E5%BB%BA%E9%AA%8C%E8%AF%81%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>ç¬¬ä¸€æ­¥å°±æ˜¯æœ€é‡è¦çš„ï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªéªŒè¯æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æˆ‘ä»¬è¿›è¡Œæƒé™æ ¡éªŒçš„æ ¸å¿ƒï¼ŒéªŒè¯æœåŠ¡å™¨æœ‰å¾ˆå¤šçš„ç¬¬ä¸‰æ–¹å®ç°ä¹Ÿæœ‰Springå®˜æ–¹æä¾›çš„å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Springå®˜æ–¹æä¾›çš„éªŒè¯æœåŠ¡å™¨ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å°†æœ€å¼€å§‹ä¿å­˜å¥½çš„é¡¹ç›®è§£å‹ï¼Œå°±é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨çˆ¶é¡¹ç›®ä¸­æ·»åŠ æœ€æ–°çš„SpringCloudä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2021.0.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>æ¥ç€åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å—<code>auth-service</code>ï¼Œæ·»åŠ ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--  OAuth2.0ä¾èµ–ï¼Œä¸å†å†…ç½®äº†ï¼Œæ‰€ä»¥å¾—æˆ‘ä»¬è‡ªå·±æŒ‡å®šä¸€ä¸‹ç‰ˆæœ¬  --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-oauth2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>2.2.5.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">servlet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c">#ä¸ºäº†é˜²æ­¢ä¸€ä¼šåœ¨æœåŠ¡ä¹‹é—´è·³è½¬å¯¼è‡´Cookieæ‰“æ¶ï¼ˆå› ä¸ºæ‰€æœ‰æœåŠ¡åœ°å€éƒ½æ˜¯localhostï¼Œéƒ½ä¼šå­˜JSESSIONIDï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c">#è¿™é‡Œä¿®æ”¹ä¸€ä¸‹context-pathï¼Œè¿™æ ·ä¿å­˜çš„Cookieä¼šä½¿ç”¨æŒ‡å®šçš„è·¯å¾„ï¼Œå°±ä¸ä¼šå’Œå…¶ä»–æœåŠ¡æ‰“æ¶äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c">#ä½†æ˜¯æ³¨æ„ä¹‹åçš„è¯·æ±‚éƒ½å¾—åœ¨æœ€å‰é¢åŠ ä¸Šè¿™ä¸ªè·¯å¾„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">context-path</span><span class="p">:</span><span class="w"> </span><span class="l">/sso</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸‹é…ç½®ç±»ï¼Œè¿™é‡Œéœ€è¦ä¸¤ä¸ªé…ç½®ç±»ï¼Œä¸€ä¸ªæ˜¯OAuth2çš„é…ç½®ç±»ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯SpringSecurityçš„é…ç½®ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SecurityConfiguration</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">WebSecurityConfigurerAdapter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authorizeRequests</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">authenticated</span><span class="p">()</span><span class="w">  </span><span class="c1">//</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">and</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">formLogin</span><span class="p">().</span><span class="na">permitAll</span><span class="p">();</span><span class="w">    </span><span class="c1">//ä½¿ç”¨è¡¨å•ç™»å½•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">AuthenticationManagerBuilder</span><span class="w"> </span><span class="n">auth</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BCryptPasswordEncoder</span><span class="w"> </span><span class="n">encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BCryptPasswordEncoder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">inMemoryAuthentication</span><span class="p">()</span><span class="w">   </span><span class="c1">//ç›´æ¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œæ‡’å¾—ææ•°æ®åº“äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">passwordEncoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withUser</span><span class="p">(</span><span class="s">&#34;test&#34;</span><span class="p">).</span><span class="na">password</span><span class="p">(</span><span class="n">encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="s">&#34;123456&#34;</span><span class="p">)).</span><span class="na">roles</span><span class="p">(</span><span class="s">&#34;USER&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nd">@Bean</span><span class="w">   </span><span class="c1">//è¿™é‡Œéœ€è¦å°†AuthenticationManageræ³¨å†Œä¸ºBeanï¼Œåœ¨OAuthé…ç½®ä¸­ä½¿ç”¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">AuthenticationManager</span><span class="w"> </span><span class="nf">authenticationManagerBean</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">authenticationManagerBean</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableAuthorizationServer</span><span class="w">   </span><span class="c1">//å¼€å¯éªŒè¯æœåŠ¡å™¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OAuth2Configuration</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AuthorizationServerConfigurerAdapter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AuthenticationManager</span><span class="w"> </span><span class="n">manager</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BCryptPasswordEncoder</span><span class="w"> </span><span class="n">encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BCryptPasswordEncoder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹å®¢æˆ·ç«¯è¿›è¡Œé…ç½®ï¼Œä¸€ä¸ªéªŒè¯æœåŠ¡å™¨å¯ä»¥é¢„è®¾å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä¹‹åè¿™äº›æŒ‡å®šçš„å®¢æˆ·ç«¯å°±å¯ä»¥æŒ‰ç…§ä¸‹é¢æŒ‡å®šçš„æ–¹å¼è¿›è¡ŒéªŒè¯
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param clients å®¢æˆ·ç«¯é…ç½®å·¥å…·
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">ClientDetailsServiceConfigurer</span><span class="w"> </span><span class="n">clients</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">inMemory</span><span class="p">()</span><span class="w">   </span><span class="c1">//è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç¡¬ç¼–ç åˆ›å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åƒSecurityé‚£æ ·è‡ªå®šä¹‰æˆ–æ˜¯ä½¿ç”¨JDBCä»æ•°æ®åº“è¯»å–</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withClient</span><span class="p">(</span><span class="s">&#34;web&#34;</span><span class="p">)</span><span class="w">   </span><span class="c1">//å®¢æˆ·ç«¯åç§°ï¼Œéšä¾¿èµ·å°±è¡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">secret</span><span class="p">(</span><span class="n">encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="s">&#34;654321&#34;</span><span class="p">))</span><span class="w">      </span><span class="c1">//åªä¸å®¢æˆ·ç«¯åˆ†äº«çš„secretï¼Œéšä¾¿å†™ï¼Œä½†æ˜¯æ³¨æ„è¦åŠ å¯†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">autoApprove</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">    </span><span class="c1">//è‡ªåŠ¨å®¡æ‰¹ï¼Œè¿™é‡Œå…³é—­ï¼Œè¦çš„å°±æ˜¯ä¸€ä¼šä½“éªŒé‚£ç§æ„Ÿè§‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">scopes</span><span class="p">(</span><span class="s">&#34;book&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;borrow&#34;</span><span class="p">)</span><span class="w">     </span><span class="c1">//æˆæƒèŒƒå›´ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å…¨éƒ¨all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authorizedGrantTypes</span><span class="p">(</span><span class="s">&#34;client_credentials&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;password&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;implicit&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;authorization_code&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;refresh_token&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">//æˆæƒæ¨¡å¼ï¼Œä¸€å…±æ”¯æŒ5ç§ï¼Œé™¤äº†ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„å››ç§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ·æ–°Tokençš„æ¨¡å¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">//è¿™é‡Œæˆ‘ä»¬ç›´æ¥æŠŠäº”ç§éƒ½å†™ä¸Šï¼Œæ–¹ä¾¿ä¸€ä¼šå®éªŒï¼Œå½“ç„¶å„ä½ä¹Ÿå¯ä»¥å•ç‹¬åªå†™ä¸€ç§ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œæµ‹è¯•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">//ç°åœ¨æˆ‘ä»¬æŒ‡å®šçš„å®¢æˆ·ç«¯å°±æ”¯æŒè¿™äº”ç§ç±»å‹çš„æˆæƒæ–¹å¼äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">AuthorizationServerSecurityConfigurer</span><span class="w"> </span><span class="n">security</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">security</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">passwordEncoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span><span class="w">    </span><span class="c1">//ç¼–ç å™¨è®¾å®šä¸ºBCryptPasswordEncoder</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">allowFormAuthenticationForClients</span><span class="p">()</span><span class="w">  </span><span class="c1">//å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨è¡¨å•éªŒè¯ï¼Œä¸€ä¼šæˆ‘ä»¬POSTè¯·æ±‚ä¸­ä¼šæºå¸¦è¡¨å•ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">checkTokenAccess</span><span class="p">(</span><span class="s">&#34;permitAll()&#34;</span><span class="p">);</span><span class="w">     </span><span class="c1">//å…è®¸æ‰€æœ‰çš„TokenæŸ¥è¯¢è¯·æ±‚</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">AuthorizationServerEndpointsConfigurer</span><span class="w"> </span><span class="n">endpoints</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authenticationManager</span><span class="p">(</span><span class="n">manager</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//ç”±äºSpringSecurityæ–°ç‰ˆæœ¬çš„ä¸€äº›åº•å±‚æ”¹åŠ¨ï¼Œè¿™é‡Œéœ€è¦é…ç½®ä¸€ä¸‹authenticationManagerï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨passwordæ¨¡å¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨æœåŠ¡å™¨äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/2FhnOKe1BorP5NE.png" alt="image-20230306235226961" />
    
  </figure>

</p>
<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨Postmanè¿›è¡Œæ¥å£æµ‹è¯•ï¼Œé¦–å…ˆæˆ‘ä»¬ä»æœ€ç®€å•çš„å®¢æˆ·ç«¯æ¨¡å¼è¿›è¡Œæµ‹è¯•ï¼Œå®¢æˆ·ç«¯æ¨¡å¼åªéœ€è¦æä¾›idå’Œsecretå³å¯ç›´æ¥æ‹¿åˆ°Tokenï¼Œæ³¨æ„éœ€è¦å†æ·»åŠ ä¸€ä¸ªgrant_typeæ¥è¡¨æ˜æˆ‘ä»¬çš„æˆæƒæ–¹å¼ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„ä¸ºhttp://localhost:8500/sso/oauth/tokenï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/X81T7mz5gQK3iBk.png" alt="image-20230306235236376" />
    
  </figure>

</p>
<p>å‘èµ·è¯·æ±‚åï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¾—åˆ°äº†Tokenï¼Œå®ƒæ˜¯ä»¥JSONæ ¼å¼ç»™åˆ°æˆ‘ä»¬çš„ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/84IKgq2xdvBeLTm.png" alt="image-20230306235248456" />
    
  </figure>

</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è®¿é—® http://localhost:8500/sso/oauth/check_token æ¥éªŒè¯æˆ‘ä»¬çš„Tokenæ˜¯å¦æœ‰æ•ˆï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/SXD8FjzZn7ev2B3.png" alt="image-20230306235257995" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/B9TzojnUq4KvVPr.png" alt="image-20230306235309409" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°activeä¸ºtrueï¼Œè¡¨ç¤ºæˆ‘ä»¬åˆšåˆšç”³è¯·åˆ°çš„Tokenæ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç¬¬äºŒç§passwordæ¨¡å¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›å…·ä½“çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆæƒæ¨¡å¼å®šä¹‰ä¸ºpasswordå³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/jt5XPZKvRFqr73x.png" alt="image-20230306235318785" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ BasicéªŒè¯ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å¡«å†™idå’Œsecretå³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/K9ZpIv8SzcfsHd4.png" alt="image-20230306235327745" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°åœ¨è¯·æ±‚å¤´ä¸­è‡ªåŠ¨ç”Ÿæˆäº†BasicéªŒè¯ç›¸å…³å†…å®¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/JHxPKgFU5wY7SB8.png" alt="image-20230306235335919" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/F3WU7XhqridywVn.png" alt="image-20230306235345388" />
    
  </figure>

</p>
<p>å“åº”æˆåŠŸï¼Œå¾—åˆ°Tokenä¿¡æ¯ï¼Œå¹¶ä¸”è¿™é‡Œè¿˜å¤šå‡ºäº†ä¸€ä¸ªrefresh_tokenï¼Œè¿™æ˜¯ç”¨äºåˆ·æ–°Tokençš„ï¼Œæˆ‘ä»¬ä¹‹åä¼šè¿›è¡Œè®²è§£ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/zjuc2qxQmBas5r1.png" alt="image-20230306235355181" />
    
  </figure>

</p>
<p>æŸ¥è¯¢Tokenä¿¡æ¯ä¹‹åè¿˜å¯ä»¥çœ‹åˆ°ç™»å½•çš„å…·ä½“ç”¨æˆ·ä»¥åŠè§’è‰²æƒé™ç­‰ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹éšå¼æˆæƒæ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æˆ‘ä»¬éœ€è¦åœ¨éªŒè¯æœåŠ¡å™¨ä¸Šè¿›è¡Œç™»å½•æ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥è¯·æ±‚Tokenï¼ŒéªŒè¯ç™»å½•è¯·æ±‚åœ°å€ï¼šhttp://localhost:8500/sso/oauth/authorize?client_id=web&amp;response_type=token</p>
<p>æ³¨æ„response_typeä¸€å®šè¦æ˜¯tokenç±»å‹ï¼Œè¿™æ ·æ‰ä¼šç›´æ¥è¿”å›Tokenï¼Œæµè§ˆå™¨å‘èµ·è¯·æ±‚åï¼Œå¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰è€Œåˆé™Œç”Ÿçš„ç•Œé¢ï¼Œæ²¡é”™ï¼Œå®é™…ä¸Šè¿™é‡Œå°±æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è®²è§£çš„SpringSecurityè¿›è¡Œç™»é™†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é…ç½®ä¸€ä¸‹è®°ä½æˆ‘ä¹‹ç±»çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/OYeRQpEXFSoZMhc.png" alt="image-20230306235441824" />
    
  </figure>

</p>
<p>ä½†æ˜¯ç™»å½•ä¹‹åæˆ‘ä»¬å‘ç°å‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/qLUkJFZau8eQ6WO.png" alt="image-20230306235501474" />
    
  </figure>

</p>
<p>è¿™æ˜¯å› ä¸ºç™»å½•æˆåŠŸä¹‹åï¼ŒéªŒè¯æœåŠ¡å™¨éœ€è¦å°†ç»“æœç»™å›å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥éœ€è¦æä¾›å®¢æˆ·ç«¯çš„å›è°ƒåœ°å€ï¼Œè¿™æ ·æµè§ˆå™¨å°±ä¼šè¢«é‡å®šå‘åˆ°æŒ‡å®šçš„å›è°ƒåœ°å€å¹¶ä¸”è¯·æ±‚ä¸­ä¼šæºå¸¦Tokenä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬éšä¾¿é…ç½®ä¸€ä¸ªå›è°ƒåœ°å€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">ClientDetailsServiceConfigurer</span><span class="w"> </span><span class="n">clients</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">inMemory</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">withClient</span><span class="p">(</span><span class="s">&#34;web&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">secret</span><span class="p">(</span><span class="n">encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="s">&#34;654321&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">autoApprove</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">scopes</span><span class="p">(</span><span class="s">&#34;book&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;borrow&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">redirectUris</span><span class="p">(</span><span class="s">&#34;http://localhost:8201/login&#34;</span><span class="p">)</span><span class="w">   </span><span class="c1">//å¯ä»¥å†™å¤šä¸ªï¼Œå½“æœ‰å¤šä¸ªæ—¶éœ€è¦åœ¨éªŒè¯è¯·æ±‚ä¸­æŒ‡å®šä½¿ç”¨å“ªä¸ªåœ°å€è¿›è¡Œå›è°ƒ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">authorizedGrantTypes</span><span class="p">(</span><span class="s">&#34;client_credentials&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;password&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;implicit&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;authorization_code&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;refresh_token&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€é‡å¯éªŒè¯æœåŠ¡å™¨ï¼Œå†æ¬¡è®¿é—®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/PnTwQhlYXDgBvry.png" alt="image-20230306235513330" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šè®©æˆ‘ä»¬é€‰æ‹©å“ªäº›èŒƒå›´è¿›è¡Œæˆæƒï¼Œå°±åƒæˆ‘ä»¬åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ç™»é™†ä¸€æ ·ï¼Œä¼šè®©æˆ‘ä»¬æˆäºˆç”¨æˆ·ä¿¡æ¯æƒé™ã€æ”¯ä»˜æƒé™ã€ä¿¡ç”¨æŸ¥è¯¢æƒé™ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±å†³å®šè¦ä¸è¦ç»™å®¢æˆ·ç«¯æˆäºˆè®¿é—®è¿™äº›èµ„æºçš„æƒé™ï¼Œè¿™é‡Œæˆ‘ä»¬å…¨éƒ¨é€‰æ‹©æˆäºˆï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/p7nMEVZIKjXWAl5.png" alt="image-20230306235521432" />
    
  </figure>

</p>
<p>æˆäºˆä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¢«é‡å®šå‘åˆ°æˆ‘ä»¬åˆšåˆšæŒ‡å®šçš„å›è°ƒåœ°å€ä¸­ï¼Œå¹¶ä¸”æºå¸¦äº†Tokenä¿¡æ¯ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ ¡éªŒä¸€ä¸‹çœ‹çœ‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/g1JhS9WDfcz6QEK.png" alt="image-20230306235530288" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒTokenä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬å››ç§æœ€å®‰å…¨çš„æˆæƒç æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å…¶å®æµç¨‹å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¯·æ±‚çš„æ˜¯codeç±»å‹ï¼šhttp://localhost:8500/sso/oauth/authorize?client_id=web&amp;response_type=code</p>
<p>å¯ä»¥çœ‹åˆ°è®¿é—®ä¹‹åï¼Œä¾ç„¶ä¼šè¿›å…¥åˆ°å›è°ƒåœ°å€ï¼Œä½†æ˜¯è¿™æ—¶ç»™çš„å°±æ˜¯æˆæƒç äº†ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™Tokenï¼Œé‚£ä¹ˆè¿™ä¸ªTokenè¯¥æ€ä¹ˆè·å–å‘¢ï¼Ÿ</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/da4WseDt172hbLV.png" alt="image-20230306235536317" />
    
  </figure>

</p>
<p>æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰è®²è§£çš„åŸç†ï¼Œæˆ‘ä»¬éœ€è¦æºå¸¦æˆæƒç å’Œsecretä¸€èµ·è¯·æ±‚ï¼Œæ‰èƒ½æ‹¿åˆ°Tokenï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ç”±å›è°ƒçš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæˆ‘ä»¬å°±åœ¨Postmanä¸­è¿›è¡Œï¼Œæˆ‘ä»¬å¤åˆ¶åˆšåˆšå¾—åˆ°çš„æˆæƒç ï¼Œæ¥å£ä¾ç„¶æ˜¯<code>localhost:8500/sso/oauth/token</code>ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/e1Zdt9IP7vp2zMO.png" alt="image-20230306235545717" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ç»“æœä¹Ÿæ˜¯æ­£å¸¸è¿”å›äº†Tokenä¿¡æ¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/qY5kxgBWSzMJXco.png" alt="image-20230306235554061" />
    
  </figure>

</p>
<p>è¿™æ ·æˆ‘ä»¬å››ç§æœ€åŸºæœ¬çš„Tokenè¯·æ±‚æ–¹å¼å°±å®ç°äº†ã€‚</p>
<p>æœ€åè¿˜æœ‰ä¸€ä¸ªæ˜¯åˆ·æ–°ä»¤ç‰Œä½¿ç”¨çš„ï¼Œå½“æˆ‘ä»¬çš„Tokenè¿‡æœŸæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªrefresh_tokenæ¥ç”³è¯·ä¸€ä¸ªæ–°çš„Tokenï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/d2ojclCLB3mQu7D.png" alt="image-20230306235603731" />
    
  </figure>

</p>
<p>ä½†æ˜¯æ‰§è¡Œä¹‹åæˆ‘ä»¬å‘ç°ä¼šç›´æ¥å‡ºç°ä¸€ä¸ªå†…éƒ¨é”™è¯¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/BcFMIg4NqCx8kdh.png" alt="image-20230306235611413" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/cA9WF1KxyUDZ8Bi.png" alt="image-20230306235618838" />
    
  </figure>

</p>
<p>æŸ¥çœ‹æ—¥å¿—å‘ç°ï¼Œè¿™é‡Œè¿˜éœ€è¦æˆ‘ä»¬å•ç‹¬é…ç½®ä¸€ä¸ªUserDetailsServiceï¼Œæˆ‘ä»¬ç›´æ¥æŠŠSecurityä¸­çš„å®ä¾‹æ³¨å†Œä¸ºBeanï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">UserDetailsService</span><span class="w"> </span><span class="nf">userDetailsServiceBean</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">userDetailsServiceBean</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶ååœ¨Endpointä¸­è®¾ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UserDetailsService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">AuthorizationServerEndpointsConfigurer</span><span class="w"> </span><span class="n">endpoints</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">userDetailsService</span><span class="p">(</span><span class="n">service</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">authenticationManager</span><span class="p">(</span><span class="n">manager</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æœ€åå†æ¬¡å°è¯•åˆ·æ–°Tokenï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/QWEwzpiq7FXnv3f.png" alt="image-20230306235638503" />
    
  </figure>

</p>
<p>OKï¼ŒæˆåŠŸåˆ·æ–°Tokenï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„ã€‚</p>


<h3 class="relative group">åŸºäº@EnableOAuth2Ssoå®ç° 
    <div id="%E5%9F%BA%E4%BA%8Eenableoauth2sso%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%9F%BA%E4%BA%8Eenableoauth2sso%E5%AE%9E%E7%8E%B0" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬å°†éªŒè¯æœåŠ¡å™¨å·²ç»æ­å»ºå®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸‹å•ç‚¹ç™»é™†å§ï¼ŒSpringCloudä¸ºæˆ‘ä»¬æä¾›äº†å®¢æˆ·ç«¯çš„ç›´æ¥å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨è§£å’Œå°‘é‡é…ç½®å³å¯å°†æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºä¸€ä¸ªå•ç‚¹ç™»é™†åº”ç”¨ï¼Œä½¿ç”¨çš„æ˜¯ç¬¬å››ç§æˆæƒç æ¨¡å¼ã€‚</p>
<p>ä¸€å¥è¯æ¥è¯´å°±æ˜¯ï¼Œè¿™ç§æ¨¡å¼åªæ˜¯å°†éªŒè¯æ–¹å¼ç”±åŸæœ¬çš„é»˜è®¤ç™»å½•å½¢å¼æ”¹å˜ä¸ºäº†ç»Ÿä¸€åœ¨æˆæƒæœåŠ¡å™¨ç™»é™†çš„å½¢å¼ã€‚</p>
<p>é¦–å…ˆè¿˜æ˜¯ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-oauth2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2.2.5.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬åªéœ€è¦ç›´æ¥åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableOAuth2Sso</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">BookApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„é…ç½®ç±»ï¼Œå› ä¸ºè¿™ä¸ªæ³¨è§£å·²ç»å¸®æˆ‘ä»¬åšäº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Documented</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableOAuth2Client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableConfigurationProperties</span><span class="p">({</span><span class="n">OAuth2SsoProperties</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Import</span><span class="p">({</span><span class="n">OAuth2SsoDefaultConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">OAuth2SsoCustomConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceServerTokenServicesConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">EnableOAuth2Sso</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°å®ƒç›´æ¥æ³¨å†Œäº†OAuth2SsoDefaultConfigurationï¼Œè€Œè¿™ä¸ªç±»å°±æ˜¯å¸®åŠ©æˆ‘ä»¬å¯¹Securityè¿›è¡Œé…ç½®çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Conditional</span><span class="p">({</span><span class="n">NeedsWebSecurityCondition</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OAuth2SsoDefaultConfiguration</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">WebSecurityConfigurerAdapter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c1">//ç›´æ¥ç»§æ‰¿çš„WebSecurityConfigurerAdapterï¼Œå¸®æˆ‘ä»¬æŠŠéªŒè¯è®¾ç½®éƒ½å†™å¥½äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OAuth2SsoDefaultConfiguration</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ‘ä»¬çš„éªŒè¯æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">oauth2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#ä¸å¤šè¯´äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">client-id</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">client-secret</span><span class="p">:</span><span class="w"> </span><span class="m">654321</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#Tokenè·å–åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access-token-uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8500/sso/oauth/token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#éªŒè¯é¡µé¢åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user-authorization-uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8500/sso/oauth/authorize</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#Tokenä¿¡æ¯è·å–å’Œæ ¡éªŒåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">token-info-uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8500/sso/oauth/check_token</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å°±å¼€å¯å›¾ä¹¦æœåŠ¡ï¼Œè°ƒç”¨å›¾ä¹¦æ¥å£ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/DrVSZtdKNCoMucx.png" alt="image-20230306235651433" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å‘ç°æ²¡æœ‰ç™»å½•éªŒè¯æ—¶ï¼Œä¼šç›´æ¥è·³è½¬åˆ°æˆæƒé¡µé¢ï¼Œè¿›è¡Œæˆæƒç™»å½•ï¼Œä¹‹åæ‰å¯ä»¥ç»§ç»­è®¿é—®å›¾ä¹¦æœåŠ¡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/nsJGmxcOVYXDUqd.png" alt="image-20230306235701725" />
    
  </figure>

</p>
<p>é‚£ä¹ˆç”¨æˆ·ä¿¡æ¯å‘¢ï¼Ÿæ˜¯å¦ä¹Ÿä¸€å¹¶ä¿å­˜è¿‡æ¥äº†ï¼Ÿæˆ‘ä»¬è¿™é‡Œç›´æ¥è·å–ä¸€ä¸‹SpringSecurityçš„ContextæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ï¼Œè·å–æ–¹å¼è·Ÿæˆ‘ä»¬ä¹‹å‰çš„è§†é¢‘ä¸­è®²è§£çš„æ˜¯ä¸€æ ·çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Book</span><span class="w"> </span><span class="nf">findBookById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c1">//é€šè¿‡SecurityContextHolderå°†ç”¨æˆ·ä¿¡æ¯å–å‡º</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SecurityContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityContextHolder</span><span class="p">.</span><span class="na">getContext</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getAuthentication</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å†æ¬¡è®¿é—®å›¾ä¹¦ç®¡ç†æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/y1VYRC9tmOv854u.png" alt="image-20230306235733777" />
    
  </figure>

</p>
<p>è¿™é‡Œä½¿ç”¨çš„ä¸æ˜¯ä¹‹å‰çš„UsernamePasswordAuthenticationTokenä¹Ÿä¸æ˜¯RememberMeAuthenticationTokenï¼Œè€Œæ˜¯æ–°çš„OAuth2Authenticationï¼Œå®ƒä¿å­˜äº†éªŒè¯æœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠç»è¿‡æˆ‘ä»¬ä¹‹å‰çš„ç™»é™†æµç¨‹ä¹‹åï¼ŒéªŒè¯æœåŠ¡å™¨å‘æ”¾ç»™å®¢æˆ·ç«¯çš„Tokenä¿¡æ¯ï¼Œå¹¶é€šè¿‡Tokenä¿¡æ¯åœ¨éªŒè¯æœåŠ¡å™¨è¿›è¡ŒéªŒè¯è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæœ€åä¿å­˜åˆ°Sessionä¸­ï¼Œè¡¨ç¤ºç”¨æˆ·å·²éªŒè¯ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯è¦ä¾èµ–æµè§ˆå™¨å­˜Cookieçš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡éƒ½ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡ŒéªŒè¯ï¼Œåˆ«å¿˜äº†æŠŠé‡å®šå‘åœ°å€ç»™æ‰€æœ‰æœåŠ¡éƒ½åŠ ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">ClientDetailsServiceConfigurer</span><span class="w"> </span><span class="n">clients</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">clients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">inMemory</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">withClient</span><span class="p">(</span><span class="s">&#34;web&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">secret</span><span class="p">(</span><span class="n">encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="s">&#34;654321&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">autoApprove</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">   </span><span class="c1">//è¿™é‡ŒæŠŠè‡ªåŠ¨å®¡æ‰¹å¼€äº†ï¼Œå°±ä¸ç”¨å†å»æ‰‹åŠ¨é€‰åŒæ„äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">scopes</span><span class="p">(</span><span class="s">&#34;book&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;borrow&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">redirectUris</span><span class="p">(</span><span class="s">&#34;http://localhost:8101/login&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;http://localhost:8201/login&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;http://localhost:8301/login&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">authorizedGrantTypes</span><span class="p">(</span><span class="s">&#34;client_credentials&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;password&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;implicit&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;authorization_code&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;refresh_token&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°åªåœ¨éªŒè¯æœåŠ¡å™¨ç™»é™†ï¼Œå¦‚æœç™»é™†è¿‡å…¶ä»–çš„æœåŠ¡éƒ½å¯ä»¥è®¿é—®äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç”±äºSESSIONä¸åŒæ­¥ï¼Œæ¯æ¬¡åˆ‡æ¢ä¸åŒçš„æœåŠ¡è¿›è¡Œè®¿é—®éƒ½ä¼šé‡æ–°å¯¼éªŒè¯æœåŠ¡å™¨å»éªŒè¯ä¸€æ¬¡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/7zbqlOrSCVRdQ4y.png" alt="image-20230306235744660" />
    
  </figure>

</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p>
<ul>
<li>åƒä¹‹å‰ä¸€æ ·åšSESSIONç»Ÿä¸€å­˜å‚¨</li>
<li>è®¾ç½®context-pathè·¯å¾„ï¼Œæ¯ä¸ªæœåŠ¡å•ç‹¬è®¾ç½®ï¼Œå°±ä¸ä¼šæ‰“æ¶äº†</li>
</ul>
<p>ä½†æ˜¯è¿™æ ·ä¾ç„¶æ²¡æ³•è§£å†³æœåŠ¡é—´è°ƒç”¨çš„é—®é¢˜ï¼Œæ‰€ä»¥ä»…ä»…ä¾é å•ç‚¹ç™»é™†çš„æ¨¡å¼ä¸å¤ªè¡Œã€‚</p>


<h3 class="relative group">åŸºäº@EnableResourceServerå®ç° 
    <div id="%E5%9F%BA%E4%BA%8Eenableresourceserver%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%9F%BA%E4%BA%8Eenableresourceserver%E5%AE%9E%E7%8E%B0" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬è®²è§£äº†å°†æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºå•ç‚¹ç™»é™†åº”ç”¨ç›´æ¥å®ç°å•ç‚¹ç™»é™†ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¦‚æœæ˜¯ä»¥ç¬¬ä¸‰æ–¹åº”ç”¨è¿›è¡Œè®¿é—®å‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å°†æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºèµ„æºæœåŠ¡äº†ï¼Œä½œä¸ºèµ„æºæœåŠ¡å°±ä¸ä¼šå†æä¾›éªŒè¯çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥è¦æ±‚è¯·æ±‚æ—¶æºå¸¦Tokenï¼Œè€ŒéªŒè¯è¿‡ç¨‹æˆ‘ä»¬è¿™é‡Œå°±ç»§ç»­ç”¨Postmanæ¥å®Œæˆï¼Œè¿™æ‰æ˜¯æˆ‘ä»¬å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>ä¸€å¥è¯æ¥è¯´ï¼Œè·Ÿä¸Šé¢ç›¸æ¯”ï¼Œæˆ‘ä»¬åªéœ€è¦æºå¸¦Tokenå°±èƒ½è®¿é—®è¿™äº›èµ„æºæœåŠ¡å™¨äº†ï¼Œå®¢æˆ·ç«¯è¢«ç‹¬ç«‹äº†å‡ºæ¥ï¼Œç”¨äºæºå¸¦Tokenå»è®¿é—®è¿™äº›æœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿåªéœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨è§£å’Œå°‘é‡é…ç½®å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableResourceServer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">BookApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>é…ç½®ä¸­åªéœ€è¦ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">oauth2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c">#åŸºæ“</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">client-id</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">client-secret</span><span class="p">:</span><span class="w"> </span><span class="m">654321</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c">#å› ä¸ºèµ„æºæœåŠ¡å™¨å¾—éªŒè¯ä½ çš„Tokenæ˜¯å¦æœ‰è®¿é—®æ­¤èµ„æºçš„æƒé™ä»¥åŠç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ä¸ªéªŒè¯åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">token-info-uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8500/sso/oauth/check_token</span><span class="w">
</span></span></span></code></pre></div><p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨ï¼Œç›´æ¥è®¿é—®ä¼šå‘ç°ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/QiZmqznyMxNpETk.png" alt="image-20230306235756676" />
    
  </figure>

</p>
<p>è¿™æ˜¯ç”±äºæˆ‘ä»¬çš„è¯·æ±‚å¤´ä¸­æ²¡æœ‰æºå¸¦Tokenä¿¡æ¯ï¼Œç°åœ¨æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¿é—®æ­¤èµ„æºï¼š</p>
<ul>
<li>åœ¨URLåé¢æ·»åŠ <code>access_token</code>è¯·æ±‚å‚æ•°ï¼Œå€¼ä¸ºTokenå€¼</li>
<li>åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ <code>Authorization</code>ï¼Œå€¼ä¸º<code>Bearer +Tokenå€¼</code></li>
</ul>
<p>æˆ‘ä»¬å…ˆæ¥è¯•è¯•çœ‹æœ€ç®€çš„ä¸€ç§ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Np6PKCZD2kAdmtf.png" alt="image-20230306235804196" />
    
  </figure>

</p>
<p>å¦ä¸€ç§æˆ‘ä»¬éœ€è¦ä½¿ç”¨Postmanæ¥å®Œæˆï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/ypR3G7DxsYicMQI.png" alt="image-20230306235814228" />
    
  </figure>

</p>
<p>æ·»åŠ éªŒè¯ä¿¡æ¯åï¼Œä¼šå¸®åŠ©æˆ‘ä»¬è½¬æ¢æˆè¯·æ±‚å¤´ä¿¡æ¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/qPHDU1dXgC7srn3.png" alt="image-20230306235826416" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/6IeMvTcCKdfbUlV.png" alt="image-20230306235833330" />
    
  </figure>

</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å°†èµ„æºæœåŠ¡å™¨æ­å»ºå®Œæˆäº†ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•å¯¹èµ„æºæœåŠ¡å™¨è¿›è¡Œæ·±åº¦è‡ªå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›ç”¨æˆ·æˆæƒäº†æŸä¸ªScopeæ‰å¯ä»¥è®¿é—®æ­¤æœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ResourceConfiguration</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ResourceServerConfigurerAdapter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//ç»§æ‰¿æ­¤ç±»è¿›è¡Œé«˜åº¦è‡ªå®šä¹‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">//è¿™é‡Œä¹Ÿæœ‰HttpSecurityå¯¹è±¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬é…ç½®SpringSecurity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authorizeRequests</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">access</span><span class="p">(</span><span class="s">&#34;#oauth2.hasScope(&#39;lbwnb&#39;)&#34;</span><span class="p">);</span><span class="w">  </span><span class="c1">//æ·»åŠ è‡ªå®šä¹‰è§„åˆ™</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      					</span><span class="c1">//Tokenå¿…é¡»è¦æœ‰æˆ‘ä»¬è‡ªå®šä¹‰scopeæˆæƒæ‰å¯ä»¥è®¿é—®æ­¤èµ„æº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°å½“æ²¡æœ‰å¯¹åº”çš„scopeæˆæƒæ—¶ï¼Œé‚£ä¹ˆä¼šç›´æ¥è¿”å›<code>insufficient_scope</code>é”™è¯¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/5T4d39YkcZIomvD.png" alt="image-20230306235844783" />
    
  </figure>

</p>
<p>ä¸çŸ¥é“å„ä½æ˜¯å¦æœ‰å‘ç°ï¼Œå®é™…ä¸Šèµ„æºæœåŠ¡å™¨å®Œå…¨æ²¡æœ‰å¿…è¦å°†Securityçš„ä¿¡æ¯ä¿å­˜åœ¨Sessionä¸­äº†ï¼Œå› ä¸ºç°åœ¨åªéœ€è¦å°†Tokenå‘Šè¯‰èµ„æºæœåŠ¡å™¨ï¼Œé‚£ä¹ˆèµ„æºæœåŠ¡å™¨å°±å¯ä»¥è”ç³»éªŒè¯æœåŠ¡å™¨ï¼Œå¾—åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨ä¹‹å‰çš„Sessionå­˜å‚¨æœºåˆ¶äº†ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°HttpSessionä¸­æ²¡æœ‰<strong>SPRING_SECURITY_CONTEXT</strong>ï¼Œç°åœ¨Securityä¿¡æ¯éƒ½æ˜¯é€šè¿‡è¿æ¥èµ„æºæœåŠ¡å™¨è·å–ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡éƒ½</p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨RestTemplateè¿›è¡ŒæœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨æ—¶ï¼Œä¼šå¾—åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/k3LmR9E7UBtVA5x.png" alt="image-20230306235853397" />
    
  </figure>

</p>
<p>å®é™…ä¸Šè¿™æ˜¯å› ä¸ºåœ¨æœåŠ¡è°ƒç”¨æ—¶æ²¡æœ‰æºå¸¦Tokenä¿¡æ¯ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸ªåŠæ³•æŠŠç”¨æˆ·ä¼ æ¥çš„Tokenä¿¡æ¯åœ¨è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ä¹Ÿæºå¸¦ä¸Šï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨OAuth2RestTemplateï¼Œå®ƒä¼šåœ¨è¯·æ±‚å…¶ä»–æœåŠ¡æ—¶æºå¸¦å½“å‰è¯·æ±‚çš„Tokenä¿¡æ¯ã€‚å®ƒç»§æ‰¿è‡ªRestTemplateï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å®šä¹‰ä¸€ä¸ªBeanï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OAuth2ClientContext</span><span class="w"> </span><span class="n">context</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OAuth2RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OAuth2RestTemplate</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ClientCredentialsResourceDetails</span><span class="p">(),</span><span class="w"> </span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬ç›´æ¥æ›¿æ¢æ‰ä¹‹å‰çš„RestTemplateå³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BorrowService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BorrowMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OAuth2RestTemplate</span><span class="w"> </span><span class="n">template</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">getUserBorrowDetailByUid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Borrow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrowsByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">template</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="s">&#34;http://localhost:8101/user/&#34;</span><span class="o">+</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">User</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//è·å–æ¯ä¸€æœ¬ä¹¦çš„è¯¦ç»†ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borrow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">template</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="s">&#34;http://localhost:8201/book/&#34;</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="na">getBid</span><span class="p">(),</span><span class="w"> </span><span class="n">Book</span><span class="p">.</span><span class="na">class</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">bookList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°æœåŠ¡æˆåŠŸè°ƒç”¨äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/mvKqyJk7P1FCQSl.png" alt="image-20230306235903496" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥å°†NacosåŠ å…¥ï¼Œå¹¶é€šè¿‡Feignå®ç°è¿œç¨‹è°ƒç”¨ã€‚</p>
<p>ä¾èµ–è¿˜æ˜¯è´´ä¸€ä¸‹ï¼Œä¸ç„¶æ‰¾ä¸åˆ°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2021.0.1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>æ‰€æœ‰æœåŠ¡éƒ½å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/BqkomFVGK7wv64X.png" alt="image-20230306235926214" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬é…ç½®ä¸€ä¸‹å€Ÿé˜…æœåŠ¡çš„è´Ÿè½½å‡è¡¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OAuth2ClientContext</span><span class="w"> </span><span class="n">context</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@LoadBalanced</span><span class="w">   </span><span class="c1">//å’ŒRestTemplateä¸€æ ·ç›´æ¥æ·»åŠ æ³¨è§£å°±è¡Œäº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OAuth2RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OAuth2RestTemplate</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ClientCredentialsResourceDetails</span><span class="p">(),</span><span class="w"> </span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/PZkS8GyU1jhpIrz.png" alt="image-20230306235934751" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥æŠŠå®ƒæ›¿æ¢ä¸ºFeignï¼Œè€æ ·å­ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;user-service&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;book-service&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Book</span><span class="w"> </span><span class="nf">getBookById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ä½†æ˜¯é…ç½®å®Œæˆä¹‹åï¼Œåˆå‡ºç°åˆšåˆšçš„é—®é¢˜äº†ï¼ŒOpenFeignä¹Ÿæ²¡æœ‰æºå¸¦Tokenè¿›è¡Œè®¿é—®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/EzWuaAJgNLi3sdF.png" alt="image-20230306235944272" />
    
  </figure>

</p>
<p>é‚£ä¹ˆæ€ä¹ˆé…ç½®Feignæºå¸¦Tokenè®¿é—®å‘¢ï¼Ÿé‡åˆ°è¿™ç§é—®é¢˜ç›´æ¥å»å®˜æ–¹æŸ¥ï¼šhttps://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/#oauth2-supportï¼Œéå¸¸ç®€å•ï¼Œä¸¤ä¸ªé…ç½®å°±æå®šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">feign</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">oauth2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c">#å¼€å¯Oauthæ”¯æŒï¼Œè¿™æ ·å°±ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Tokenäº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c">#åŒæ—¶å¼€å¯è´Ÿè½½å‡è¡¡æ”¯æŒ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">load-balanced</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>é‡å¯æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœOKäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/zgEJF7AeHw8iGIZ.png" alt="image-20230306235953555" />
    
  </figure>

</p>
<p>è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸå°†ä¹‹å‰çš„ä¸‰ä¸ªæœåŠ¡ä½œä¸ºèµ„æºæœåŠ¡å™¨äº†ï¼Œæ³¨æ„å’Œæˆ‘ä»¬ä¸Šé¢çš„ä½œä¸ºå®¢æˆ·ç«¯æ˜¯ä¸åŒçš„ï¼Œå°†æœåŠ¡ç›´æ¥ä½œä¸ºå®¢æˆ·ç«¯ç›¸å½“äºåªéœ€è¦éªŒè¯é€šè¿‡å³å¯ï¼Œå¹¶ä¸”è¿˜æ˜¯è¦ä¿å­˜Sessionä¿¡æ¯ï¼Œç›¸å½“äºåªæ˜¯å°†ç™»å½•æµç¨‹æ¢åˆ°ç»Ÿä¸€çš„éªŒè¯æœåŠ¡å™¨ä¸Šè¿›è¡Œç½¢äº†ã€‚è€Œå°†å…¶ä½œä¸ºèµ„æºæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦å¦å¤–æ‰¾å®¢æˆ·ç«¯ï¼ˆå¯ä»¥æ˜¯æµè§ˆå™¨ã€å°ç¨‹åºã€Appã€ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ï¼‰æ¥è®¿é—®ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯éœ€è¦å…ˆè¿›è¡ŒéªŒè¯ç„¶åå†é€šè¿‡æºå¸¦Tokenè¿›è¡Œè®¿é—®ï¼Œè¿™ç§æ¨¡å¼æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„æ¨¡å¼ã€‚</p>


<h3 class="relative group">ä½¿ç”¨jwtå­˜å‚¨Token 
    <div id="%E4%BD%BF%E7%94%A8jwt%E5%AD%98%E5%82%A8token" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%BD%BF%E7%94%A8jwt%E5%AD%98%E5%82%A8token" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å®˜ç½‘ï¼šhttps://jwt.io</p>
<p>JSON Web Tokenä»¤ç‰Œï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆ<a href="https://tools.ietf.org/html/rfc7519"   target="_blank">
    RFC 7519</a>ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘å’Œè‡ªæˆä¸€ä½“çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä½œä¸ºJSONå¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚JWTå¯ä»¥ä½¿ç”¨å¯†é’¥ï¼ˆä½¿ç”¨<strong>HMAC</strong>ç®—æ³•ï¼‰æˆ–ä½¿ç”¨<strong>RSA</strong>æˆ–<strong>ECDSA</strong>è¿›è¡Œå…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åã€‚</p>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯æºå¸¦Tokenå‘èµ„æºæœåŠ¡å™¨å‘èµ·è¯·æ±‚åï¼Œèµ„æºæœåŠ¡å™¨ç”±äºä¸çŸ¥é“æˆ‘ä»¬Tokençš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦å‘éªŒè¯æœåŠ¡å™¨è¯¢é—®æ­¤Tokençš„è®¤è¯ä¿¡æ¯ï¼Œè¿™æ ·æ‰èƒ½å¾—åˆ°Tokenä»£è¡¨çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯å„ä½æ˜¯å¦è€ƒè™‘è¿‡ï¼Œå¦‚æœæ¯æ¬¡ç”¨æˆ·è¯·æ±‚éƒ½å»æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨å¤§é‡è¯·æ±‚ä¸‹ï¼ŒéªŒè¯æœåŠ¡å™¨çš„å‹åŠ›å¯èƒ½ä¼šéå¸¸çš„å¤§ã€‚è€Œä½¿ç”¨JWTä¹‹åï¼ŒTokenä¸­ä¼šç›´æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ ·èµ„æºæœåŠ¡å™¨å°±ä¸å†éœ€è¦è¯¢é—®éªŒè¯æœåŠ¡å™¨ï¼Œè‡ªè¡Œå°±å¯ä»¥å®Œæˆè§£æï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸è”ç³»éªŒè¯æœåŠ¡å™¨å°±èƒ½ç›´æ¥å®ŒæˆéªŒè¯ã€‚</p>
<p>JWTä»¤ç‰Œçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/Xu8lxYhKoJNr6it.png" alt="image-20230307000004710" />
    
  </figure>

</p>
<p>ä¸€ä¸ªJWTä»¤ç‰Œç”±3éƒ¨åˆ†ç»„æˆï¼šæ ‡å¤´(Header)ã€æœ‰æ•ˆè½½è·(Payload)å’Œç­¾å(Signature)ã€‚åœ¨ä¼ è¾“çš„æ—¶å€™ï¼Œä¼šå°†JWTçš„3éƒ¨åˆ†åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç åç”¨<code>.</code>è¿›è¡Œè¿æ¥å½¢æˆæœ€ç»ˆéœ€è¦ä¼ è¾“çš„å­—ç¬¦ä¸²ã€‚</p>
<ul>
<li>æ ‡å¤´ï¼šåŒ…å«ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚JWTç­¾åæ‰€ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œè¿˜æœ‰ç±»å‹ï¼Œè¿™é‡Œç»Ÿä¸€éƒ½æ˜¯JWTã€‚</li>
<li>æœ‰æ•ˆè½½è·ï¼šåŒ…æ‹¬ç”¨æˆ·åç§°ã€ä»¤ç‰Œå‘å¸ƒæ—¶é—´ã€è¿‡æœŸæ—¶é—´ã€JWT IDç­‰ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ·»åŠ å­—æ®µï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ä¿¡æ¯ä¸€èˆ¬éƒ½åœ¨è¿™é‡Œå­˜æ”¾ã€‚</li>
<li>ç­¾åï¼šé¦–å…ˆéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼Œè¯¥å¯†é’¥ä»…ä»…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œä¿è¯ä¸èƒ½è®©å…¶ä»–ç”¨æˆ·çŸ¥é“ã€‚ç„¶åä½¿ç”¨Headerä¸­æŒ‡å®šçš„ç®—æ³•å¯¹Headerå’ŒPayloadè¿›è¡Œbase64åŠ å¯†ä¹‹åçš„ç»“æœé€šè¿‡å¯†é’¥è®¡ç®—å“ˆå¸Œå€¼ï¼Œç„¶åå°±å¾—å‡ºä¸€ä¸ªç­¾åå“ˆå¸Œã€‚è¿™ä¸ªä¼šç”¨äºä¹‹åéªŒè¯å†…å®¹æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</li>
</ul>
<p>è¿™é‡Œè¿˜æ˜¯è¡¥å……ä¸€ä¸‹ä¸€äº›æ¦‚å¿µï¼Œå› ä¸ºå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡çš„ï¼š</p>
<ul>
<li>
<p><strong>Base64ï¼š</strong> å°±æ˜¯åŒ…æ‹¬å°å†™å­—æ¯a-zã€å¤§å†™å­—æ¯A-Zã€æ•°å­—0-9ã€ç¬¦å·&quot;+&quot;ã€&quot;/&ldquo;ä¸€å…±64ä¸ªå­—ç¬¦çš„å­—ç¬¦é›†ï¼ˆæœ«å°¾è¿˜æœ‰1ä¸ªæˆ–å¤šä¸ª<code>=</code>ç”¨æ¥å‡‘å¤Ÿå­—èŠ‚æ•°ï¼‰ï¼Œä»»ä½•çš„ç¬¦å·éƒ½å¯ä»¥è½¬æ¢æˆè¿™ä¸ªå­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹å°±å«åšBase64ç¼–ç ï¼Œç¼–ç ä¹‹åä¼šç”ŸæˆåªåŒ…å«ä¸Šè¿°64ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ç›¸åï¼Œå¦‚æœéœ€è¦åŸæœ¬çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡ŒBase64è§£ç ï¼Œå›åˆ°åŸæœ‰çš„æ ·å­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;ä½ ä»¬å¯èƒ½ä¸çŸ¥é“åªç”¨20ä¸‡èµ¢åˆ°578ä¸‡æ˜¯ä»€ä¹ˆæ¦‚å¿µ&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c1">//Base64ä¸åªæ˜¯å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œä»»ä½•byte[]æ•°æ®éƒ½å¯ä»¥ï¼Œç¼–ç ç»“æœå¯ä»¥æ˜¯byte[]ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">encodeStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">getEncoder</span><span class="p">().</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Base64ç¼–ç åçš„å­—ç¬¦ä¸²ï¼š&#34;</span><span class="o">+</span><span class="n">encodeStr</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è§£ç åçš„å­—ç¬¦ä¸²ï¼š&#34;</span><span class="o">+</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">Base64</span><span class="p">.</span><span class="na">getDecoder</span><span class="p">().</span><span class="na">decode</span><span class="p">(</span><span class="n">encodeStr</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ³¨æ„Base64ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œåªæ˜¯ä¸€ç§ä¿¡æ¯çš„ç¼–ç æ–¹å¼è€Œå·²ã€‚</p>
</li>
<li>
<p><strong>åŠ å¯†ç®—æ³•ï¼š</strong> åŠ å¯†ç®—æ³•åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œå…¶ä¸­**å¯¹ç§°åŠ å¯†ï¼ˆSymmetric Cryptographyï¼‰**æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±åƒä¸€æŠŠé”é…äº†ä¸¤æŠŠé’¥åŒ™ä¸€æ ·ï¼Œè¿™ä¸¤æŠŠé’¥åŒ™ä½ å’Œåˆ«äººéƒ½æœ‰ä¸€æŠŠï¼Œç„¶åä½ ä»¬ç›´æ¥ä¼ é€’æ•°æ®ï¼Œéƒ½ä¼šæŠŠæ•°æ®ç”¨é”ç»™é”ä¸Šï¼Œå°±ç®—ä¼ é€’çš„é€”ä¸­æœ‰äººæŠŠæ•°æ®çªƒå–äº†ï¼Œä¹Ÿæ²¡åŠæ³•è§£å¯†ï¼Œå› ä¸ºé’¥åŒ™åªæœ‰ä½ å’Œå¯¹æ–¹æœ‰ï¼Œæ²¡æœ‰é’¥åŒ™æ— æ³•è¿›è¡Œè§£å¯†ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶è§£å¯†çš„å…³é”®åœ¨äºé’¥åŒ™æœ¬èº«ï¼Œé‚£ä¹ˆå¦‚æœæœ‰äººä¸ä»…çªƒå–äº†æ•°æ®ï¼Œè€Œä¸”å¯¹æ–¹é‚£è¾¹çš„æ²»å®‰ä¹Ÿä¸å¥½ï¼Œäºæ˜¯é¡ºæ‰‹å°±å·èµ°äº†é’¥åŒ™ï¼Œé‚£ä½ ä»¬ä¹‹é—´å‘çš„æ•°æ®ä¸å°±å‡‰å‡‰äº†å—ã€‚</p>
<p>å› æ­¤ï¼Œ**éå¯¹ç§°åŠ å¯†ï¼ˆAsymmetric Cryptographyï¼‰**ç®—æ³•å‡ºç°äº†ï¼Œå®ƒå¹¶ä¸æ˜¯ç›´æ¥ç”Ÿæˆä¸€æŠŠé’¥åŒ™ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ï¼Œç§é’¥åªèƒ½ç”±ä½ ä¿ç®¡ï¼Œè€Œå…¬é’¥äº¤ç»™å¯¹æ–¹æˆ–æ˜¯ä½ è¦å‘é€çš„ä»»ä½•äººéƒ½è¡Œï¼Œç°åœ¨ä½ éœ€è¦æŠŠæ•°æ®ä¼ ç»™å¯¹æ–¹ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ç§é’¥è¿›è¡ŒåŠ å¯†ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ•°æ®åªèƒ½ä½¿ç”¨å¯¹åº”çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œç›¸åï¼Œå¦‚æœå¯¹æ–¹éœ€è¦ç»™ä½ å‘é€æ•°æ®ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œè€Œæ•°æ®åªèƒ½ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè¿™æ ·çš„è¯å°±ç®—å¯¹æ–¹çš„å…¬é’¥è¢«çªƒå–ï¼Œé‚£ä¹ˆåˆ«äººå‘ç»™ä½ çš„æ•°æ®ä¹Ÿæ²¡åŠæ³•è§£å¯†å‡ºæ¥ï¼Œå› ä¸ºéœ€è¦ç§é’¥æ‰èƒ½è§£å¯†ï¼Œè€Œåªæœ‰ä½ æ‰æœ‰ç§é’¥ã€‚</p>
<p>å› æ­¤ï¼Œéå¯¹ç§°åŠ å¯†çš„å®‰å…¨æ€§ä¼šæ›´é«˜ä¸€äº›ï¼ŒåŒ…æ‹¬HTTPSçš„éšç§ä¿¡æ¯æ­£æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ¥ä¿éšœä¼ è¾“æ•°æ®çš„å®‰å…¨ï¼ˆå½“ç„¶HTTPSå¹¶ä¸æ˜¯å•çº¯åœ°ä½¿ç”¨éå¯¹ç§°åŠ å¯†å®Œæˆçš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹ï¼‰</p>
<p>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†éƒ½æœ‰å¾ˆå¤šçš„ç®—æ³•ï¼Œæ¯”å¦‚å¯¹ç§°åŠ å¯†ï¼Œå°±æœ‰ï¼šDESã€IDEAã€RC2ï¼Œéå¯¹ç§°åŠ å¯†æœ‰ï¼šRSAã€DASã€ECC</p>
</li>
<li>
<p><strong>ä¸å¯é€†åŠ å¯†ç®—æ³•ï¼š</strong> å¸¸è§çš„ä¸å¯é€†åŠ å¯†ç®—æ³•æœ‰MD5, HMAC, SHA-1, SHA-224, SHA-256, SHA-384, å’ŒSHA-512, å…¶ä¸­SHA-224ã€SHA-256ã€SHA-384ï¼Œå’ŒSHA-512æˆ‘ä»¬å¯ä»¥ç»Ÿç§°ä¸ºSHA2åŠ å¯†ç®—æ³•ï¼ŒSHAåŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§è¦æ¯”MD5æ›´é«˜ï¼Œè€ŒSHA2åŠ å¯†ç®—æ³•æ¯”SHA1çš„è¦é«˜ï¼Œå…¶ä¸­SHAåé¢çš„æ•°å­—è¡¨ç¤ºçš„æ˜¯åŠ å¯†åçš„å­—ç¬¦ä¸²é•¿åº¦ï¼ŒSHA1é»˜è®¤ä¼šäº§ç”Ÿä¸€ä¸ª160ä½çš„ä¿¡æ¯æ‘˜è¦ã€‚ç»è¿‡ä¸å¯é€†åŠ å¯†ç®—æ³•å¾—åˆ°çš„åŠ å¯†ç»“æœï¼Œæ˜¯æ— æ³•è§£å¯†å›å»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åŠ å¯†å‡ºæ¥æ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆäº†ã€‚æœ¬è´¨ä¸Šï¼Œå…¶å°±æ˜¯ä¸€ç§å“ˆå¸Œå‡½æ•°ï¼Œç”¨äºå¯¹ä¸€æ®µä¿¡æ¯äº§ç”Ÿæ‘˜è¦ï¼Œä»¥<strong>é˜²æ­¢è¢«ç¯¡æ”¹</strong>ã€‚</p>
<p>å®é™…ä¸Šè¿™ç§ç®—æ³•å°±å¸¸å¸¸è¢«ç”¨ä½œä¿¡æ¯æ‘˜è¦è®¡ç®—ï¼ŒåŒæ ·çš„æ•°æ®é€šè¿‡åŒæ ·çš„ç®—æ³•è®¡ç®—å¾—åˆ°çš„ç»“æœè‚¯å®šä¹Ÿä¸€æ ·ï¼Œè€Œå¦‚æœæ•°æ®è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆè®¡ç®—çš„ç»“æœè‚¯å®šå°±ä¸ä¸€æ ·äº†ã€‚</p>
</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨jwtï¼Œå°†æˆ‘ä»¬çš„Tokené‡‡ç”¨æ–°çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/W95CFKAmd1wfgSJ.png" alt="image-20230307000016944" />
    
  </figure>

</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ï¼Œå¯¹ç§°å¯†é’¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹éªŒè¯æœåŠ¡å™¨è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">JwtAccessTokenConverter</span><span class="w"> </span><span class="nf">tokenConverter</span><span class="p">(){</span><span class="w">  </span><span class="c1">//Tokenè½¬æ¢å™¨ï¼Œå°†å…¶è½¬æ¢ä¸ºJWT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">JwtAccessTokenConverter</span><span class="w"> </span><span class="n">converter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JwtAccessTokenConverter</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">converter</span><span class="p">.</span><span class="na">setSigningKey</span><span class="p">(</span><span class="s">&#34;lbwnb&#34;</span><span class="p">);</span><span class="w">   </span><span class="c1">//è¿™ä¸ªæ˜¯å¯¹ç§°å¯†é’¥ï¼Œä¸€ä¼šèµ„æºæœåŠ¡å™¨é‚£è¾¹ä¹Ÿè¦æŒ‡å®šä¸ºè¿™ä¸ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">converter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">TokenStore</span><span class="w"> </span><span class="nf">tokenStore</span><span class="p">(</span><span class="n">JwtAccessTokenConverter</span><span class="w"> </span><span class="n">converter</span><span class="p">){</span><span class="w">  </span><span class="c1">//Tokenå­˜å‚¨æ–¹å¼ç°åœ¨æ”¹ä¸ºJWTå­˜å‚¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JwtTokenStore</span><span class="p">(</span><span class="n">converter</span><span class="p">);</span><span class="w">  </span><span class="c1">//ä¼ å…¥åˆšåˆšå®šä¹‰å¥½çš„è½¬æ¢å™¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">TokenStore</span><span class="w"> </span><span class="n">store</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">JwtAccessTokenConverter</span><span class="w"> </span><span class="n">converter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">AuthorizationServerTokenServices</span><span class="w"> </span><span class="nf">serverTokenServices</span><span class="p">(){</span><span class="w">  </span><span class="c1">//è¿™é‡Œå¯¹AuthorizationServerTokenServicesè¿›è¡Œä¸€ä¸‹é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DefaultTokenServices</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultTokenServices</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">services</span><span class="p">.</span><span class="na">setSupportRefreshToken</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">   </span><span class="c1">//å…è®¸Tokenåˆ·æ–°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">services</span><span class="p">.</span><span class="na">setTokenStore</span><span class="p">(</span><span class="n">store</span><span class="p">);</span><span class="w">   </span><span class="c1">//æ·»åŠ åˆšåˆšçš„TokenStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">services</span><span class="p">.</span><span class="na">setTokenEnhancer</span><span class="p">(</span><span class="n">converter</span><span class="p">);</span><span class="w">   </span><span class="c1">//æ·»åŠ Tokenå¢å¼ºï¼Œå…¶å®å°±æ˜¯JwtAccessTokenConverterï¼Œå¢å¼ºæ˜¯æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ•°æ®åˆ°JWTä¸­</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">services</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">AuthorizationServerEndpointsConfigurer</span><span class="w"> </span><span class="n">endpoints</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">tokenServices</span><span class="p">(</span><span class="n">serverTokenServices</span><span class="p">())</span><span class="w">   </span><span class="c1">//è®¾å®šä¸ºåˆšåˆšé…ç½®å¥½çš„AuthorizationServerTokenServices</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">userDetailsService</span><span class="p">(</span><span class="n">service</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">authenticationManager</span><span class="p">(</span><span class="n">manager</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é‡å¯éªŒè¯æœåŠ¡å™¨äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/C6OteoFghrxpYjQ.png" alt="image-20230307000026772" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè·å–äº†AccessTokenï¼Œä½†æ˜¯è¿™é‡Œçš„æ ¼å¼è·Ÿæˆ‘ä»¬ä¹‹å‰çš„æ ¼å¼å°±å¤§ä¸ç›¸åŒäº†ï¼Œå› ä¸ºç°åœ¨å®ƒæ˜¯JWTä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¸€ä¸‹Base64è§£ç ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/CUMkrRfgOthZKVz.png" alt="image-20230307000035581" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„éªŒè¯ä¿¡æ¯åŒ…å«åœ¨å†…ï¼Œç°åœ¨æˆ‘ä»¬å¯¹èµ„æºæœåŠ¡å™¨è¿›è¡Œé…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">oauth2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">jwt</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key-value</span><span class="p">:</span><span class="w"> </span><span class="l">lbwnb</span><span class="w"> </span><span class="c">#æ³¨æ„è¿™é‡Œè¦è·ŸéªŒè¯æœåŠ¡å™¨çš„å¯†é’¥ä¸€è‡´ï¼Œè¿™æ ·ç®—å‡ºæ¥çš„ç­¾åæ‰ä¼šä¸€è‡´</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åå¯åŠ¨èµ„æºæœåŠ¡å™¨ï¼Œè¯·æ±‚ä¸€ä¸‹æ¥å£è¯•è¯•çœ‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/kOpRlTB7SPtQa4y.png" alt="image-20230307000043443" />
    
  </figure>

</p>
<p>è¯·æ±‚æˆåŠŸï¼Œå¾—åˆ°æ•°æ®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/aicW89KezTSZ7f5.png" alt="image-20230307000053404" />
    
  </figure>

</p>
<p>æ³¨æ„å¦‚æœTokenæœ‰è¯¯ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/4wFZx8kNY5WHnvy.png" alt="image-20230307000101304" />
    
  </figure>

</p>
<hr>


<h2 class="relative group">Redisä¸åˆ†å¸ƒå¼ 
    <div id="redis%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#redis%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p>åœ¨SpringBooté˜¶æ®µï¼Œæˆ‘ä»¬å­¦ä¹ äº†Redisï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ€§èƒ½æ•°æ®åº“ï¼Œæˆ‘ä»¬å½“æ—¶å·²ç»å­¦ä¹ äº†åŒ…æ‹¬åŸºæœ¬æ“ä½œã€å¸¸ç”¨æ•°æ®ç±»å‹ã€æŒä¹…åŒ–ã€äº‹åŠ¡å’Œé”æœºåˆ¶ä»¥åŠä½¿ç”¨Javaä¸Redisè¿›è¡Œäº¤äº’ç­‰ï¼Œåˆ©ç”¨å®ƒçš„é«˜æ€§èƒ½ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨å®ƒæ¥åšMybatisçš„äºŒçº§ç¼“å­˜ã€ä»¥åŠTokençš„æŒä¹…åŒ–å­˜å‚¨ã€‚è€Œè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥ï¼Œæ¢è®¨Redisåœ¨åˆ†å¸ƒå¼å¼€å‘åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚</p>


<h3 class="relative group">ä¸»ä»å¤åˆ¶ 
    <div id="%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘è®©Rediså®ç°ä¸»ä»æ¨¡å¼ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/bzwPflgBD5O1saN.png" alt="image-20230307000109568" />
    
  </figure>

</p>
<p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(Master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(Slave)ï¼Œæ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚Masterä»¥å†™ä¸ºä¸»ï¼ŒSlave ä»¥è¯»ä¸ºä¸»ã€‚</p>
<p>è¿™æ ·çš„å¥½å¤„è‚¯å®šæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p>
<ul>
<li>å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li>
<li>åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å®‰æ’å¾ˆå¤šä¸ªä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå¤§å¹…åº¦çš„åˆ†æ‹…å‹åŠ›ï¼Œå¹¶ä¸”å°±ç®—æŒ‚æ‰ä¸€ä¸ªï¼Œå…¶ä»–çš„ä¹Ÿèƒ½ä½¿ç”¨ã€‚</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±æ¥å°è¯•å®ç°ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯åœ¨Windowsä¸‹è¿›è¡Œæµ‹è¯•ï¼Œæ‰“å¼€Redisæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬è¦å¼€å¯ä¸¤ä¸ªRedisæœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶<code>redis.windows.conf</code>ï¼š</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf"># Accept connections on the specified port, default is 6379 (IANA #815344).
# If port 0 is specified Redis will not listen on a TCP socket.
port 6001
</code></pre><p>ä¸€ä¸ªæœåŠ¡å™¨çš„ç«¯å£è®¾å®šä¸º6001ï¼Œå¤åˆ¶ä¸€ä»½ï¼Œå¦ä¸€ä¸ªçš„ç«¯å£ä¸º6002ï¼Œæ¥ç€æˆ‘ä»¬æŒ‡å®šé…ç½®æ–‡ä»¶è¿›è¡Œå¯åŠ¨ï¼Œæ‰“å¼€cmdï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/Si54lok9eqtKPf1.png" alt="image-20230307000143566" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬çš„ä¸¤ä¸ªæœåŠ¡å™¨å°±å¯åŠ¨æˆåŠŸäº†ï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„ä¸»ä»çŠ¶æ€ï¼Œæˆ‘ä»¬æ‰“å¼€å®¢æˆ·ç«¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/2TbMQeZknSOzFpy.png" alt="image-20230307000151282" />
    
  </figure>

</p>
<p>è¾“å…¥<code>info replication</code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„ä¸»ä»çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„è§’è‰²ä¸ºï¼šmasterï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨å¯åŠ¨ä¹‹åéƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ã€‚é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¸Œæœ›è®©6002ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤å³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/XqpNcihJ5jsZRoI.png" alt="image-20230307000200296" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¾“å…¥<code>replicaof 127.0.0.1 6001</code>å‘½ä»¤åï¼Œå°±ä¼šå°†6001æœåŠ¡å™¨ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œè€Œå½“å‰èŠ‚ç‚¹ä½œä¸º6001çš„ä»èŠ‚ç‚¹ï¼Œå¹¶ä¸”è§’è‰²ä¹Ÿä¼šå˜æˆï¼šslaveï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹6001çš„æƒ…å†µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/YABKJDsbQkE1UM5.png" alt="image-20230307000208687" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ä»èŠ‚ç‚¹ä¿¡æ¯ä¸­å·²ç»å‡ºç°äº†6002æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨æˆ‘ä»¬çš„6001å’Œ6002å°±å½¢æˆäº†ä¸»ä»å…³ç³»ï¼ˆè¿˜åŒ…å«ä¸€ä¸ªåç§»é‡ï¼Œè¿™ä¸ªåç§»é‡ååº”çš„æ˜¯ä»èŠ‚ç‚¹çš„åŒæ­¥æƒ…å†µï¼‰</p>
<blockquote>
<p>ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼Œä¸»æœåŠ¡å™¨æ¯æ¬¡å‘ä»æœåŠ¡å™¨ä¸­ä¼ é€’ N ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œä¼šå°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸Š Nã€‚ä»æœåŠ¡å™¨ä¸­æ”¶åˆ°ä¸»æœåŠ¡å™¨çš„ N ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå°±ä¼šå°†è‡ªå·±é¢å¤åˆ¶åç§»é‡åŠ ä¸Š Nï¼Œé€šè¿‡ä¸»ä»æœåŠ¡å™¨çš„åç§»é‡å¯¹æ¯”å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯å¦å¤„äºä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±éœ€è¦è¿›è¡Œå¢é‡åŒæ­¥äº†ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨ä¸»èŠ‚ç‚¹æ–°å¢æ•°æ®ï¼Œçœ‹çœ‹æ˜¯å¦ä¼šåŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/taxoisA8Tpg2DWM.png" alt="image-20230307000216155" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨6001æœåŠ¡å™¨æ’å…¥çš„<code>a</code>ï¼Œå¯ä»¥åœ¨ä»èŠ‚ç‚¹6002è¯»å–åˆ°ï¼Œé‚£ä¹ˆï¼Œä»èŠ‚ç‚¹æ–°å¢çš„æ•°æ®åœ¨ä¸»èŠ‚ç‚¹èƒ½å¾—åˆ°å—ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/dS2V8xafPj6lKND.png" alt="image-20230307000224291" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»èŠ‚ç‚¹å‹æ ¹å°±æ²¡åŠæ³•è¿›è¡Œæ•°æ®æ’å…¥ï¼ŒèŠ‚ç‚¹çš„æ¨¡å¼ä¸ºåªè¯»æ¨¡å¼ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç°åœ¨ä¸æƒ³è®©6002ä½œä¸º6001çš„ä»èŠ‚ç‚¹äº†å‘¢ï¼Ÿ</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/dV7Rxov6pblW2g5.png" alt="image-20230307000234718" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è¾“å…¥<code>replicaof no one</code>ï¼Œå³å¯å˜å›Masterè§’è‰²ã€‚æ¥ç€æˆ‘ä»¬å†æ¥å¯åŠ¨ä¸€å°6003æœåŠ¡å™¨ï¼Œæµç¨‹æ˜¯ä¸€æ ·çš„ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/TC7z2mt3EGMPWfq.png" alt="image-20230307000406674" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿æ¥ä¹‹åï¼Œä¹Ÿä¼šç›´æ¥åŒæ­¥ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå› æ­¤æ— è®ºæ˜¯å·²ç»å¤„äºä»èŠ‚ç‚¹çŠ¶æ€è¿˜æ˜¯åˆšåˆšå¯åŠ¨å®Œæˆçš„æœåŠ¡å™¨ï¼Œéƒ½ä¼šä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œå®é™…ä¸Šæ•´ä¸ªåŒæ­¥æµç¨‹ä¸ºï¼š</p>
<ol>
<li>ä»èŠ‚ç‚¹æ‰§è¡Œreplicaof ip portå‘½ä»¤åï¼Œä»èŠ‚ç‚¹ä¼šä¿å­˜ä¸»èŠ‚ç‚¹ç›¸å…³çš„åœ°å€ä¿¡æ¯ã€‚</li>
<li>ä»èŠ‚ç‚¹é€šè¿‡æ¯ç§’è¿è¡Œçš„å®šæ—¶ä»»åŠ¡å‘ç°é…ç½®äº†æ–°çš„ä¸»èŠ‚ç‚¹åï¼Œä¼šå°è¯•ä¸è¯¥èŠ‚ç‚¹å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œä¸“é—¨ç”¨äºæ¥æ”¶ä¸»èŠ‚ç‚¹å‘é€çš„å¤åˆ¶å‘½ä»¤ã€‚</li>
<li>è¿æ¥æˆåŠŸåï¼Œç¬¬ä¸€æ¬¡ä¼šå°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œä¹‹åé‡‡ç”¨å¢é‡å¤åˆ¶ï¼ŒæŒç»­å°†æ–°æ¥çš„å†™å‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚</li>
</ol>
<p>å½“æˆ‘ä»¬çš„ä¸»èŠ‚ç‚¹å…³é—­åï¼Œä»èŠ‚ç‚¹ä¾ç„¶å¯ä»¥è¯»å–æ•°æ®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/MmNshyQxa2ijSRT.png" alt="image-20230307000415001" />
    
  </figure>

</p>
<p>ä½†æ˜¯ä»èŠ‚ç‚¹ä¼šç–¯ç‹‚æŠ¥é”™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/pEIo93MQXShrsZD.png" alt="image-20230307000424822" />
    
  </figure>

</p>
<p>å½“ç„¶æ¯æ¬¡éƒ½å»æ•²ä¸ªå‘½ä»¤é…ç½®ä¸»ä»å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œæ·»åŠ è¿™æ ·è¡Œå³å¯ï¼š</p>
<pre tabindex="0"><code>replicaof 127.0.0.1 6001
</code></pre><p>è¿™é‡Œæˆ‘ä»¬ç»™6002å’Œ6003æœåŠ¡å™¨éƒ½é…ç½®ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬é‡å¯ä¸‰ä¸ªæœåŠ¡å™¨ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/GpAa5kfyC3zVRZK.png" alt="image-20230307000432434" />
    
  </figure>

</p>
<p>å½“ç„¶ï¼Œé™¤äº†ä½œä¸ºMasterèŠ‚ç‚¹çš„ä»èŠ‚ç‚¹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶ä½œä¸ºä»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬è®©6003ä½œä¸º6002çš„ä»èŠ‚ç‚¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/OdAs1weYgkDrQvf.png" alt="image-20230307000444990" />
    
  </figure>

</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨å·®ä¸å¤šæ˜¯è¿™æ ·çš„çš„ä¸€ä¸ªæƒ…å†µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/2ADSR8LtpMhCFfK.png" alt="image-20230307000459161" />
    
  </figure>

</p>
<p>é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œä¼˜ç‚¹è‚¯å®šæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ•´ä¸ªä¼ æ’­é“¾è·¯ä¸€æ—¦ä¸­é€”å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åé¢çš„ä»èŠ‚ç‚¹æ— æ³•åŠæ—¶åŒæ­¥ã€‚</p>


<h3 class="relative group">å“¨å…µæ¨¡å¼ 
    <div id="%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬è®²è§£äº†Rediså®ç°ä¸»ä»å¤åˆ¶çš„ä¸€äº›åŸºæœ¬æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹å“¨å…µæ¨¡å¼ã€‚</p>
<p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šæœ€å…³é”®çš„è¿˜æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå› ä¸ºä¸€æ—¦ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ªä¸»ä»ç³»ç»Ÿå°†æ— æ³•å†™å…¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸€ä¸ªåŠæ³•ï¼Œå¤„ç†ä¸€ä¸‹ä¸»èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µã€‚å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‚è€ƒä¹‹å‰çš„æœåŠ¡æ²»ç†æ¨¡å¼ï¼Œæ¯”å¦‚Nacoså’ŒEurekaï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šè¢«å®æ—¶ç›‘æ§ï¼Œé‚£ä¹ˆåªè¦å‡ºç°é—®é¢˜ï¼Œè‚¯å®šæ˜¯å¯ä»¥åŠæ—¶å‘ç°çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿé‡‡å–å“åº”çš„è¡¥æ•‘æªæ–½ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å³å°†ä»‹ç»çš„å“¨å…µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/YGq8MDZbRK6E7Po.png" alt="image-20230307000508084" />
    
  </figure>

</p>
<p>æ³¨æ„è¿™é‡Œçš„å“¨å…µä¸æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦ä¹ SpringCloud Alibabaçš„é‚£ä¸ªï¼Œæ˜¯ä¸“ç”¨äºRedisçš„ã€‚å“¨å…µä¼šå¯¹æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆä¼šç«‹å³è®©ä»èŠ‚ç‚¹è¿›è¡ŒæŠ•ç¥¨ï¼Œé€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹å‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ä¼šç”±äºä¸»èŠ‚ç‚¹çš„æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯å†™ï¼ˆæ³¨æ„è¦å®ç°è¿™æ ·çš„åŠŸèƒ½æœ€å°çš„ç³»ç»Ÿå¿…é¡»æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œå†å°çš„è¯å°±æ²¡æœ‰æ„ä¹‰äº†ï¼‰</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/WhkUqfxcHn4CApP.png" alt="image-20230307000516875" />
    
  </figure>

</p>
<p>é‚£ä¹ˆæ€ä¹ˆå¯åŠ¨ä¸€ä¸ªå“¨å…µå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶å³å¯ï¼Œè¿™é‡Œç›´æ¥åˆ é™¤å…¨éƒ¨å†…å®¹ï¼Œæ·»åŠ ï¼š</p>
<pre tabindex="0"><code>sentinel monitor lbwnb 127.0.0.1 6001 1
</code></pre><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ˜¯å›ºå®šï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸ºç›‘æ§å¯¹è±¡åç§°ï¼Œéšæ„ï¼Œåé¢å°±æ˜¯ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€å’Œç«¯å£ï¼Œæœ€åä¸€ä¸ª1æˆ‘ä»¬æš‚æ—¶å…ˆä¸è¯´ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶å¯åŠ¨æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°å¯åŠ¨åï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/xB78t53RgykXvo9.png" alt="image-20230307000534399" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/STh2RgjW7ycPCNB.png" alt="image-20230307000542878" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ä»¥å“¨å…µæ¨¡å¼å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œç„¶åè¿˜ä¼šæ˜¾ç¤ºé‚£äº›èŠ‚ç‚¹æ˜¯ä½œä¸ºä»èŠ‚ç‚¹å­˜åœ¨çš„ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ç›´æ¥æŠŠä¸»èŠ‚ç‚¹å…³é—­ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/97HnwfuNjUK5qx4.png" alt="image-20230307000627807" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ä»èŠ‚ç‚¹è¿˜æ˜¯æ­£å¸¸çš„åœ¨æŠ¥é”™ï¼Œä¸€å¼€å§‹çš„æ—¶å€™ä¸ä¼šç›´æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾è€Œæ˜¯ç»§ç»­å°è¯•é‡è¿ï¼ˆå› ä¸ºæœ‰å¯èƒ½åªæ˜¯ç½‘ç»œå°å¡ä¸€ä¸‹ï¼Œæ²¡å¿…è¦è¿™ä¹ˆæ•æ„Ÿï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œä¾ç„¶æ— æ³•è¿æ¥ï¼Œå“¨å…µè¾“å‡ºäº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/GWt8Q6mfSv7TgCb.png" alt="image-20230307000646050" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°å“¨å…µå‘ç°ä¸»èŠ‚ç‚¹å·²ç»æœ‰ä¸€æ®µæ—¶é—´ä¸å¯ç”¨äº†ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹è¿›è¡Œé‡æ–°é€‰ä¸¾ï¼Œ6003èŠ‚ç‚¹è¢«é€‰ä¸ºäº†æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¹‹å‰çš„ä¸»èŠ‚ç‚¹6001å˜æˆäº†æ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/4WzTVZ15dMiQ3f8.png" alt="image-20230307000653822" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/gGHVvOhBKe9wSEz.png" alt="image-20230307000703587" />
    
  </figure>

</p>
<p>å½“æˆ‘ä»¬å†æ¬¡å¯åŠ¨6001æ—¶ï¼Œä¼šå‘ç°ï¼Œå®ƒè‡ªåŠ¨å˜æˆäº†6003çš„ä»èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¼šå°†æ•°æ®åŒæ­¥è¿‡æ¥ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/eqLycu8s1rSRtFa.png" alt="image-20230307000717002" />
    
  </figure>

</p>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªé€‰ä¸¾è§„åˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿæ˜¯åœ¨æ‰€æœ‰çš„ä»èŠ‚ç‚¹ä¸­éšæœºé€‰å–è¿˜æ˜¯éµå¾ªæŸç§è§„åˆ™å‘¢ï¼Ÿ</p>
<ol>
<li>é¦–å…ˆä¼šæ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œæ·»åŠ <code>replica-priority</code>é…ç½®é¡¹ï¼ˆé»˜è®¤æ˜¯100ï¼‰ï¼Œè¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
<li>å¦‚æœä¼˜å…ˆçº§ä¸€æ ·ï¼Œé‚£å°±é€‰æ‹©åç§»é‡æœ€å¤§çš„</li>
<li>è¦æ˜¯è¿˜é€‰ä¸å‡ºæ¥ï¼Œé‚£å°±é€‰æ‹©runidï¼ˆå¯åŠ¨æ—¶éšæœºç”Ÿæˆçš„ï¼‰æœ€å°çš„ã€‚</li>
</ol>
<p>è¦æ˜¯å“¨å…µä¹ŸæŒ‚äº†å’‹åŠï¼Ÿæ²¡äº‹ï¼Œå’±ä»¬å¯ä»¥å¤šå®‰æ’å‡ ä¸ªå“¨å…µï¼Œåªéœ€è¦æŠŠå“¨å…µçš„é…ç½®å¤åˆ¶ä¸€ä¸‹ï¼Œç„¶åä¿®æ”¹ç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ªå“¨å…µäº†ï¼Œæˆ‘ä»¬å¯åŠ¨3ä¸ªå“¨å…µï¼ˆä¸€ä¸»äºŒä»ä¸‰å“¨å…µï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å§æœ€åä¸€ä¸ªå€¼æ”¹ä¸º<code>2</code>ï¼š</p>
<pre tabindex="0"><code>sentinel monitor lbwnb 192.168.0.8 6001 2
</code></pre><p>è¿™ä¸ªå€¼å®é™…ä¸Šä»£è¡¨çš„æ˜¯å½“æœ‰å‡ ä¸ªå“¨å…µè®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå°±åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æŒ‚æ‰äº†</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/48MNiLJXqmUtvWc.png" alt="image-20230307000731297" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠ6001èŠ‚ç‚¹æŒ‚æ‰ï¼Œçœ‹çœ‹è¿™ä¸‰ä¸ªå“¨å…µä¼šæ€ä¹ˆæ ·ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/ajSAhqb5L9Yuorg.png" alt="image-20230307000741214" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°éƒ½æ˜¾ç¤ºå°†masteråˆ‡æ¢ä¸º6002èŠ‚ç‚¹äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨å“¨å…µé‡æ–°é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹ä¹‹åï¼Œæˆ‘ä»¬Javaä¸­çš„Redisçš„å®¢æˆ·ç«¯æ€ä¹ˆæ„ŸçŸ¥åˆ°å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œé¦–å…ˆè¿˜æ˜¯å¯¼å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>redis.clients<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>jedis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>4.2.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨JedisSentinelPoolæ¥è·å–MasterèŠ‚ç‚¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//éœ€è¦æŠŠä¸‰ä¸ªå“¨å…µçš„åœ°å€éƒ½å¡«å…¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">JedisSentinelPool</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JedisSentinelPool</span><span class="p">(</span><span class="s">&#34;lbwnb&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&#34;192.168.0.8:26741&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;192.168.0.8:26740&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;192.168.0.8:26739&#34;</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="na">getResource</span><span class="p">();</span><span class="w">   </span><span class="c1">//ç›´æ¥è¯¢é—®å¹¶å¾—åˆ°Jediså¯¹è±¡ï¼Œè¿™å°±æ˜¯è¿æ¥çš„MasterèŠ‚ç‚¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">jedis</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">&#34;test&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;114514&#34;</span><span class="p">);</span><span class="w">    </span><span class="c1">//ç›´æ¥å†™å…¥å³å¯ï¼Œå®é™…ä¸Šå°±æ˜¯å‘MasterèŠ‚ç‚¹å†™å…¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="na">getResource</span><span class="p">();</span><span class="w">   </span><span class="c1">//å†æ¬¡è·å–</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jedis2</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;test&#34;</span><span class="p">));</span><span class="w">   </span><span class="c1">//è¯»å–æ“ä½œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·ï¼ŒJediså¯¹è±¡å°±å¯ä»¥é€šè¿‡å“¨å…µæ¥è·å–ï¼Œå½“MasterèŠ‚ç‚¹æ›´æ–°åï¼Œä¹Ÿèƒ½å¾—åˆ°æœ€æ–°çš„ã€‚</p>


<h3 class="relative group">é›†ç¾¤æ­å»º 
    <div id="%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å¦‚æœæˆ‘ä»¬æœåŠ¡å™¨çš„å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„Redisåˆéœ€è¦ç»§ç»­å­˜å‚¨å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨é›†ç¾¤æ¥å®ç°æ‰©å®¹ã€‚</p>
<p>å› ä¸ºå•æœºçš„å†…å­˜å®¹é‡æœ€å¤§å°±é‚£ä¹ˆå¤šï¼Œå·²ç»æ²¡åŠæ³•å†ç»§ç»­æ‰©å±•äº†ï¼Œä½†æ˜¯ç°åœ¨åˆéœ€è¦å­˜å‚¨æ›´å¤šçš„å†…å®¹ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥è®©Nå°æœºå™¨ä¸Šçš„Redisæ¥åˆ†åˆ«å­˜å‚¨å„ä¸ªéƒ¨åˆ†çš„æ•°æ®ï¼ˆæ¯ä¸ªRediså¯ä»¥å­˜å‚¨1/Nçš„æ•°æ®é‡ï¼‰ï¼Œè¿™æ ·å°±å®ç°äº†å®¹é‡çš„æ¨ªå‘æ‰©å±•ã€‚åŒæ—¶æ¯å°Redisè¿˜å¯ä»¥é…ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¥½åœ°ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/TjCw8DLi1VqYvpZ.png" alt="image-20230307000754039" />
    
  </figure>

</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥ï¼Œç°åœ¨ç”¨æˆ·æ¥äº†ä¸€ä¸ªå†™å…¥çš„è¯·æ±‚ï¼Œæ•°æ®è¯¥å†™åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹é›†ç¾¤çš„æœºåˆ¶ï¼š</p>
<p>é¦–å…ˆï¼Œä¸€ä¸ªRedisé›†ç¾¤åŒ…å«16384ä¸ªæ’æ§½ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªRedis å®ä¾‹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ’æ§½ä»¥åŠæ’æ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’æ§½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œæ’æ§½å°±æ˜¯é”®çš„Hashè®¡ç®—åçš„ä¸€ä¸ªç»“æœï¼Œæ³¨æ„è¿™é‡Œå‡ºç°äº†<code>è®¡ç®—æœºç½‘ç»œ</code>ä¸­çš„CRCå¾ªç¯å†—ä½™æ ¡éªŒï¼Œè¿™é‡Œé‡‡ç”¨CRC16ï¼Œèƒ½å¾—åˆ°16ä¸ªbitä½çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ç®—å‡ºæ¥ä¹‹åç»“æœæ˜¯0-65535ä¹‹é—´ï¼Œå†è¿›è¡Œå–æ¨¡ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼š</p>
<p><strong>Redis keyçš„è·¯ç”±è®¡ç®—å…¬å¼ï¼šslot = CRC16ï¼ˆkeyï¼‰ % 16384</strong></p>
<p>ç»“æœçš„å€¼æ˜¯å¤šå°‘ï¼Œå°±åº”è¯¥å­˜æ”¾åˆ°å¯¹åº”ç»´æŠ¤çš„Redisä¸‹ï¼Œæ¯”å¦‚RedisèŠ‚ç‚¹1è´Ÿè´£0-25565çš„æ’æ§½ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯æ’å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®<code>a=10</code>ï¼Œaåœ¨Hashè®¡ç®—åç»“æœä¸º666ï¼Œé‚£ä¹ˆaå°±åº”è¯¥å­˜æ”¾åˆ°1å·RedisèŠ‚ç‚¹ä¸­ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡å“ˆå¸Œç®—æ³•å°†æ’å…¥çš„æ•°æ®åˆ†æ‘Šåˆ°å„ä¸ªèŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥è¯´å“ˆå¸Œç®—æ³•çœŸçš„æ˜¯å¤„å¤„éƒ½æœ‰ç”¨å•Šã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±æ¥æ­å»ºä¸€ä¸ªç®€å•çš„Redisé›†ç¾¤ï¼Œè¿™é‡Œåˆ›å»º6ä¸ªé…ç½®ï¼Œæ³¨æ„å¼€å¯é›†ç¾¤æ¨¡å¼ï¼š</p>
<pre tabindex="0"><code># Normal Redis instances can&#39;t be part of a Redis Cluster; only nodes that are
# started as cluster nodes can. In order to start a Redis instance as a
# cluster node enable the cluster support uncommenting the following:
#
cluster-enabled yes
</code></pre><p>æ¥ç€è®°å¾—æŠŠæ‰€æœ‰çš„æŒä¹…åŒ–æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹å†…å®¹å¿…é¡»æ˜¯ç©ºçš„ã€‚</p>
<p>ç„¶åè¾“å…¥<code>redis-cli.exe --cluster create --cluster-replicas 1 127.0.0.1:6001 127.0.0.1:6002 127.0.0.1:6003 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003</code>ï¼Œè¿™é‡Œçš„<code>--cluster-replicas 1</code>æŒ‡çš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹é…ä¸€ä¸ªä»èŠ‚ç‚¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/7DikHoxKJPve9qa.png" alt="image-20230307000805968" />
    
  </figure>

</p>
<p>è¾“å…¥ä¹‹åï¼Œä¼šä¸ºä½ å±•ç¤ºå®¢æˆ·ç«¯é»˜è®¤åˆ†é…çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”ä¼šè¯¢é—®ä½ å½“å‰çš„æ–¹æ¡ˆæ˜¯å¦åˆç†ã€‚å¯ä»¥çœ‹åˆ°6001/6002/6003éƒ½è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–çš„ä¸ºä»èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥yeså³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/yxZhjouXB79qfDd.png" alt="image-20230307000814076" />
    
  </figure>

</p>
<p>æœ€ååˆ†é…æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°æ’æ§½çš„åˆ†é…æƒ…å†µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/8kg9TbadF2qyHJW.png" alt="image-20230307000830886" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬éšä¾¿è¿æ¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°è¯•æ’å…¥ä¸€ä¸ªå€¼ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/YMf8DtlkCsqBpO1.png" alt="image-20230307000840119" />
    
  </figure>

</p>
<p>åœ¨æ’å…¥æ—¶ï¼Œå‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œå®é™…ä¸Šè¿™å°±æ˜¯å› ä¸ºaè®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ï¼ˆæ’æ§½ï¼‰ï¼Œä¸å½’å½“å‰èŠ‚ç‚¹ç®¡ï¼Œæˆ‘ä»¬å¾—å»ç®¡è¿™ä¸ªæ’æ§½çš„èŠ‚ç‚¹æ‰§è¡Œï¼Œé€šè¿‡ä¸Šé¢çš„åˆ†é…æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°15495å±äºèŠ‚ç‚¹6003ç®¡ç†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/EZmR2bLFudSskIf.png" alt="image-20230307000849127" />
    
  </figure>

</p>
<p>åœ¨6003èŠ‚ç‚¹æ’å…¥æˆåŠŸï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é›†ç¾¤æ–¹å¼è¿æ¥ï¼Œè¿™æ ·æˆ‘ä»¬æ— è®ºåœ¨å“ªä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ’å…¥ï¼Œåªéœ€è¦æ·»åŠ <code>-c</code>è¡¨ç¤ºä»¥é›†ç¾¤æ¨¡å¼è®¿é—®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/mVw7EXFJQOcinIb.png" alt="image-20230307000907196" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨6001èŠ‚ç‚¹æˆåŠŸå¯¹açš„å€¼è¿›è¡Œäº†æ›´æ–°ï¼Œåªä¸è¿‡è¿˜æ˜¯è¢«é‡å®šå‘åˆ°äº†6003èŠ‚ç‚¹è¿›è¡Œæ’å…¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¾“å…¥<code>cluster nodes</code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/pEJdI2UWTcNZFqu.png" alt="image-20230307000914746" />
    
  </figure>

</p>
<p>é‚£ä¹ˆç°åœ¨å¦‚æœæˆ‘ä»¬è®©æŸä¸€ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿç°åœ¨æˆ‘ä»¬æŠŠ6001æŒ‚æ‰ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/zd6L3WosVE8JUqf.png" alt="image-20230307000922277" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°åŸæœ¬çš„6001ä»èŠ‚ç‚¹7001ï¼Œæ™‹å‡ä¸ºäº†æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œè€Œä¹‹å‰çš„6001å·²ç»æŒ‚äº†ï¼Œç°åœ¨æˆ‘ä»¬å°†6001é‡å¯è¯•è¯•çœ‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/eUfYJS8yhVijvaw.png" alt="image-20230307000933812" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°6001å˜æˆäº†7001çš„ä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¦æ˜¯6001å’Œ7001éƒ½æŒ‚äº†å‘¢ï¼Ÿ</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/9W2BQtMXrUCnySV.png" alt="image-20230307000944827" />
    
  </figure>

</p>
<p>è¿™æ—¶æˆ‘ä»¬å°è¯•æ’å…¥æ–°çš„æ•°æ®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/S8r5TE7gJ3M6iDW.png" alt="image-20230307000953377" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å­˜åœ¨èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä¼šæ— æ³•æ’å…¥æ–°çš„æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬å°†6001å’Œ7001æ¢å¤ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/2RL4GNqSWJXFuME.png" alt="image-20230307001001435" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°æ¢å¤ä¹‹ååˆå¯ä»¥ç»§ç»­æ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Javaè¿æ¥åˆ°é›†ç¾¤æ¨¡å¼ä¸‹çš„Redisï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°JedisClusterå¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//å’Œå®¢æˆ·ç«¯ä¸€æ ·ï¼Œéšä¾¿è¿ä¸€ä¸ªå°±è¡Œï¼Œä¹Ÿå¯ä»¥å¤šå†™å‡ ä¸ªï¼Œæ„é€ æ–¹æ³•æœ‰å¾ˆå¤šç§å¯ä»¥é€‰æ‹©</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="p">(</span><span class="n">JedisCluster</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JedisCluster</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HostAndPort</span><span class="p">(</span><span class="s">&#34;192.168.0.8&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">6003</span><span class="p">))){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;é›†ç¾¤å®ä¾‹æ•°é‡ï¼š&#34;</span><span class="o">+</span><span class="n">cluster</span><span class="p">.</span><span class="na">getClusterNodes</span><span class="p">().</span><span class="na">size</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">cluster</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;yyds&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cluster</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ“ä½œåŸºæœ¬å’ŒJediså¯¹è±¡ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å¤šåšèµ˜è¿°äº†ã€‚</p>


<h3 class="relative group">åˆ†å¸ƒå¼é” 
    <div id="%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>åœ¨æˆ‘ä»¬çš„ä¼ ç»Ÿå•ä½“åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šç”¨åˆ°é”æœºåˆ¶ï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¤šçº¿ç¨‹ç«äº‰å¯¼è‡´çš„å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œåˆè¯¥å¦‚ä½•å®ç°é”æœºåˆ¶å‘¢ï¼Ÿå¯èƒ½ä¸€æ¡é“¾è·¯ä¸Šæœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œå®ƒä»¬éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©Redisæ¥å®ç°åˆ†å¸ƒå¼é”ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬ä¸Šä¸€ç« æœ€åæå‡ºçš„é—®é¢˜å—ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">doBorrow</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c1">//1. åˆ¤æ–­å›¾ä¹¦å’Œç”¨æˆ·æ˜¯å¦éƒ½æ”¯æŒå€Ÿé˜…ï¼Œå¦‚æœæ­¤æ—¶æ¥äº†10ä¸ªçº¿ç¨‹ï¼Œéƒ½è¿›æ¥äº†ï¼Œé‚£ä¹ˆéƒ½èƒ½å¤Ÿåˆ¤æ–­ä¸ºå¯ä»¥å€Ÿé˜…</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bookClient</span><span class="p">.</span><span class="na">bookRemain</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;å›¾ä¹¦æ•°é‡ä¸è¶³&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">userClient</span><span class="p">.</span><span class="na">userRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c1">//2. é¦–å…ˆå°†å›¾ä¹¦çš„æ•°é‡-1ï¼Œç”±äºä¸Šé¢10ä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥ï¼ŒåŒæ—¶åˆ¤æ–­å¯ä»¥å€Ÿé˜…ï¼Œé‚£ä¹ˆè¿™ä¸ª10ä¸ªçº¿ç¨‹å°±åŒæ—¶å°†å›¾ä¹¦æ•°é‡-1ï¼Œé‚£åº“å­˜å²‚ä¸æ˜¯ç›´æ¥å˜æˆè´Ÿæ•°äº†ï¼Ÿï¼Ÿï¼Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">bookClient</span><span class="p">.</span><span class="na">bookBorrow</span><span class="p">(</span><span class="n">bid</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å®é™…ä¸Šåœ¨é«˜å¹¶å‘ä¸‹ï¼Œæˆ‘ä»¬çœ‹ä¼¼æ­£å¸¸çš„å€Ÿé˜…æµç¨‹ï¼Œä¼šå‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚ç°åœ¨åŒæ—¶æ¥äº†10ä¸ªåŒå­¦è¦å€ŸåŒä¸€æœ¬ä¹¦ï¼Œä½†æ˜¯ç°åœ¨åªæœ‰3æœ¬ï¼Œè€Œæˆ‘ä»¬çš„åˆ¤æ–­è§„åˆ™æ˜¯ï¼Œé¦–å…ˆçœ‹ä¹¦å¤Ÿä¸å¤Ÿï¼Œå¦‚æœæ­¤æ—¶è¿™10ä¸ªè¯·æ±‚éƒ½å·²ç»èµ°åˆ°è¿™é‡Œï¼Œå¹¶ä¸”éƒ½åˆ¤å®šä¸ºå¯ä»¥è¿›è¡Œå€Ÿé˜…ï¼Œé‚£ä¹ˆé—®é¢˜å°±å‡ºç°äº†ï¼Œæ¥ä¸‹æ¥è¿™10ä¸ªè¯·æ±‚éƒ½å¼€å§‹è¿›è¡Œå€Ÿé˜…æ“ä½œï¼Œå¯¼è‡´åº“å­˜ç›´æ¥çˆ†è¡¨ï¼Œå½¢æˆè¶…å€Ÿé—®é¢˜ï¼ˆåœ¨ç”µå•†ç³»ç»Ÿä¸­ä¹Ÿå­˜åœ¨åŒæ ·çš„è¶…å–é—®é¢˜ï¼‰</p>
<p>å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨åˆ†å¸ƒå¼é”æ¥å®ç°ã€‚é‚£ä¹ˆRediså¦‚ä½•å»å®ç°åˆ†å¸ƒå¼é”å‘¢ï¼Ÿ</p>
<p>åœ¨Rediså­˜åœ¨è¿™æ ·ä¸€ä¸ªå‘½ä»¤ï¼š</p>
<pre tabindex="0"><code>setnx key value
</code></pre><p>è¿™ä¸ªå‘½ä»¤çœ‹èµ·æ¥å’Œ<code>set</code>å‘½ä»¤å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªæœºåˆ¶ï¼Œå°±æ˜¯åªæœ‰å½“æŒ‡å®šçš„keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰èƒ½è¿›è¡Œæ’å…¥ï¼Œå®é™…ä¸Šå°±æ˜¯<code>set if not exists</code>çš„ç¼©å†™ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/fNCxEJRX61cPsuk.png" alt="image-20230307001013418" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å®¢æˆ·ç«¯1è®¾å®šaä¹‹åï¼Œå®¢æˆ·ç«¯2ä½¿ç”¨<code>setnx</code>ä¼šç›´æ¥å¤±è´¥ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/wpGutcmxEsWFJVn.png" alt="image-20230307001022446" />
    
  </figure>

</p>
<p>å½“å®¢æˆ·ç«¯1å°†aåˆ é™¤ä¹‹åï¼Œå®¢æˆ·ç«¯2å°±å¯ä»¥ä½¿ç”¨<code>setnx</code>æˆåŠŸæ’å…¥äº†ã€‚</p>
<p>åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡ä¸­å®ç°åˆ†å¸ƒå¼é”ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¦æ˜¯æŸä¸ªæœåŠ¡åŠ äº†é”ä½†æ˜¯å¡é¡¿äº†å‘¢ï¼Œæˆ–æ˜¯ç›´æ¥å´©æºƒäº†ï¼Œé‚£è¿™æŠŠé”å²‚ä¸æ˜¯æ°¸è¿œæ— æ³•é‡Šæ”¾äº†ï¼Ÿå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘åŠ ä¸ªè¿‡æœŸæ—¶é—´ï¼š</p>
<pre tabindex="0"><code>set a 666 EX 5 NX
</code></pre><p>è¿™é‡Œä½¿ç”¨<code>set</code>å‘½ä»¤ï¼Œæœ€ååŠ ä¸€ä¸ªNXè¡¨ç¤ºæ˜¯ä½¿ç”¨<code>setnx</code>çš„æ¨¡å¼ï¼Œå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡EXè®¾å®šè¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º5ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœ5ç§’è¿˜æ²¡é‡Šæ”¾ï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨åˆ é™¤ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/eQEIGKONmkB2u6y.png" alt="image-20230307001031311" />
    
  </figure>

</p>
<p>å½“ç„¶ï¼Œæ·»åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œå¸¦äº†çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„éº»çƒ¦ï¼Œæˆ‘ä»¬æ¥è®¾æƒ³ä¸€ä¸‹è¿™ç§æƒ…å†µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/nStuP75RLOmQWUM.png" alt="image-20230307001038169" />
    
  </figure>

</p>
<p>å› æ­¤ï¼Œå•çº¯åªæ˜¯æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œä¼šå‡ºç°è¿™ç§æŠŠåˆ«äººåŠ çš„é”è°å¸äº†çš„æƒ…å†µï¼Œè¦è§£å†³è¿™ç§é—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬ç°åœ¨çš„ç›®æ ‡å°±æ˜¯ä¿è¯ä»»åŠ¡åªèƒ½åˆ é™¤è‡ªå·±åŠ çš„é”ï¼Œå¦‚æœæ˜¯åˆ«äººåŠ çš„é”æ˜¯æ²¡æœ‰èµ„æ ¼åˆ çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å§açš„å€¼æŒ‡å®šä¸ºæˆ‘ä»¬ä»»åŠ¡ä¸“å±çš„å€¼ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨UUIDä¹‹ç±»çš„ï¼Œå¦‚æœåœ¨ä¸»åŠ¨åˆ é™¤é”çš„æ—¶å€™å‘ç°å€¼ä¸æ˜¯æˆ‘ä»¬å½“å‰ä»»åŠ¡æŒ‡å®šçš„ï¼Œé‚£ä¹ˆè¯´æ˜å¯èƒ½æ˜¯å› ä¸ºè¶…æ—¶ï¼Œå…¶ä»–ä»»åŠ¡å·²ç»åŠ é”äº†ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/4DW1K38UqQJdwkf.jpg" alt="image-20220414113041835" />
    
  </figure>

</p>
<p>å¦‚æœä½ åœ¨å­¦ä¹ æœ¬ç¯‡ä¹‹å‰å®Œæˆäº†JUCå¹¶å‘ç¼–ç¨‹ç¯‡çš„å­¦ä¹ ï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œå¦‚æœåœ¨è¶…æ—¶ä¹‹å‰é‚£ä¸€åˆ¹é‚£è¿›å…¥åˆ°é‡Šæ”¾é”çš„é˜¶æ®µï¼Œè·å–åˆ°å€¼è‚¯å®šè¿˜æ˜¯è‡ªå·±ï¼Œä½†æ˜¯åœ¨å³å°†æ‰§è¡Œåˆ é™¤ä¹‹å‰ï¼Œç”±äºè¶…æ—¶æœºåˆ¶å¯¼è‡´è¢«åˆ é™¤å¹¶ä¸”å…¶ä»–ä»»åŠ¡ä¹ŸåŠ é”äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å†è¿›è¡Œåˆ é™¤ï¼Œä»ç„¶ä¼šå¯¼è‡´åˆ é™¤å…¶ä»–ä»»åŠ¡åŠ çš„é”ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/8I1Atm7BOZC5ifS.jpg" alt="image-20220414113709773" />
    
  </figure>

</p>
<p>å®é™…ä¸Šæœ¬è´¨è¿˜æ˜¯å› ä¸ºé”çš„è¶…æ—¶æ—¶é—´ä¸å¤ªå¥½è¡¡é‡ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´èƒ½å¤Ÿè®¾å®šåœ°æ¯”è¾ƒæ°å½“ï¼Œé‚£ä¹ˆå°±å¯ä»¥é¿å…è¿™ç§é—®é¢˜äº†ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€ä¸‹Redissonæ¡†æ¶ï¼Œå®ƒæ˜¯Rediså®˜æ–¹æ¨èçš„Javaç‰ˆçš„Rediså®¢æˆ·ç«¯ã€‚å®ƒæä¾›çš„åŠŸèƒ½éå¸¸å¤šï¼Œä¹Ÿéå¸¸å¼ºå¤§ï¼ŒRedissonå†…éƒ¨æä¾›äº†ä¸€ä¸ªç›‘æ§é”çš„çœ‹é—¨ç‹—ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨Redissonå®ä¾‹è¢«å…³é—­å‰ï¼Œä¸æ–­çš„å»¶é•¿é”çš„æœ‰æ•ˆæœŸï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šç§åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿç±»ä¼¼æˆ‘ä»¬åœ¨JUCä¸­å­¦ä¹ çš„é”ï¼Œè¿™é‡Œæˆ‘ä»¬å°è¯•ä½¿ç”¨ä¸€ä¸‹å®ƒçš„åˆ†å¸ƒå¼é”åŠŸèƒ½ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.redisson<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>redisson<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>3.17.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>io.netty<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>netty-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>4.1.75.Final<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="p">(</span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Jedis</span><span class="p">(</span><span class="s">&#34;192.168.0.10&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">6379</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">100</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">//æ¯ä¸ªå®¢æˆ·ç«¯è·å–aç„¶åå¢åŠ açš„å€¼å†å†™å›å»ï¼Œå¦‚æœä¸åŠ é”é‚£ä¹ˆè‚¯å®šä¼šå‡ºé—®é¢˜</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">jedis</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jedis</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">+</span><span class="s">&#34;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™é‡Œæ²¡æœ‰ç›´æ¥ç”¨<code>incr</code>è€Œæ˜¯æˆ‘ä»¬è‡ªå·±è¿›è¡Œè®¡ç®—ï¼Œæ–¹ä¾¿æ¨¡æ‹Ÿï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œç»“æŸä¹‹åaçš„å€¼å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/y2Nvi816ut4jpGC.jpg" alt="image-20220414133258227" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥ç»™å®ƒåŠ ä¸€æŠŠé”ï¼Œæ³¨æ„è¿™ä¸ªé”æ˜¯åŸºäºRedisçš„ï¼Œä¸ä»…ä»…åªå¯ä»¥ç”¨äºå½“å‰åº”ç”¨ï¼Œæ˜¯èƒ½å¤Ÿå®ç³»ç»Ÿçš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Config</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Config</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="na">useSingleServer</span><span class="p">().</span><span class="na">setAddress</span><span class="p">(</span><span class="s">&#34;redis://192.168.0.10:6379&#34;</span><span class="p">);</span><span class="w">   </span><span class="c1">//é…ç½®è¿æ¥çš„RedisæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé›†ç¾¤</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RedissonClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">Redisson</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">config</span><span class="p">);</span><span class="w">   </span><span class="c1">//åˆ›å»ºRedissonClientå®¢æˆ·ç«¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="p">(</span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Jedis</span><span class="p">(</span><span class="s">&#34;192.168.0.10&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">6379</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">RLock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">getLock</span><span class="p">(</span><span class="s">&#34;testLock&#34;</span><span class="p">);</span><span class="w">    </span><span class="c1">//æŒ‡å®šé”çš„åç§°ï¼Œæ‹¿åˆ°é”å¯¹è±¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">100</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span><span class="w">    </span><span class="c1">//åŠ é”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">jedis</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jedis</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">+</span><span class="s">&#34;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">   </span><span class="c1">//è§£é”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ç»“æŸï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ç»“æœæ²¡æœ‰é—®é¢˜ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/Gyz1Rc7OWhT5NJK.jpg" alt="image-20220414133403403" />
    
  </figure>

</p>
<p>æ³¨æ„ï¼Œå¦‚æœç”¨äºå­˜æ”¾é”çš„RedisæœåŠ¡å™¨æŒ‚äº†ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨RedLockï¼Œå®ƒçš„æ€è·¯æ˜¯ï¼Œåœ¨å¤šä¸ªRedisæœåŠ¡å™¨ä¸Šä¿å­˜é”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„RedisæœåŠ¡å™¨è·å–åˆ°é”ï¼Œé‚£ä¹ˆå°±çœŸçš„è·å–åˆ°é”äº†ï¼Œè¿™æ ·å°±ç®—æŒ‚æ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹ï¼Œä¹Ÿèƒ½ä¿è¯æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ã€‚</p>
<hr>


<h2 class="relative group">MySQLä¸åˆ†å¸ƒå¼ 
    <div id="mysql%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#mysql%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p>å‰é¢æˆ‘è®²è§£äº†Redisåœ¨åˆ†å¸ƒå¼åœºæ™¯çš„ä¸‹çš„ç›¸å…³åº”ç”¨ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹MySQLæ•°æ®åº“åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚</p>


<h3 class="relative group">ä¸»ä»å¤åˆ¶ 
    <div id="%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-1" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å½“æˆ‘ä»¬ä½¿ç”¨MySQLçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é‡‡å–ä¸»ä»å¤åˆ¶çš„ç­–ç•¥ï¼Œå®ƒçš„å®ç°æ€è·¯åŸºæœ¬å’ŒRedisç›¸ä¼¼ï¼Œä¹Ÿæ˜¯é‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ï¼ŒMySQLä¼šåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ‰€æœ‰çš„DMLå’ŒDDLæ“ä½œéƒ½ä¼šè¢«è®°å½•è¿›æ—¥å¿—ä¸­ï¼Œä¸»åº“åªéœ€è¦å°†è®°å½•çš„æ“ä½œå¤åˆ¶ç»™ä»åº“ï¼Œè®©ä»åº“ä¹Ÿè¿è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°ä¸»ä»å¤åˆ¶ã€‚ä½†æ˜¯æ³¨æ„å®ƒä¸ä¼šåœ¨ä¸€å¼€å§‹è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œæ‰€ä»¥æœ€å¥½å†å¼€å§‹ä¸»ä»ä¹‹å‰å°†æ•°æ®åº“çš„å†…å®¹ä¿æŒä¸€è‡´ã€‚</p>
<p>å’Œä¹‹å‰ä¸€æ ·ï¼Œä¸€æ—¦æˆ‘ä»¬å®ç°äº†ä¸»ä»å¤åˆ¶ï¼Œé‚£ä¹ˆå°±ç®—ä¸»åº“å‡ºç°æ•…éšœï¼Œä»åº“ä¹Ÿèƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ç­‰æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨ä¸¤å°ä¸»æœºæ¥æ­å»ºä¸€ä¸»ä¸€ä»çš„ç¯å¢ƒï¼Œé¦–å…ˆç¡®ä¿ä¸¤å°æœåŠ¡å™¨éƒ½å®‰è£…äº†MySQLæ•°æ®åº“å¹¶ä¸”éƒ½å·²ç»æ­£å¸¸è¿è¡Œäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/95wL8vICYNp61T2.jpg" alt="image-20220414162319865" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦åˆ›å»ºå¯¹åº”çš„è´¦å·ï¼Œä¸€ä¼šæ–¹ä¾¿ä»åº“è¿›è¡Œè®¿é—®çš„ç”¨æˆ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å¼€å¯ä¸€ä¸‹å¤–ç½‘è®¿é—®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
</span></span></code></pre></div><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1"># If MySQL is running as a replication slave, this should be</span>
</span></span><span class="line"><span class="cl"><span class="c1"># changed. Ref https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_tmpdir</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tmpdir                = /tmp</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Instead of skip-networking the default is now to listen only on</span>
</span></span><span class="line"><span class="cl"><span class="c1"># localhost which is more compatible and is not less secure.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># bind-address          = 127.0.0.1    è¿™é‡Œæ³¨é‡Šæ‰å°±è¡Œ</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬é‡å¯ä¸€ä¸‹MySQLæœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo systemctl restart mysql.service 
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬é¦–å…ˆæ¥é…ç½®ä¸»åº“ï¼Œä¸»åº“åªéœ€è¦ä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„ç”¨æˆ·åˆ†é…ä¸€ä¸ªä¸»ä»å¤åˆ¶çš„æƒé™å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">grant</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">slave</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å¯ä»¥è¾“å…¥å‘½ä»¤æ¥æŸ¥çœ‹ä¸»åº“çš„ç›¸å…³æƒ…å†µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/kqHZoc8xAbNOd3K.jpg" alt="image-20220414164943974" />
    
  </figure>

</p>
<p>è¿™æ ·ä¸»åº“å°±æ­å»ºå®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†ä»åº“è¿›è¡Œé…ç½®ï¼Œé¦–å…ˆæ˜¯é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1"># The following can be used as easy to replay backup logs or for replication.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># note: if you are setting up a replication slave, see README.Debian about</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       other settings you may need to change.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™é‡Œéœ€è¦å°†server-idé…ç½®ä¸ºå…¶ä»–çš„å€¼ï¼ˆé»˜è®¤æ˜¯1ï¼‰æ‰€æœ‰Mysqlä¸»ä»å®ä¾‹çš„idå¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½æ‰“æ¶ï¼Œä¸ç„¶ä¸€ä¼šå¼€å¯ä¼šå¤±è´¥</span>
</span></span><span class="line"><span class="cl"><span class="na">server-id</span>               <span class="o">=</span> <span class="s">2</span>
</span></span></code></pre></div><p>è¿›å…¥æ•°æ®åº“ï¼Œè¾“å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">change</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">SOURCE_HOST</span><span class="o">=</span><span class="s1">&#39;192.168.0.8&#39;</span><span class="p">,</span><span class="n">SOURCE_USER</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="n">SOURCE_PASSWORD</span><span class="o">=</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="n">SOURCE_LOG_FILE</span><span class="o">=</span><span class="s1">&#39;binlog.000004&#39;</span><span class="p">,</span><span class="n">SOURCE_LOG_POS</span><span class="o">=</span><span class="mi">591</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ³¨æ„åé¢çš„logfileå’Œposå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä»ä¸»åº“ä¸­æ˜¾ç¤ºçš„ä¿¡æ¯ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/H7BIl9s3kPu2Mnw.jpg" alt="image-20220414170022303" />
    
  </figure>

</p>
<p>æ‰§è¡Œå®Œæˆåï¼Œæ˜¾ç¤ºOKè¡¨ç¤ºæ²¡æœ‰é—®é¢˜ï¼Œæ¥ç€è¾“å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">start</span><span class="w"> </span><span class="n">replica</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬çš„ä»æœºå°±æ­£å¼å¯åŠ¨äº†ï¼Œç°åœ¨æˆ‘ä»¬è¾“å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">show</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">status</span><span class="err">\</span><span class="k">G</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ¥æŸ¥çœ‹å½“å‰ä»æœºçŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/KiCoVP1cGaf94uX.jpg" alt="image-20220414192045320" />
    
  </figure>

</p>
<p>æœ€å…³é”®çš„æ˜¯ä¸‹é¢çš„Replica_IO_Runningå’ŒReplica_SQL_Runningå¿…é¡»åŒæ—¶ä¸ºYesæ‰å¯ä»¥ï¼Œå®é™…ä¸Šä»åº“ä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ä¸ä¸»åº“è¿›è¡Œé€šä¿¡ï¼Œè·å–äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæš‚æ—¶å­˜æ”¾åˆ°ä¸€ä¸ªä¸­é—´è¡¨ï¼ˆRelay_Logï¼‰ä¸­ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ™æ˜¯å°†ä¸­é—´è¡¨ä¿å­˜çš„äºŒè¿›åˆ¶æ—¥å¿—çš„ä¿¡æ¯è¿›è¡Œæ‰§è¡Œï¼Œç„¶åæ’å…¥åˆ°ä»åº“ä¸­ã€‚</p>
<p>æœ€åé…ç½®å®Œæˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ä¸»åº“è¿›è¡Œæ“ä½œä¼šä¸ä¼šåŒæ­¥åˆ°ä»åº“ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/RxNB3QmUYESX5ad.jpg" alt="image-20220414192508849" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°åœ¨ä¸»åº“ä¸­åˆ›å»ºçš„æ•°æ®åº“ï¼Œè¢«åŒæ­¥åˆ°ä»åº“ä¸­äº†ï¼Œæˆ‘ä»¬å†æ¥è¯•è¯•çœ‹åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">use</span><span class="w"> </span><span class="n">yyds</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test</span><span class="w">  </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">passwd</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/qKBwz31P6ySxlZt.jpg" alt="image-20220414192829536" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬éšä¾¿æ’å…¥ä¸€ç‚¹æ•°æ®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/9pqBFXiLhTPc2xO.jpg" alt="image-20220414192920277" />
    
  </figure>

</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„MySQLä¸»ä»å°±æ­å»ºå®Œæˆäº†ï¼Œé‚£ä¹ˆå¦‚æœä¸»æœºæ­¤æ—¶æŒ‚äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/s1Q5xt32r6dv9UJ.jpg" alt="image-20220414200140191" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°IOçº¿ç¨‹æ˜¯å¤„äºé‡è¿çŠ¶æ€ï¼Œä¼šç­‰å¾…ä¸»åº“é‡æ–°æ¢å¤è¿è¡Œã€‚</p>


<h3 class="relative group">åˆ†åº“åˆ†è¡¨ 
    <div id="%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>åœ¨å¤§å‹çš„äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œå¯èƒ½å•å°MySQLçš„å­˜å‚¨å®¹é‡æ— æ³•æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œæ‰©å®¹äº†ã€‚</p>
<p>å’Œä¹‹å‰çš„é—®é¢˜ä¸€æ ·ï¼Œå•å°ä¸»æœºçš„ç¡¬ä»¶èµ„æºæ˜¯å­˜åœ¨ç“¶é¢ˆçš„ï¼Œä¸å¯èƒ½æ— é™åˆ¶åœ°çºµå‘æ‰©å±•ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¾—é€šè¿‡å¤šå°å®ä¾‹æ¥è¿›è¡Œå®¹é‡çš„æ¨ªå‘æ‰©å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åˆ†æ•£å­˜å‚¨ï¼Œè®©å¤šå°ä¸»æœºå…±åŒæ¥ä¿å­˜æ•°æ®ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¸ªåˆ†æ•£æ³•ï¼Ÿ</p>
<ul>
<li>
<p><strong>å‚ç›´æ‹†åˆ†ï¼š</strong> æˆ‘ä»¬çš„è¡¨å’Œæ•°æ®åº“éƒ½å¯ä»¥è¿›è¡Œå‚ç›´æ‹†åˆ†ï¼Œæ‰€è°“å‚ç›´æ‹†åˆ†ï¼Œå°±æ˜¯å°†æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨ï¼ŒæŒ‰ç…§ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†åˆ°å„ä¸ªæ•°æ®åº“ä¸­ï¼ˆæ˜¯ä¸æ˜¯æ„Ÿè§‰è·Ÿå‰é¢ä¸¤ç« çš„å­¦ä¹ çš„æ¶æ„å¯¹åº”èµ·æ¥äº†ï¼‰è€Œå¯¹äºä¸€å¼ è¡¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤–é”®ä¹‹ç±»çš„æœºåˆ¶ï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªè¡¨ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/mnJO4hBwDAkRcMi.jpg" alt="image-20220414204703883" />
    
  </figure>

</p>
</li>
<li>
<p><strong>æ°´å¹³æ‹†åˆ†ï¼š</strong> æ°´å¹³æ‹†åˆ†é’ˆå¯¹çš„ä¸æ˜¯è¡¨ï¼Œè€Œæ˜¯æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¾ˆå¤šä¸ªå…·æœ‰ç›¸åŒè¡¨çš„æ•°æ®åº“å­˜æ”¾ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç›¸å½“äºæ˜¯å°†æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/AdS5hrH2O1l8iqv.jpg" alt="image-20220414205222383" />
    
  </figure>

</p>
</li>
</ul>
<p>é‚£ä¹ˆè¦å®ç°è¿™æ ·çš„æ‹†åˆ†æ“ä½œï¼Œæˆ‘ä»¬è‡ªè¡Œå»ç¼–å†™ä»£ç å·¥ä½œé‡è‚¯å®šæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå› æ­¤ç›®å‰å®é™…ä¸Šå·²ç»æœ‰ä¸€äº›è§£å†³æ–¹æ¡ˆäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MyCatï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®åº“ä¸­é—´ä»¶ï¼Œç›¸å½“äºæŒ‚äº†ä¸€å±‚ä»£ç†ï¼Œå†é€šè¿‡MyCatè¿›è¡Œåˆ†åº“åˆ†è¡¨æ“ä½œæ•°æ®åº“ï¼Œåªéœ€è¦è¿æ¥å°±èƒ½ä½¿ç”¨ï¼Œç±»ä¼¼çš„è¿˜æœ‰ShardingSphere-Proxyï¼‰æˆ–æ˜¯Sharding JDBCï¼ˆåº”ç”¨ç¨‹åºä¸­ç›´æ¥å¯¹SQLè¯­å¥è¿›è¡Œåˆ†æï¼Œç„¶åè½¬æ¢æˆåˆ†åº“åˆ†è¡¨æ“ä½œï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™ä¸€äº›é€»è¾‘ä»£ç ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è®²è§£ä¸€ä¸‹Sharding JDBCã€‚</p>


<h3 class="relative group">Sharding JDBC 
    <div id="sharding-jdbc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#sharding-jdbc" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/HTlcExgCfZvG9MP.jpg" alt="image-20220414214856875" />
    
  </figure>

</p>
<p><strong>å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰ï¼š</strong> <a href="https://shardingsphere.apache.org/document/5.1.0/cn/overview/#shardingsphere-jdbc"   target="_blank">
    https://shardingsphere.apache.org/document/5.1.0/cn/overview/#shardingsphere-jdbc</a></p>
<p>å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ï¼Œå®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p>
<ul>
<li>é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼›</li>
<li>æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼›</li>
<li>æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ¼”ç¤ºä¸€ä¸‹æ°´å¹³åˆ†è¡¨æ–¹å¼ï¼Œæˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„SpringBooté¡¹ç›®å³å¯ï¼Œä¾èµ–å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">  	<span class="c">&lt;!--  ShardingJDBCä¾èµ–ï¼Œé‚£å¿…é¡»å®‰æ’æœ€æ–°ç‰ˆå•Šï¼Œå¸Œæœ›ä½ ä»¬çœ‹è§†é¢‘çš„æ—¶å€™è¿˜æ˜¯5.Xç‰ˆæœ¬  --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.apache.shardingsphere<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>shardingsphere-jdbc-core-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>5.1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>2.2.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><p>æ•°æ®åº“æˆ‘ä»¬è¿™é‡Œç›´æ¥ç”¨ä¸ŠèŠ‚è¯¾çš„å³å¯ï¼Œå› ä¸ºåªéœ€è¦ä¸¤ä¸ªè¡¨ç»“æ„ä¸€æ ·çš„æ•°æ®åº“å³å¯ï¼Œæ­£å¥½ä¸ŠèŠ‚è¯¾è¿›è¡Œäº†åŒæ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠä»åº“å˜å›æ­£å¸¸çŠ¶æ€å°±å¯ä»¥äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">stop</span><span class="w"> </span><span class="n">replica</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬æŠŠä¸¤ä¸ªè¡¨çš„rootç”¨æˆ·å¯†ç æ”¹ä¸€ä¸‹ï¼Œä¸€ä¼šç”¨è¿™ä¸ªç”¨æˆ·è¿æ¥æ•°æ®åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">authentication_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">alter</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ï¼Œå¦‚æœç›´æ¥å°è¯•å¼€å¯æœåŠ¡å™¨ï¼Œé‚£è‚¯å®šæ˜¯å¼€ä¸äº†çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦é…ç½®æ•°æ®æºï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/GEfPLSIZyobhtTe.jpg" alt="image-20220414212443482" />
    
  </figure>

</p>
<p>é‚£ä¹ˆæ•°æ®æºè¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿç°åœ¨æˆ‘ä»¬æ˜¯ä¸€ä¸ªåˆ†åº“åˆ†è¡¨çš„çŠ¶æ€ï¼Œéœ€è¦é…ç½®ä¸¤ä¸ªæ•°æ®æºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">shardingsphere</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># æœ‰å‡ ä¸ªæ•°æ®å°±é…å‡ ä¸ªï¼Œè¿™é‡Œæ˜¯åç§°ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ ¼å¼ï¼Œåç§°+æ•°å­—çš„å½¢å¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">names</span><span class="p">:</span><span class="w"> </span><span class="l">db0,db1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ä¸ºæ¯ä¸ªæ•°æ®æºå•ç‹¬è¿›è¡Œé…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">db0</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c"># æ•°æ®æºå®ç°ç±»ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤çš„HikariDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.zaxxer.hikari.HikariDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># æ•°æ®åº“é©±åŠ¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># ä¸ç”¨æˆ‘å¤šè¯´äº†å§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">jdbc-url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://192.168.0.8:3306/yyds</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">db1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.zaxxer.hikari.HikariDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">jdbc-url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://192.168.0.13:3306/yyds</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span></span></span></code></pre></div><p>å¦‚æœå¯åŠ¨æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±æ˜¯é…ç½®æˆåŠŸäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/Hvm82dfbEtwBqrA.jpg" alt="image-20220414222958901" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œä¸€äº›ç¼–å†™ï¼Œæ·»åŠ æˆ‘ä»¬çš„ç”¨æˆ·å®ä½“ç±»å’ŒMapperï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@AllArgsConstructor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">passwd</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Mapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserMapper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select * from test where id = #{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Insert</span><span class="p">(</span><span class="s">&#34;insert into test(id, name, passwd) values(#{id}, #{name}, #{passwd})&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">addUser</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å®é™…ä¸Šè¿™äº›æ“ä½œéƒ½æ˜¯å¸¸è§„æ“ä½œï¼Œåœ¨ç¼–å†™ä»£ç æ—¶å…³æ³¨ç‚¹ä¾ç„¶æ”¾åœ¨ä¸šåŠ¡æœ¬èº«ä¸Šï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ShardingJDBCè¦å¦‚ä½•è¿›è¡Œåˆ†ç‰‡ï¼Œé¦–å…ˆæ˜ç¡®ï¼šç°åœ¨æ˜¯ä¸¤ä¸ªæ•°æ®åº“éƒ½æœ‰testè¡¨å­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œæˆ‘ä»¬ç›®æ ‡æ˜¯å°†ç”¨æˆ·ä¿¡æ¯åˆ†åˆ«å­˜æ”¾åˆ°è¿™ä¸¤ä¸ªæ•°æ®åº“çš„è¡¨ä¸­ã€‚</p>
<p>ä¸åºŸè¯äº†ï¼Œç›´æ¥ä¸Šé…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">shardingsphere</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sharding</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        	</span><span class="c">#è¿™é‡Œå¡«å†™è¡¨åç§°ï¼Œç¨‹åºä¸­å¯¹è¿™å¼ è¡¨çš„æ‰€æœ‰æ“ä½œï¼Œéƒ½ä¼šé‡‡ç”¨ä¸‹é¢çš„è·¯ç”±æ–¹æ¡ˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        	</span><span class="c">#æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢Mybatiså°±æ˜¯å¯¹testè¡¨è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥ä¼šèµ°ä¸‹é¢çš„è·¯ç”±æ–¹æ¡ˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">test</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          	</span><span class="c">#è¿™é‡Œå¡«å†™å®é™…çš„è·¯ç”±èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦åˆ†ä¸¤ä¸ªåº“ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠä¸¤ä¸ªåº“éƒ½å†™ä¸Šï¼Œä»¥åŠå¯¹åº”çš„è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          	</span><span class="c">#ä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„å¯ä»¥ç®€å†™ä¸º db$-&gt;{0..1}.test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">actual-data-nodes</span><span class="p">:</span><span class="w"> </span><span class="l">db0.test,db1.test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#è¿™é‡Œæ˜¯åˆ†åº“ç­–ç•¥é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">database-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#è¿™é‡Œé€‰æ‹©æ ‡å‡†ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥é…ç½®å¤æ‚ç­–ç•¥ï¼ŒåŸºäºå¤šä¸ªé”®è¿›è¡Œåˆ†ç‰‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              	</span><span class="c">#å‚ä¸åˆ†ç‰‡è¿ç®—çš„å­—æ®µï¼Œä¸‹é¢çš„ç®—æ³•ä¼šæ ¹æ®è¿™é‡Œæä¾›çš„å­—æ®µè¿›è¡Œè¿ç®—</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c">#è¿™é‡Œå¡«å†™æˆ‘ä»¬ä¸‹é¢è‡ªå®šä¹‰çš„ç®—æ³•åç§°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">my-alg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        	</span><span class="c">#è‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œåç§°éšæ„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">my-alg</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          	</span><span class="c">#ç®—æ³•ç±»å‹ï¼Œå®˜æ–¹å†…ç½®äº†å¾ˆå¤šç§ï¼Œè¿™é‡Œæ¼”ç¤ºæœ€ç®€å•çš„ä¸€ç§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">MOD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">sharding-count</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c">#å¼€å¯æ—¥å¿—ï¼Œä¸€ä¼šæ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nt">sql-show</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>å…¶ä¸­ï¼Œåˆ†ç‰‡ç®—æ³•æœ‰å¾ˆå¤šå†…ç½®çš„ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥è¯¢ï¼šhttps://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/sharding/ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯MODï¼Œä¹Ÿå°±æ˜¯å–æ¨¡åˆ†ç‰‡ç®—æ³•ï¼Œå®ƒä¼šæ ¹æ®ä¸»é”®çš„å€¼è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œå¡«å†™çš„æ˜¯2ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå¯¹ä¸»é”®è¿›è¡Œæ¨¡2è¿ç®—ï¼Œæ ¹æ®æ•°æ®æºçš„åç§°ï¼Œæ¯”å¦‚db0å°±æ˜¯å–æ¨¡åä¸º0ï¼Œdb1å°±æ˜¯å–æ¨¡åä¸º1ï¼ˆå®˜æ–¹æ–‡æ¡£æè¿°çš„å¹¶ä¸æ˜¯å¾ˆæ¸…æ¥šï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€ç»ˆå®ç°çš„æ•ˆæœå°±æ˜¯å•æ•°æ”¾åœ¨<code>db1</code>ï¼ŒåŒæ•°æ”¾åœ¨<code>db0</code>ï¼Œå½“ç„¶å®ƒè¿˜æ”¯æŒä¸€äº›å…¶ä»–çš„ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥çœ‹çœ‹ï¼Œæ˜¯å¦èƒ½å¤ŸæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„è§„åˆ™è¿›è¡Œè·¯ç”±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">ShardingJdbcTestApplicationTests</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//è¿™é‡ŒIDè‡ªåŠ¨ç”Ÿæˆ1-10ï¼Œç„¶åæ’å…¥æ•°æ®åº“</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mapper</span><span class="p">.</span><span class="na">addUser</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;xxx&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;ccc&#34;</span><span class="p">));</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹è¿è¡Œäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/7oBrFRwiXQxcumz.jpg" alt="image-20220415104401263" />
    
  </figure>

</p>
<p>æµ‹è¯•é€šè¿‡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•°æ®åº“é‡Œé¢æ˜¯ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬çš„è§„åˆ™è¿›è¡Œæ•°æ®æ’å…¥çš„ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/kZINi9wmnte3J7g.jpg" alt="image-20220415104449502" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸¤å¼ è¡¨ï¼Œéƒ½æˆåŠŸæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è·¯ç”±è§„åˆ™è¿›è¡Œæ’å…¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¯¦ç»†çš„è·¯ç”±æƒ…å†µï¼Œé€šè¿‡æ§åˆ¶å°è¾“å‡ºçš„SQLå°±å¯ä»¥çœ‹åˆ°ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/2e9cd91031d3fc7d2f11a2f59d8841ae.png" alt="image-20220415105325917" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„SQLè¯­å¥éƒ½æœ‰ä¸€ä¸ªLogic SQLï¼ˆè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åœ¨Mybatisé‡Œé¢å†™çš„ï¼Œæ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼‰ç´§æ¥ç€ä¸‹é¢å°±æ˜¯Actual SQLï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªé€»è¾‘SQLæœ€ç»ˆä¼šæ ¹æ®æˆ‘ä»¬çš„ç­–ç•¥è½¬æ¢ä¸ºå®é™…SQLï¼Œæ¯”å¦‚ç¬¬ä¸€æ¡æ•°æ®ï¼Œå®ƒçš„idæ˜¯0ï¼Œé‚£ä¹ˆå®é™…è½¬æ¢å‡ºæ¥çš„SQLä¼šåœ¨db0è¿™ä¸ªæ•°æ®æºè¿›è¡Œæ’å…¥ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¾ˆè½»æ¾åœ°å®ç°äº†åˆ†åº“ç­–ç•¥ã€‚</p>
<p>åˆ†åº“å®Œæˆä¹‹åï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹åˆ†è¡¨ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬çš„æ•°æ®åº“ä¸­æœ‰<code>test_0</code>å’Œ<code>test_1</code>ä¸¤å¼ è¡¨ï¼Œè¡¨ç»“æ„ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ˜¯å¸Œæœ›èƒ½å¤Ÿæ ¹æ®idå–æ¨¡è¿ç®—çš„ç»“æœåˆ†åˆ«æ”¾åˆ°è¿™ä¸¤ä¸ªä¸åŒçš„è¡¨ä¸­ï¼Œå®ç°æ€è·¯å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œè¿™é‡Œé¦–å…ˆéœ€è¦ä»‹ç»ä¸€ä¸‹ä¸¤ç§è¡¨æ¦‚å¿µï¼š</p>
<ul>
<li><strong>é€»è¾‘è¡¨ï¼š</strong> ç›¸åŒç»“æ„çš„æ°´å¹³æ‹†åˆ†æ•°æ®åº“ï¼ˆè¡¨ï¼‰çš„é€»è¾‘åç§°ï¼Œæ˜¯ SQL ä¸­è¡¨çš„é€»è¾‘æ ‡è¯†ã€‚ ä¾‹ï¼šè®¢å•æ•°æ®æ ¹æ®ä¸»é”®å°¾æ•°æ‹†åˆ†ä¸º 10 å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯ <code>t_order_0</code> åˆ° <code>t_order_9</code>ï¼Œä»–ä»¬çš„é€»è¾‘è¡¨åä¸º <code>t_order</code></li>
<li><strong>çœŸå®è¡¨ï¼š</strong> åœ¨æ°´å¹³æ‹†åˆ†çš„æ•°æ®åº“ä¸­çœŸå®å­˜åœ¨çš„ç‰©ç†è¡¨ã€‚ å³ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ <code>t_order_0</code> åˆ° <code>t_order_9</code></li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å°±ä»¥ä¸€å·æ•°æ®åº“ä¸ºä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨é‡Œé¢åˆ›å»ºä¸Šé¢æåˆ°çš„ä¸¤å¼ è¡¨ï¼Œä¹‹å‰çš„é‚£ä¸ª<code>test</code>è¡¨åˆ ä¸åˆ éƒ½å¯ä»¥ï¼Œå°±å½“åšä¸å­˜åœ¨å°±è¡Œäº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test_0</span><span class="w">  </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">passwd</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test_1</span><span class="w">  </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">passwd</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/InHsNXA3E8dQBPa.jpg" alt="image-20220415110322981" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬ä¸è¦å»ä¿®æ”¹ä»»ä½•çš„ä¸šåŠ¡ä»£ç ï¼ŒMybatisé‡Œé¢å†™çš„æ˜¯ä»€ä¹ˆä¾ç„¶ä¿æŒåŸæ ·ï¼Œå³ä½¿æˆ‘ä»¬çš„è¡¨åå·²ç»å˜äº†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯é€šè¿‡è·¯ç”±æ¥ä¿®æ”¹åŸæœ‰çš„SQLï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">shardingsphere</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sharding</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">test</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">actual-data-nodes</span><span class="p">:</span><span class="w"> </span><span class="l">db0.test_$-&gt;{0..1}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#ç°åœ¨æˆ‘ä»¬æ¥é…ç½®ä¸€ä¸‹åˆ†è¡¨ç­–ç•¥ï¼Œæ³¨æ„è¿™é‡Œæ˜¯table-strategyä¸Šé¢æ˜¯database-strategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">table-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#åŸºæœ¬éƒ½è·Ÿä¹‹å‰æ˜¯ä¸€æ ·çš„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">my-alg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">my-alg</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          	</span><span class="c">#è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹INLINEæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œç¼–å†™è¡¨è¾¾å¼æ¥å†³å®š</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">INLINE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#æ¯”å¦‚æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›è¿›è¡Œæ¨¡2è®¡ç®—å¾—åˆ°æ•°æ®è¯¥å»çš„è¡¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#åªéœ€è¦ç»™ä¸€ä¸ªæœ€ç»ˆçš„è¡¨åç§°å°±è¡Œäº†test_ï¼Œåé¢çš„æ•°å­—æ˜¯è¡¨è¾¾å¼å–æ¨¡ç®—å‡ºçš„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#å®é™…ä¸Šè¿™æ ·å†™å’ŒMODæ¨¡å¼ä¸€æ¨¡ä¸€æ ·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">algorithm-expression</span><span class="p">:</span><span class="w"> </span><span class="l">test_$-&gt;{id % 2}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">#æ²¡é”™ï¼ŒæŸ¥è¯¢ä¹Ÿä¼šæ ¹æ®åˆ†ç‰‡ç­–ç•¥æ¥è¿›è¡Œï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¾ç„¶ä¼šè¿›è¡Œå…¨é‡æŸ¥è¯¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">#è¿™ä¸ªæˆ‘ä»¬åé¢ç´§æ¥ç€ä¼šè®²ï¼Œè¿™é‡Œå…ˆå†™ä¸Šå§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">allow-range-query-with-inline-sharding</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹ä¼šä¸ä¼šæŒ‰ç…§æˆ‘ä»¬çš„ç­–ç•¥è¿›è¡Œåˆ†è¡¨æ’å…¥ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/OaRCMTJ1lnIicSd.jpg" alt="image-20220415112809843" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æˆ‘ä»¬çš„ç®—æ³•ï¼ŒåŸæœ¬çš„é€»è¾‘è¡¨è¢«ä¿®æ”¹ä¸ºäº†æœ€ç»ˆè¿›è¡Œåˆ†è¡¨è®¡ç®—åçš„ç»“æœï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/lfvgOjanPZHMNdr.jpg" alt="image-20220415112908760" />
    
  </figure>

</p>
<p>æ’å…¥æˆ‘ä»¬äº†è§£å®Œæ¯•äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æŸ¥è¯¢å‘¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">ShardingJdbcTestApplicationTests</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">0</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/7K1WBk3s8HuMeOI.jpg" alt="image-20220415113139917" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æˆ‘ä»¬é…ç½®çš„ç­–ç•¥ï¼ŒæŸ¥è¯¢ä¹Ÿä¼šè‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„è¡¨è¿›è¡Œï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰å†…å‘³äº†ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢å‘¢ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select * from test where id between #{start} and #{end}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getUsersByIdRange</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">end</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">ShardingJdbcTestApplicationTests</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">getUsersByIdRange</span><span class="p">(</span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">5</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ‰§è¡Œç»“æœä¼šæ€ä¹ˆæ ·ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/3Hj7s4xqEwiFXJB.jpg" alt="image-20220415113530971" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°INLINEç®—æ³•é»˜è®¤æ˜¯ä¸æ”¯æŒè¿›è¡Œå…¨é‡æŸ¥è¯¢çš„ï¼Œæˆ‘ä»¬å¾—å°†ä¸Šé¢çš„é…ç½®é¡¹æ”¹æˆtrueï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">allow-range-query-with-inline-sharding</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/WoQqNLCXJslBT3D.jpg" alt="image-20220415113652038" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆå‡ºæ¥çš„SQLè¯­å¥æ˜¯ç›´æ¥å¯¹ä¸¤ä¸ªè¡¨éƒ½è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åæ±‚å‡ºä¸€ä¸ªå¹¶é›†å‡ºæ¥ä½œä¸ºæœ€åçš„ç»“æœã€‚</p>
<p>å½“ç„¶é™¤äº†åˆ†ç‰‡ä¹‹å¤–ï¼Œè¿˜æœ‰å¹¿æ’­è¡¨å’Œç»‘å®šè¡¨æœºåˆ¶ï¼Œç”¨äºå¤šç§ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œè¯¦ç»†è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p>


<h3 class="relative group">åˆ†å¸ƒå¼åºåˆ—ç®—æ³• 
    <div id="%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%8F%E5%88%97%E7%AE%97%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%8F%E5%88%97%E7%AE%97%E6%B3%95" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬è®²è§£äº†å¦‚ä½•è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹åˆ†å¸ƒå¼åºåˆ—ç®—æ³•ã€‚</p>
<p>åœ¨å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯å¾®æœæ„æ¶ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹å¤§é‡çš„æ•°æ®å’Œæ¶ˆæ¯è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚éšç€ç³»ç»Ÿçš„å¤æ‚ï¼Œæ•°æ®çš„å¢å¤šï¼Œåˆ†åº“åˆ†è¡¨æˆä¸ºäº†å¸¸è§çš„æ–¹æ¡ˆï¼Œå¯¹æ•°æ®åˆ†åº“åˆ†è¡¨åéœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€IDæ¥æ ‡è¯†ä¸€æ¡æ•°æ®æˆ–æ¶ˆæ¯ï¼ˆå¦‚è®¢å•å·ã€äº¤æ˜“æµæ°´ã€äº‹ä»¶ç¼–å·ç­‰ï¼‰ï¼Œæ­¤æ—¶ä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„ç³»ç»Ÿæ˜¯éå¸¸å¿…è¦çš„ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åˆ›å»ºè¿‡å­¦ç”Ÿä¿¡æ¯è¡¨ã€å›¾ä¹¦å€Ÿé˜…è¡¨ã€å›¾ä¹¦ç®¡ç†è¡¨ï¼Œæ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šæœ‰ä¸€ä¸ªIDä½œä¸ºä¸»é”®ï¼Œå¹¶ä¸”è¿™ä¸ªIDæœ‰ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>ä¸ºäº†åŒºåˆ«äºå…¶ä»–çš„æ•°æ®ï¼Œè¿™ä¸ªIDå¿…é¡»æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚</li>
<li>ä¸»é”®åº”è¯¥å°½å¯èƒ½çš„ä¿æŒæœ‰åºï¼Œè¿™æ ·ä¼šå¤§å¤§æå‡ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œå¦‚ä½•ä¿è¯IDçš„ç”Ÿæˆæ»¡è¶³ä¸Šé¢çš„éœ€æ±‚å‘¢ï¼Ÿ</p>
<ol>
<li>
<p><strong>ä½¿ç”¨UUIDï¼š</strong> UUIDæ˜¯ç”±ä¸€ç»„32ä½æ•°çš„16è¿›åˆ¶æ•°å­—éšæœºæ„æˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨JDKä¸ºæˆ‘ä»¬æä¾›çš„UUIDç±»æ¥åˆ›å»ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">uuid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç»“æœä¸º<code>73d5219b-dc0f-4282-ac6e-8df17bcd5860</code>ï¼Œç”Ÿæˆé€Ÿåº¦éå¸¸å¿«ï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯èƒ½å¤Ÿä¿è¯å”¯ä¸€æ€§ï¼Œå› ä¸ºæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œè€Œä¸”è¿™ä¹ˆé•¿ä¸€ä¸²é‚£é‡å¤çš„æ¦‚ç‡çœŸçš„æ˜¯å°çš„å¯æ€œã€‚</p>
<p>ä½†æ˜¯å®ƒå¹¶ä¸æ»¡è¶³æˆ‘ä»¬ä¸Šé¢çš„ç¬¬äºŒä¸ªè¦æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„ä¿è¯æœ‰åºï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¾—åˆ°çš„éƒ½æ˜¯ä¸€äº›æ— åºçš„IDã€‚</p>
</li>
<li>
<p><strong>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰ï¼š</strong></p>
<p>æˆ‘ä»¬æ¥çœ‹é›ªèŠ±ç®—æ³•ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªä¸€ä¸ª64bitå¤§å°çš„æ•´å‹çš„IDï¼Œintè‚¯å®šæ˜¯è£…ä¸ä¸‹äº†ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/lU9A4zjSIKvaxwh.jpg" alt="image-20220415150713707" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°å®ƒä¸»è¦æ˜¯ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ—¶é—´+å·¥ä½œæœºå™¨ID+åºåˆ—å·ï¼Œæ—¶é—´ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œ41ä¸ªbitä½èƒ½è¡¨ç¤ºçº¦70å¹´çš„æ—¶é—´ï¼Œæ—¶é—´çºªå…ƒä»2016å¹´11æœˆ1æ—¥é›¶ç‚¹å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ°2086å¹´ï¼Œå·¥ä½œæœºå™¨IDå…¶å®å°±æ˜¯èŠ‚ç‚¹IDï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„IDéƒ½ä¸ç›¸åŒï¼Œé‚£ä¹ˆå°±å¯ä»¥åŒºåˆ†å‡ºæ¥ï¼Œ10ä¸ªbitä½å¯ä»¥è¡¨ç¤ºæœ€å¤š1024ä¸ªèŠ‚ç‚¹ï¼Œæœ€å12ä½å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸‹çš„åºåˆ—å·ï¼Œå› æ­¤æ¯å°æœºå™¨æ¯æ¯«ç§’å°±å¯ä»¥æœ‰4096ä¸ªç³»åˆ—å·ã€‚</p>
<p>è¿™æ ·ï¼Œå®ƒå°±å…¼å…·äº†ä¸Šé¢æ‰€è¯´çš„å”¯ä¸€æ€§å’Œæœ‰åºæ€§äº†ï¼Œä½†æ˜¯ä¾ç„¶æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ—¶é—´é—®é¢˜ï¼Œå¦‚æœæœºå™¨æ—¶é—´å‡ºç°å€’é€€ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ç”Ÿæˆé‡å¤çš„IDï¼Œå¹¶ä¸”èŠ‚ç‚¹å®¹é‡åªæœ‰1024ä¸ªï¼Œå¦‚æœæ˜¯è¶…å¤§è§„æ¨¡é›†ç¾¤ï¼Œä¹Ÿæ˜¯å­˜åœ¨éšæ‚£çš„ã€‚</p>
</li>
</ol>
<p>ShardingJDBCæ”¯æŒä»¥ä¸Šä¸¤ç§ç®—æ³•ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”ŸæˆIDï¼Œæ–‡æ¡£ï¼šhttps://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/keygen/</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ˜¯è¦ShardingJDBCæ¥è®©æˆ‘ä»¬çš„ä¸»é”®IDä»¥é›ªèŠ±ç®—æ³•è¿›è¡Œç”Ÿæˆï¼Œé¦–å…ˆæ˜¯é…ç½®æ•°æ®åº“ï¼Œå› ä¸ºæˆ‘ä»¬é»˜è®¤çš„idæ˜¯intç±»å‹ï¼Œè£…ä¸ä¸‹64ä½çš„ï¼Œæ”¹ä¸€ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">yyds</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">test</span><span class="o">`</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">FIRST</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹Mybatisçš„æ’å…¥è¯­å¥ï¼Œå› ä¸ºç°åœ¨idæ˜¯ç”±ShardingJDBCè‡ªåŠ¨ç”Ÿæˆï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦è‡ªå·±åŠ äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Insert</span><span class="p">(</span><span class="s">&#34;insert into test(name, passwd) values(#{name}, #{passwd})&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="nf">addUser</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å°†æˆ‘ä»¬çš„ç®—æ³•å†™ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">shardingsphere</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sharding</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">test</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">actual-data-nodes</span><span class="p">:</span><span class="w"> </span><span class="l">db0.test,db1.test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨åˆ†åº“ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">database-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">sharding-column</span><span class="p">:</span><span class="w"> </span><span class="l">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">sharding-algorithm-name</span><span class="p">:</span><span class="w"> </span><span class="l">my-alg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#è¿™é‡Œä½¿ç”¨è‡ªå®šä¹‰çš„ä¸»é”®ç”Ÿæˆç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">key-generate-strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key-generator-name</span><span class="p">:</span><span class="w"> </span><span class="l">my-gen</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key-generators</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        	</span><span class="c">#è¿™é‡Œå†™æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸»é”®ç”Ÿæˆç®—æ³•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">my-gen</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          	</span><span class="c">#ä½¿ç”¨é›ªèŠ±ç®—æ³•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">SNOWFLAKE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#å·¥ä½œæœºå™¨IDï¼Œä¿è¯å”¯ä¸€å°±è¡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">worker-id</span><span class="p">:</span><span class="w"> </span><span class="m">666</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sharding-algorithms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">my-alg</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">MOD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">sharding-count</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">ShardingJdbcTestApplicationTests</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">20</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mapper</span><span class="p">.</span><span class="na">addUser</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="s">&#34;aaa&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;bbb&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°æ—¥å¿—ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/2JBaqnV8k9OWYfw.jpg" alt="image-20220415154524545" />
    
  </figure>

</p>
<p>åœ¨æ’å…¥çš„æ—¶å€™ï¼Œå°†æˆ‘ä»¬çš„SQLè¯­å¥è‡ªè¡Œæ·»åŠ äº†ä¸€ä¸ªidå­—æ®µï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„å€¼ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æ ¹æ®æˆ‘ä»¬çš„åˆ†åº“ç­–ç•¥åœ¨è¿›è¡Œæ’å…¥æ“ä½œã€‚</p>


<h3 class="relative group">è¯»å†™åˆ†ç¦» 
    <div id="%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¯»å†™åˆ†ç¦»ï¼Œæˆ‘ä»¬ä¹‹å‰å®ç°äº†MySQLçš„ä¸»ä»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†ä¸»åº“ä½œä¸ºè¯»ï¼Œä»åº“ä½œä¸ºå†™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/KRBbGXxhkmUHFIr.jpg" alt="image-20220415155842834" />
    
  </figure>

</p>
<p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯å°†æ•°æ®åº“å˜å›ä¸»ä»çŠ¶æ€ï¼Œç›´æ¥åˆ é™¤å½“å‰çš„è¡¨ï¼Œæˆ‘ä»¬é‡æ–°æ¥è¿‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æˆ‘ä»¬éœ€è¦å°†ä»åº“å¼€å¯åªè¯»æ¨¡å¼ï¼Œåœ¨MySQLé…ç½®ä¸­è¿›è¡Œä¿®æ”¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">read-only</span>    <span class="o">=</span> <span class="s">1</span>
</span></span></code></pre></div><p>è¿™æ ·ä»åº“å°±åªèƒ½è¯»æ•°æ®äº†ï¼ˆä½†æ˜¯rootè´¦å·è¿˜æ˜¯å¯ä»¥å†™æ•°æ®ï¼‰ï¼Œæ¥ç€æˆ‘ä»¬é‡å¯æœåŠ¡å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo systemctl restart mysql.service
</span></span></code></pre></div><p>ç„¶åè¿›å…¥ä¸»åº“ï¼Œçœ‹çœ‹çŠ¶æ€ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/8o4YIB5MysaUuFx.jpg" alt="image-20220415160249024" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬é…ç½®ä¸€ä¸‹ä»åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">change</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">SOURCE_HOST</span><span class="o">=</span><span class="s1">&#39;192.168.0.13&#39;</span><span class="p">,</span><span class="n">SOURCE_USER</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="n">SOURCE_PASSWORD</span><span class="o">=</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="n">SOURCE_LOG_FILE</span><span class="o">=</span><span class="s1">&#39;binlog.000007&#39;</span><span class="p">,</span><span class="n">SOURCE_LOG_POS</span><span class="o">=</span><span class="mi">19845</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">start</span><span class="w"> </span><span class="n">replica</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬åœ¨ä¸»åº“åˆ›å»ºè¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test</span><span class="w">  </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">passwd</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é…ç½®ShardingJDBCäº†ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">shardingsphere</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c">#é…ç½®è¯»å†™åˆ†ç¦»</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">readwrite-splitting</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">data-sources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        	</span><span class="c">#åç§°éšä¾¿å†™</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">user-db</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          	</span><span class="c">#ä½¿ç”¨é™æ€ç±»å‹ï¼ŒåŠ¨æ€Dynamicç±»å‹å¯ä»¥è‡ªåŠ¨å‘ç°auto-aware-data-source-nameï¼Œè¿™é‡Œä¸æ¼”ç¤º</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Static</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">props</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            	</span><span class="c">#é…ç½®å†™åº“ï¼ˆåªèƒ½ä¸€ä¸ªï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">write-data-source-name</span><span class="p">:</span><span class="w"> </span><span class="l">db0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">#é…ç½®ä»åº“ï¼ˆå¤šä¸ªï¼Œé€—å·éš”å¼€ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">read-data-source-names</span><span class="p">:</span><span class="w"> </span><span class="l">db1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">#è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¯ä»¥è‡ªå®šä¹‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">load-balancer-name</span><span class="p">:</span><span class="w"> </span><span class="l">my-load</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">load-balancers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        	</span><span class="c">#è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">my-load</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ROUND_ROBIN</span><span class="w">
</span></span></span></code></pre></div><p>æ³¨æ„æŠŠä¹‹å‰æ”¹çš„ç”¨æˆ·å®ä½“ç±»å’ŒMapperæ”¹å›å»ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸ç”¨è‡ªåŠ¨ç”ŸæˆIDçš„äº†ã€‚æ‰€æœ‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•åœ°å€ï¼šhttps://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/load-balance/</p>
<p>ç°åœ¨æˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootTest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">ShardingJdbcTestApplicationTests</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">addUser</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;aaa&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;bbb&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">10</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿è¡Œçœ‹çœ‹SQLæ—¥å¿—ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/07/zJvqKmfyhVMFLtZ.jpg" alt="image-20220415162741466" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œä¼šç›´æ¥å‘db0è¿›è¡Œæ“ä½œï¼Œè€Œè¯»å–æ“ä½œæ˜¯ä¼šæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œé€‰æ‹©db1è¿›è¡Œæ“ä½œã€‚</p>
<p>è‡³æ­¤ï¼Œå¾®æœåŠ¡åº”ç”¨ç« èŠ‚åˆ°æ­¤ç»“æŸã€‚</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://www.itbaima.cn/document/35v1hbsfcdgagdnw</p>

            </div>
        </div>

        
        <script>
            var oid = "views_doc\\cloud\\äºŒ\\index.md"
            var oid_likes = "likes_doc\\cloud\\äºŒ\\index.md"
        </script>
        
        
        
        <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>

    </section>

    
    <footer style="width: 100%">
        
<details style="margin-left:0px" class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5">
    
    <summary
        class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">
        cloud - è¿™æ˜¯ç³»åˆ—æ–‡ç« ä¹‹ä¸€.
    </summary>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%B8%80/">
            éƒ¨åˆ† 1: SpringCloud 1
        </a>
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%B8%89/">
            éƒ¨åˆ† 2: SpringCloud 2
        </a>
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        éƒ¨åˆ† 3: æœ¬æ–‡
    </div>
    
    


</details>

        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=//localhost:1313/doc/cloud/%E4%BA%8C/&amp;text=SpringCloud%203"
      title="åˆ†äº«åˆ° Twitter"
      aria-label="åˆ†äº«åˆ° Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://t.me/share/url?url=//localhost:1313/doc/cloud/%E4%BA%8C/&amp;resubmit=true&amp;title=SpringCloud%203"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=//localhost:1313/doc/cloud/%E4%BA%8C/&amp;subject=SpringCloud%203"
      title="é€šè¿‡ç”µå­é‚®ä»¶å‘é€"
      aria-label="é€šè¿‡ç”µå­é‚®ä»¶å‘é€"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">ç›¸å…³æ–‡ç« </h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/doc/cloud/%E4%B8%80/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/doc/cloud/%E4%B8%80/featured_hu10698375666893419758.jpeg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/doc/cloud/%E4%B8%80/">SpringCloud 1</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">9 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>
  
  

  <a href="/doc/cloud/%E4%B8%89/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/doc/cloud/%E4%B8%89/featured_hu10698375666893419758.jpeg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/doc/cloud/%E4%B8%89/">SpringCloud 2</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">11 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>
  
  

  <a href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/java/%E7%BC%93%E5%AD%98/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/java/%E7%BC%93%E5%AD%98/featured_hu17933875345663538948.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/java/%E7%BC%93%E5%AD%98/">Redis</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-10-03 20:31:04 &#43;0800 CST">3 October 2023</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">2 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/%E7%BC%93%E5%AD%98/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    ç¼“å­˜
  </span>
</span>
  </span>
  
  
  
  
</div>



        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>
  
</section>


        
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/doc/design/%E5%88%9B%E5%BB%BA%E5%9E%8B/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97---%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BA%8C%E5%88%9B%E5%BB%BA%E5%9E%8B/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >åˆ›å»ºå‹</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/doc/cloud/%E4%B8%89/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >SpringCloud 2</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


        
        
        <div class="pt-3">
            <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
            <div class="pt-3">
                















<br/>
<span style="color:rgba(var(--color-neutral-400),var(--tw-text-opacity));">
    <span class="post-meta-item-text" >&nbsp;&nbsp;:  </span>
    <span class="waline-pageview-count">â³</span><div></div><br/>
</span>






<script src='/waline/waline.js'></script>
<link href='/waline/waline.css' rel='stylesheet' />
<div id="vcomments"></div>
<script>
    if (""=="zh-CN") {
        Waline.init({
            el: '#vcomments',
            serverURL: 'https://comment-eosin.vercel.app/',
            emoji: ['https://valine-emoji.bili33.top/bilibilitv','https://valine-emoji.bili33.top/bilibiliHotKey','https://valine-emoji.bili33.top/Tieba-New','https://valine-emoji.bili33.top/weibo',],
            meta:['nick', 'mail', 'link'],
            pageview: true,
            reaction: true,
            lang: "zh-CN",
            locale: {
                reactionTitle: 'â€¢ç•…æ‰€æ¬²è¨€â€”â€”è¿™é‡Œæ˜¯å¼€æ”¾åŒºâ€¢',
                comment: 'ç•™è¨€æ¿',
                placeholder: 'ç‚¹å‡»ä¸‹æ–¹ç™»å½•åå†è¯„è®ºï¼Œä¼šæœ‰æƒŠå–œå“¦~',
                gifSearchPlaceholder: 'æœç´¢è¡¨æƒ…åŒ…...',
                admin: 'ä½œè€…',
                sofa: 'è¿˜æ²¡æœ‰äººè¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§',
                anonymous: 'åŒ¿åè€…'
            }
        });

    }
    else {
        Waline.init({
            el: '#vcomments',
            serverURL: 'https://comment-eosin.vercel.app/',
            emoji: ['https://valine-emoji.bili33.top/bilibilitv','https://valine-emoji.bili33.top/bilibiliHotKey','https://valine-emoji.bili33.top/Tieba-New','https://valine-emoji.bili33.top/weibo',],
            meta:['nick', 'mail'],
            pageview: true,
            reaction: true,
            
            lang: "zh-CN",
            locale: {
                reactionTitle: 'â€¢ç•…æ‰€æ¬²è¨€â€”â€”è¿™é‡Œæ˜¯å¼€æ”¾åŒºâ€¢',
                comment: 'ç•™è¨€æ¿',
                placeholder: 'ç‚¹å‡»ä¸‹æ–¹ç™»å½•åå†è¯„è®ºï¼Œä¼šæœ‰æƒŠå–œå“¦~',
                gifSearchPlaceholder: 'æœç´¢è¡¨æƒ…åŒ…...',
                admin: 'ä½œè€…',
                sofa: 'è¿˜æ²¡æœ‰äººè¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§',
                anonymous: 'åŒ¿åè€…'
            }
    });

    }
    document.getElementsByClassName('wl-power')[0].style.display = 'none';
    document.querySelector(".wl-actions a").style.display = 'none'
</script>
<style type="text/css">
    :root{
        --waline-color: var(--tw-prose-quotes);
        --waline-info-color: var(--tw-prose-quotes);
        --waline-info-bgcolor: var(--tw-ring-color);
        --waline-theme-color: rgba(var(--color-primary-400));
        --waline-bgcolor: transparent;
        --waline-border-color: #747474;
    }
    .wl-editor:focus, .wl-input:focus {
        background: transparent;
    }
    .wl-editor,.wl-input{
        max-width:88%;
    }
    .wl-reaction-item.active .wl-reaction-votes {
        color: white;
    }
</style>

<script type="text/javascript">
    var pagect = document.getElementById('pagec');
    var observer = new MutationObserver(function(){
        var itl,itll;
        var element = document.getElementById("pagec");
        observer.disconnect();
        itl  = element.innerText;
        itll = Number(itl).toLocaleString();
        document.getElementById('pagec').innerHTML = itll;
    });
    var article = document.getElementById('pagec');

    var options = {
        'childList': true,
        'subtree': true
    };

    observer.observe(article, options);
</script>

            </div>
        </div>
        
        
    </footer>

</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="å›åˆ°é¡¶éƒ¨" title="å›åˆ°é¡¶éƒ¨">
    &uarr;
  </a>
</div>
    </main>

<div class="busuanzi-footer" style="margin-top: 40px">
  <span id="busuanzi_container_site_pv">
    æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
  </span>
  <span id="busuanzi_container_site_uv">
    æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
  </span>
</div><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/tags/"
            title="">ç³»åˆ—æ–‡ç« </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/tasks/"
            title="">äº‹é¡¹</a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/info/"
            title="">å…³äºæˆ‘</a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/doc/"
            title="">æ–‡æ¡£</a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      ç”± <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> å¼ºåŠ›é©±åŠ¨
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="//localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="æœç´¢"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="å…³é—­ (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
