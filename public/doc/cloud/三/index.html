<!DOCTYPE html>
<html lang="zh-CN" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-CN" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>SpringCloud 2 &middot; æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ</title>
  <meta name="title" content="SpringCloud 2 &middot; æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" />
  
  <meta name="description" content="A powerful, lightweight theme for Hugo built with Tailwind CSS." />
  
  
  
  <link rel="canonical" href="//localhost:1313/doc/cloud/%E4%B8%89/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.ac59a1b8eaafef739c129d12787ac29f6a420bcb348c7aeec8949a8d0b7d6c2023766c169d14b9031b751504eb3c976efe786fec135b340a49868acd8caa4127.css"
    integrity="sha512-rFmhuOqv73OcEp0SeHrCn2pCC8s0jHruyJSajQt9bCAjdmwWnRS5Axt1FQTrPJdu/nhv7BNbNApJhorNjKpBJw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.949e93ad68f98f91b41032983a7aee8da40cd845c548ac475ad1b4771bb9d273da1fb4d059d4d2f8f724a6a7ce5962b522b302ed72b43b8a1057a0e4e3ffc58e.js"
    integrity="sha512-lJ6TrWj5j5G0EDKYOnrujaQM2EXFSKxHWtG0dxu50nPaH7TQWdTS&#43;PckpqfOWWK1IrMC7XK0O4oQV6Dk4//Fjg==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:url" content="//localhost:1313/doc/cloud/%E4%B8%89/">
  <meta property="og:site_name" content="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ">
  <meta property="og:title" content="SpringCloud 2">
  <meta property="og:description" content="å¾®æœåŠ¡è¿›é˜¶ #å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š
æ³¨å†Œä¸­å¿ƒï¼š Eurekaï¼ˆå±äºNetflixï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æºï¼Œ1.xç‰ˆæœ¬ä»åœ¨æ›´æ–°ï¼‰ æœåŠ¡è°ƒç”¨ï¼š Ribbonï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€SpringCloud Loadbalancerï¼ˆå±äºSpringCloudå®˜æ–¹ï¼Œç›®å‰çš„é»˜è®¤æ–¹æ¡ˆï¼‰ æœåŠ¡é™çº§ï¼š Hystrixï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ è·¯ç”±ç½‘å…³ï¼š Zuulï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€Gatewayï¼ˆå±äºSpringCloudå®˜æ–¹ï¼Œæ¨èæ–¹æ¡ˆï¼‰ é…ç½®ä¸­å¿ƒï¼š Configï¼ˆå±äºSpringCloudå®˜æ–¹ï¼‰ å¯è§ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•´å¥—è§£å†³æ–¹æ¡ˆä¸­ï¼Œè¶…è¿‡åŠæ•°çš„ç»„ä»¶éƒ½å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”éƒ¨åˆ†ç»„ä»¶éƒ½æ˜¯SpringCloudå®˜æ–¹å‡ºæ‰‹æä¾›æ¡†æ¶è¿›è¡Œè§£å†³ï¼Œå› æ­¤ï¼Œå¯»æ‰¾ä¸€å¥—æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠ¿åœ¨å¿…è¡Œï¼Œä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼šSpringCloud Alibaba
é˜¿é‡Œå·´å·´ä½œä¸ºä¸šç•Œçš„äº’è”ç½‘å¤§å‚ï¼Œç»™å‡ºäº†ä¸€å¥—å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹ç½‘ç«™ï¼ˆä¸­æ–‡ï¼‰ï¼šhttps://spring-cloud-alibaba-group.github.io/github-pages/2021/zh-cn/index.html
Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚
ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œåˆ†å¸ƒå¼åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="doc">
    <meta property="og:image" content="//localhost:1313/doc/cloud/%E4%B8%89/featured.jpeg">
      <meta property="og:see_also" content="//localhost:1313/doc/cloud/%E4%B8%80/">
      <meta property="og:see_also" content="//localhost:1313/doc/cloud/%E4%BA%8C/">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//localhost:1313/doc/cloud/%E4%B8%89/featured.jpeg">
  <meta name="twitter:title" content="SpringCloud 2">
  <meta name="twitter:description" content="å¾®æœåŠ¡è¿›é˜¶ #å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š
æ³¨å†Œä¸­å¿ƒï¼š Eurekaï¼ˆå±äºNetflixï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æºï¼Œ1.xç‰ˆæœ¬ä»åœ¨æ›´æ–°ï¼‰ æœåŠ¡è°ƒç”¨ï¼š Ribbonï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€SpringCloud Loadbalancerï¼ˆå±äºSpringCloudå®˜æ–¹ï¼Œç›®å‰çš„é»˜è®¤æ–¹æ¡ˆï¼‰ æœåŠ¡é™çº§ï¼š Hystrixï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ è·¯ç”±ç½‘å…³ï¼š Zuulï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€Gatewayï¼ˆå±äºSpringCloudå®˜æ–¹ï¼Œæ¨èæ–¹æ¡ˆï¼‰ é…ç½®ä¸­å¿ƒï¼š Configï¼ˆå±äºSpringCloudå®˜æ–¹ï¼‰ å¯è§ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•´å¥—è§£å†³æ–¹æ¡ˆä¸­ï¼Œè¶…è¿‡åŠæ•°çš„ç»„ä»¶éƒ½å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”éƒ¨åˆ†ç»„ä»¶éƒ½æ˜¯SpringCloudå®˜æ–¹å‡ºæ‰‹æä¾›æ¡†æ¶è¿›è¡Œè§£å†³ï¼Œå› æ­¤ï¼Œå¯»æ‰¾ä¸€å¥—æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠ¿åœ¨å¿…è¡Œï¼Œä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼šSpringCloud Alibaba
é˜¿é‡Œå·´å·´ä½œä¸ºä¸šç•Œçš„äº’è”ç½‘å¤§å‚ï¼Œç»™å‡ºäº†ä¸€å¥—å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹ç½‘ç«™ï¼ˆä¸­æ–‡ï¼‰ï¼šhttps://spring-cloud-alibaba-group.github.io/github-pages/2021/zh-cn/index.html
Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚
ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œåˆ†å¸ƒå¼åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Docs",
    "name": "SpringCloud 2",
    "headline": "SpringCloud 2",
    
    "abstract": "å¾®æœåŠ¡è¿›é˜¶ #\rå‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š\næ³¨å†Œä¸­å¿ƒï¼š Eurekaï¼ˆå±äºNetflixï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æºï¼Œ1.xç‰ˆæœ¬ä»åœ¨æ›´æ–°ï¼‰ æœåŠ¡è°ƒç”¨ï¼š Ribbonï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€SpringCloud Loadbalancerï¼ˆå±äºSpringCloudå®˜æ–¹ï¼Œç›®å‰çš„é»˜è®¤æ–¹æ¡ˆï¼‰ æœåŠ¡é™çº§ï¼š Hystrixï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ è·¯ç”±ç½‘å…³ï¼š Zuulï¼ˆå±äºNetflixï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€Gatewayï¼ˆå±äºSpringCloudå®˜æ–¹ï¼Œæ¨èæ–¹æ¡ˆï¼‰ é…ç½®ä¸­å¿ƒï¼š Configï¼ˆå±äºSpringCloudå®˜æ–¹ï¼‰ å¯è§ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•´å¥—è§£å†³æ–¹æ¡ˆä¸­ï¼Œè¶…è¿‡åŠæ•°çš„ç»„ä»¶éƒ½å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”éƒ¨åˆ†ç»„ä»¶éƒ½æ˜¯SpringCloudå®˜æ–¹å‡ºæ‰‹æä¾›æ¡†æ¶è¿›è¡Œè§£å†³ï¼Œå› æ­¤ï¼Œå¯»æ‰¾ä¸€å¥—æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠ¿åœ¨å¿…è¡Œï¼Œä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼šSpringCloud Alibaba\né˜¿é‡Œå·´å·´ä½œä¸ºä¸šç•Œçš„äº’è”ç½‘å¤§å‚ï¼Œç»™å‡ºäº†ä¸€å¥—å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹ç½‘ç«™ï¼ˆä¸­æ–‡ï¼‰ï¼šhttps:\/\/spring-cloud-alibaba-group.github.io\/github-pages\/2021\/zh-cn\/index.html\nSpring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚\nä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œåˆ†å¸ƒå¼åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚",
    "inLanguage": "zh-CN",
    "url" : "\/\/localhost:1313\/doc\/cloud\/%E4%B8%89\/",
    "author" : {
      "@type": "Person",
      "name": "æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "2230"
  }]
  </script>


  
  
  <meta name="author" content="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" />
  
  
  
  <link href="https://space.bilibili.com/159283119?spm_id_from=333.1007.0.0" rel="me" />
  
  
  <link href="https://github.com/ToDreamr" rel="me" />
  
  
  <link href="mailto:aruixrain@gmail.com" rel="me" />
  
  
  <link href="https://music.163.com/#/user/home?id=568083850" rel="me" />
  
  
  <link href="https://gitee.com/rainyheights" rel="me" />
  
  
  <link href="https://www.zhihu.com/people/san-qiu-luo-yue" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-PEDMYR1V0K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PEDMYR1V0K');
</script>


  
  
  <meta name="theme-color"/>

  
  

  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade"></head>


<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>è·³åˆ°æ–‡ç« å¼€å¤´</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div id="top-menu" style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px ;height: 70px;font-family: åæ–‡ä¸­å®‹,serif;"
     class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3" >
  
  
  
  <div>
    <a href="/" class="flex">
    <span class="sr-only">æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ</span>

    <img src="/img/author.png" width="16" height="16"
         class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" />

    </a>
  </div>
  

  <div class="flex flex-1 items-center justify-between">

    <nav class="flex space-x-3">

      
      <a id="title-href" href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ</a>
      

    </nav>
    <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

      
      
      
  <a href="/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        é¦–é¡µ
    </p>
</a>


      
      
  <a href="/all/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        å…¨éƒ¨
    </p>
</a>


      
      
  <a href="/algorithm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        ç®—æ³•
    </p>
</a>


      
      
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        å½’ç±»
    </p>
</a>


      
      
  <a href="/friend/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        å‹é“¾ğŸ§‘â€ğŸ¤â€ğŸ§‘
    </p>
</a>


      
       
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      æ›´å¤šğŸ˜º
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/media/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç”µå½±ğŸ¥
          </p>
        </a>
        
        <a href="/life-about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç”Ÿæ´»ç›¸å…³ğŸŒ¿
          </p>
        </a>
        
        <a href="/music/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            éŸ³ä¹ğŸµ
          </p>
        </a>
        
        <a href="/%E7%AC%94%E8%AE%B0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç¬”è®°(æ¯”è¾ƒä¹±)ğŸ¦
          </p>
        </a>
        
        <a href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            ç¼–ç¨‹è¯­è¨€ğŸ’»
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



      
      

      


      
      <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12"
              title="">
      

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


      </button>

      


      
      
      <div
              class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400">
        <button id="appearance-switcher" aria-label="Dark mode switcher" type="button">
          <div class="flex items-center justify-center h-12 dark:hidden">
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


          </div>
          <div class="items-center justify-center hidden h-12 dark:flex">
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


          </div>
        </button>

      </div>
      

    </nav>
    <div class="flex md:hidden items-center space-x-5 md:ml-12">

      <span></span>

      


      
      <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="">
      

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


      </button>
      

      
      
      <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" style="margin-right:5px">
        <div class="flex items-center justify-center h-12 dark:hidden">
          

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


        </div>
        <div class="items-center justify-center hidden h-12 dark:flex">
          

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


        </div>
      </button>
      

    </div>

  </div>
  <div class="-my-2 -mr-2 md:hidden">

    <label id="menu-button" for="menu-controller" class="block">
      <input type="checkbox" id="menu-controller" class="hidden" />
      
      <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


      </div>
      <div id="menu-wrapper" style="padding-top:5px;"
           class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
        <ul
                class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

          <li>
                        <span
                                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
          </li>

          

          
  <li class="mt-1">
    <a href="/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            é¦–é¡µ
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/all/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            å…¨éƒ¨
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/algorithm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            ç®—æ³•
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            å½’ç±»
        </p>
    </a>
</li>



          

          
  <li class="mt-1">
    <a href="/friend/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            å‹é“¾ğŸ§‘â€ğŸ¤â€ğŸ§‘
        </p>
    </a>
</li>



          

           
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            æ›´å¤šğŸ˜º
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/media/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç”µå½±ğŸ¥
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/life-about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç”Ÿæ´»ç›¸å…³ğŸŒ¿
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/music/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            éŸ³ä¹ğŸµ
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/%E7%AC%94%E8%AE%B0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç¬”è®°(æ¯”è¾ƒä¹±)ğŸ¦
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            ç¼–ç¨‹è¯­è¨€ğŸ’»
        </p>
    </a>
</li>

<li class="mb-2"></li>



          

        </ul>
        
        

      </div>
    </label>
  </div>






  </div>
<style>
  .change-music{
    margin-top: 20px;
    width: 8%;
    height: 50%;
    font-family: åæ–‡ä¸­å®‹,serif;
     
     
     
  }
</style>
<script>
  
  var MusicLists=[];
  var musicUrl="";
  function getMusicList()
  {
    
    MusicLists.push
    (29567192,1974443814,447926067,447925058,1974444808,
            1974444807,29567187
    );
    var musicIndex=Math.floor(Math.random()*MusicLists.length+1);
    console.log(musicIndex);
    
    musicUrl="https://music.163.com/outchain/player?type=2&id="+MusicLists[musicIndex]+"&auto=1&height=66";
    var frame=document.getElementById("music");
    var player=document.getElementsByName('player');
    console.log(player);
    frame.src=musicUrl;
  }
</script>






<script>
  (function () {
    var $mainmenu = $('.main-menu');
    var path = window.location.pathname;
    $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
      $(e).children('p').addClass('active');
    });
  })();
  
  (function (){
    var title=document.getElementById('title-href');
    var music=document.getElementById('music');
    var button=document.getElementById('music-button');
    var width=window.innerWidth;
    var height=window.innerHeight;
    if (width<420||height<820){
      title.innerText='Rainy-Heights'
      button.innerText='';
      music.style.width=0;
      music.style.height=0;
      button.style.height=0;
      button.style.height=0;
      var child = document.getElementById('music-div');
      var father = document.getElementById('top-menu');
      father.removeChild(child)
      father.removeChild(button)
    }
  })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
    
    
    
    
    
    


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/doc/cloud/%E4%B8%89/featured_hu12660636931170872844.jpeg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

    
    

    <header id="single_header" class="mt-5 max-w-prose">
        
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      ></a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/doc/"
      >Docs</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/doc/cloud/%E4%B8%89/"
      >SpringCloud 2</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


        
        <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral" style="font-family: åæ–‡ä¸­å®‹,serif">
            SpringCloud 2
        </h1>
        <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
            





  
  







  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">11 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



        </div>

        
        
        
        
        

        
        
        
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ" src="/img/%E4%B8%89%E5%8F%B6_hu18175999898255885363.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      ä½œè€…
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">é‡æ¹–å ğª©˜æ¸…å˜‰ã€‚æœ‰ä¸‰ç§‹æ¡‚å­ï¼Œåé‡Œè·èŠ±ã€‚ç¾Œç®¡å¼„æ™´ï¼Œè±æ­Œæ³›å¤œï¼Œå¬‰å¬‰é’“åŸè²å¨ƒã€‚åƒéª‘æ‹¥é«˜ç‰™ã€‚ä¹˜é†‰å¬ç®«é¼“ï¼ŒåŸèµçƒŸéœã€‚å¼‚æ—¥å›¾å°†å¥½æ™¯ï¼Œå½’å»å‡¤æ± å¤¸ã€‚</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://space.bilibili.com/159283119?spm_id_from=333.1007.0.0"
          target="_blank"
          aria-label="Bilibili"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1699377062375" class="icon" viewBox="0 0 1129 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4167" xmlns:xlink="http://www.w3.org/1999/xlink" width="220.5078125" height="200"><path d="M234.909 9.656a80.468 80.468 0 0 1 68.398 0 167.374 167.374 0 0 1 41.843 30.578l160.937 140.82h115.07l160.936-140.82a168.983 168.983 0 0 1 41.843-30.578A80.468 80.468 0 0 1 930.96 76.445a80.468 80.468 0 0 1-17.703 53.914 449.818 449.818 0 0 1-35.406 32.187 232.553 232.553 0 0 1-22.531 18.508h100.585a170.593 170.593 0 0 1 118.289 53.109 171.397 171.397 0 0 1 53.914 118.288v462.693a325.897 325.897 0 0 1-4.024 70.007 178.64 178.64 0 0 1-80.468 112.656 173.007 173.007 0 0 1-92.539 25.75h-738.7a341.186 341.186 0 0 1-72.421-4.024A177.835 177.835 0 0 1 28.91 939.065a172.202 172.202 0 0 1-27.36-92.539V388.662a360.498 360.498 0 0 1 0-66.789A177.03 177.03 0 0 1 162.487 178.64h105.414c-16.899-12.07-31.383-26.555-46.672-39.43a80.468 80.468 0 0 1-25.75-65.984 80.468 80.468 0 0 1 39.43-63.57M216.4 321.873a80.468 80.468 0 0 0-63.57 57.937 108.632 108.632 0 0 0 0 30.578v380.615a80.468 80.468 0 0 0 55.523 80.469 106.218 106.218 0 0 0 34.601 5.632h654.208a80.468 80.468 0 0 0 76.444-47.476 112.656 112.656 0 0 0 8.047-53.109v-354.06a135.187 135.187 0 0 0 0-38.625 80.468 80.468 0 0 0-52.304-54.719 129.554 129.554 0 0 0-49.89-7.242H254.22a268.764 268.764 0 0 0-37.82 0z m0 0" fill="#20B0E3" p-id="4168"></path><path d="M348.369 447.404a80.468 80.468 0 0 1 55.523 18.507 80.468 80.468 0 0 1 28.164 59.547v80.468a80.468 80.468 0 0 1-16.094 51.5 80.468 80.468 0 0 1-131.968-9.656 104.609 104.609 0 0 1-10.46-54.719v-80.468a80.468 80.468 0 0 1 70.007-67.593z m416.02 0a80.468 80.468 0 0 1 86.102 75.64v80.468a94.148 94.148 0 0 1-12.07 53.11 80.468 80.468 0 0 1-132.773 0 95.757 95.757 0 0 1-12.875-57.133V519.02a80.468 80.468 0 0 1 70.007-70.812z m0 0" fill="#20B0E3" p-id="4169"></path></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/ToDreamr"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:aruixrain@gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://music.163.com/#/user/home?id=568083850"
          target="_blank"
          aria-label="Wangyi"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1707154946293" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2586" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M0 0m184.32 0l655.36 0q184.32 0 184.32 184.32l0 655.36q0 184.32-184.32 184.32l-655.36 0q-184.32 0-184.32-184.32l0-655.36q0-184.32 184.32-184.32Z" fill="#EA3E3C" p-id="2587"></path><path d="M527.616 849.43872a373.6064 373.6064 0 0 1-162.54976-39.00416c-112.36352-55.16288-180.00896-176.29184-172.55424-308.67456 7.41376-130.34496 85.10464-237.4656 202.752-279.552a35.85024 35.85024 0 0 1 24.15616 67.51232c-107.66336 38.49216-150.81472 136.86784-155.29984 216.13568-5.86752 103.51616 46.08 197.79584 132.34176 240.13824 124.69248 60.30336 216.91392 22.35392 260.82304-5.64224 59.8016-38.16448 97.86368-100.01408 96.95232-157.55264-1.024-63.72352-24.064-120.99584-63.27296-157.14304a145.408 145.408 0 0 0-65.5872-35.28704q2.82624 9.76896 5.64224 19.32288c13.38368 45.63968 24.94464 85.05344 25.6 114.40128a134.26688 134.26688 0 0 1-37.69344 97.76128 139.1104 139.1104 0 0 1-100.6592 40.45824 140.10368 140.10368 0 0 1-100.47488-42.24 169.12384 169.12384 0 0 1-46.2848-122.76736c1.19808-85.12512 80.11776-153.28256 162.816-175.104a324.80256 324.80256 0 0 1-6.71744-67.05152 92.0576 92.0576 0 0 1 69.18144-91.81184c46.21312-12.53376 104.448 5.19168 124.66176 37.888a35.84 35.84 0 0 1-11.70432 49.31584 35.84 35.84 0 0 1-49.26464-11.65312 62.34112 62.34112 0 0 0-48.45568-5.21216c-4.32128 1.71008-12.35968 4.90496-12.76928 23.10144a270.87872 270.87872 0 0 0 6.73792 58.51136 217.4976 217.4976 0 0 1 133.56032 57.6512c53.57568 49.38752 85.0432 125.46048 86.35392 208.71168 1.29024 81.85856-49.7664 167.86432-130.048 219.136a310.14912 310.14912 0 0 1-168.2432 48.65024z m23.6544-457.55392c-56.77056 15.6672-107.4688 63.03744-108.07296 106.42432a98.304 98.304 0 0 0 25.6512 71.43424 68.0448 68.0448 0 0 0 49.36704 20.87936 67.24608 67.24608 0 0 0 49.44896-18.944 63.19104 63.19104 0 0 0 17.23392-46.08c-0.4096-19.79392-11.7248-58.368-22.67136-95.6928-3.61472-12.42112-7.35232-25.14944-10.9568-38.02112z" fill="#FFFFFF" p-id="2588"></path></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://gitee.com/rainyheights"
          target="_blank"
          aria-label="Gitee"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1714489642084" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6457" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M512 960A448 448 0 1 1 512 64a448 448 0 0 1 0 896z m226.752-497.792H484.352a22.144 22.144 0 0 0-22.144 22.144v55.296c0 12.224 9.92 22.144 22.08 22.144h154.88c12.288 0 22.144 9.92 22.144 22.08v11.072c0 36.672-29.696 66.368-66.368 66.368H384.768a22.144 22.144 0 0 1-22.08-22.08V429.056c0-36.672 29.696-66.368 66.304-66.368h309.76c12.16 0 22.08-9.92 22.08-22.144v-55.296a22.144 22.144 0 0 0-22.08-22.144h-309.76a165.888 165.888 0 0 0-165.888 165.952v309.696c0 12.224 9.92 22.144 22.144 22.144h326.272a149.312 149.312 0 0 0 149.376-149.312V484.352a22.144 22.144 0 0 0-22.144-22.144z" fill="#C71D23" p-id="6458"></path></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.zhihu.com/people/san-qiu-luo-yue"
          target="_blank"
          aria-label="Zhihu"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1707288662942" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5244" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M564.7 230.1V803h60l25.2 71.4L756.3 803h131.5V230.1H564.7z m247.7 497h-59.9l-75.1 50.4-17.8-50.4h-18V308.3h170.7v418.8zM526.1 486.9H393.3c2.1-44.9 4.3-104.3 6.6-172.9h130.9l-0.1-8.1c0-0.6-0.2-14.7-2.3-29.1-2.1-15-6.6-34.9-21-34.9H287.8c4.4-20.6 15.7-69.7 29.4-93.8l6.4-11.2-12.9-0.7c-0.8 0-19.6-0.9-41.4 10.6-35.7 19-51.7 56.4-58.7 84.4-18.4 73.1-44.6 123.9-55.7 145.6-3.3 6.4-5.3 10.2-6.2 12.8-1.8 4.9-0.8 9.8 2.8 13 10.5 9.5 38.2-2.9 38.5-3 0.6-0.3 1.3-0.6 2.2-1 13.9-6.3 55.1-25 69.8-84.5h56.7c0.7 32.2 3.1 138.4 2.9 172.9h-141l-2.1 1.5c-23.1 16.9-30.5 63.2-30.8 65.2l-1.4 9.2h167c-12.3 78.3-26.5 113.4-34 127.4-3.7 7-7.3 14-10.7 20.8-21.3 42.2-43.4 85.8-126.3 153.6-3.6 2.8-7 8-4.8 13.7 2.4 6.3 9.3 9.1 24.6 9.1 5.4 0 11.8-0.3 19.4-1 49.9-4.4 100.8-18 135.1-87.6 17-35.1 31.7-71.7 43.9-108.9L497 850l5-12c0.8-1.9 19-46.3 5.1-95.9l-0.5-1.8-108.1-123-22 16.6c6.4-26.1 10.6-49.9 12.5-71.1h158.7v-8c0-40.1-18.5-63.9-19.2-64.9l-2.4-3z" fill="#1296DB" p-id="5245"></path></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

        

        

        

        
        <div class="mb-5"></div>
        

    </header>

    
    
    <div  class="meta-item">&nbspÂ·&nbsp
        <span id="busuanzi_container_page_pv">é¡µé¢ç‚¹å‡»é‡:<span id="busuanzi_value_page_pv"></span>æ¬¡</span>
    </div>


    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row" style="font-family: åæ–‡ä¸­å®‹,serif">

        
        <div style="width: 28%" class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
            <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

             <details open class="toc-right mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    ç›®å½•
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#å¾®æœåŠ¡è¿›é˜¶">å¾®æœåŠ¡è¿›é˜¶</a>
      <ul>
        <li><a href="#nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ">Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ</a>
          <ul>
            <li><a href="#å®‰è£…ä¸éƒ¨ç½²">å®‰è£…ä¸éƒ¨ç½²</a></li>
            <li><a href="#æœåŠ¡æ³¨å†Œä¸å‘ç°">æœåŠ¡æ³¨å†Œä¸å‘ç°</a></li>
            <li><a href="#é›†ç¾¤åˆ†åŒº">é›†ç¾¤åˆ†åŒº</a></li>
            <li><a href="#é…ç½®ä¸­å¿ƒ">é…ç½®ä¸­å¿ƒ</a></li>
            <li><a href="#å‘½åç©ºé—´">å‘½åç©ºé—´</a></li>
            <li><a href="#å®ç°é«˜å¯ç”¨">å®ç°é«˜å¯ç”¨</a></li>
          </ul>
        </li>
        <li><a href="#sentinel-æµé‡é˜²å«å…µ">Sentinel æµé‡é˜²å«å…µ</a>
          <ul>
            <li><a href="#å®‰è£…ä¸éƒ¨ç½²-1">å®‰è£…ä¸éƒ¨ç½²</a></li>
            <li><a href="#æµé‡æ§åˆ¶">æµé‡æ§åˆ¶</a></li>
            <li><a href="#é™æµå’Œå¼‚å¸¸å¤„ç†">é™æµå’Œå¼‚å¸¸å¤„ç†</a></li>
            <li><a href="#çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ</a></li>
            <li><a href="#æœåŠ¡ç†”æ–­å’Œé™çº§">æœåŠ¡ç†”æ–­å’Œé™çº§</a></li>
          </ul>
        </li>
        <li><a href="#seataä¸åˆ†å¸ƒå¼äº‹åŠ¡">Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡</a>
          <ul>
            <li><a href="#é¡¹ç›®ç¯å¢ƒæ­å»º">é¡¹ç›®ç¯å¢ƒæ­å»º</a></li>
            <li><a href="#åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ">åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</a></li>
            <li><a href="#seataæœºåˆ¶ç®€ä»‹">Seataæœºåˆ¶ç®€ä»‹</a></li>
            <li><a href="#ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²">ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²</a></li>
            <li><a href="#ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²">ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    ç›®å½•
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#å¾®æœåŠ¡è¿›é˜¶">å¾®æœåŠ¡è¿›é˜¶</a>
      <ul>
        <li><a href="#nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ">Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ</a>
          <ul>
            <li><a href="#å®‰è£…ä¸éƒ¨ç½²">å®‰è£…ä¸éƒ¨ç½²</a></li>
            <li><a href="#æœåŠ¡æ³¨å†Œä¸å‘ç°">æœåŠ¡æ³¨å†Œä¸å‘ç°</a></li>
            <li><a href="#é›†ç¾¤åˆ†åŒº">é›†ç¾¤åˆ†åŒº</a></li>
            <li><a href="#é…ç½®ä¸­å¿ƒ">é…ç½®ä¸­å¿ƒ</a></li>
            <li><a href="#å‘½åç©ºé—´">å‘½åç©ºé—´</a></li>
            <li><a href="#å®ç°é«˜å¯ç”¨">å®ç°é«˜å¯ç”¨</a></li>
          </ul>
        </li>
        <li><a href="#sentinel-æµé‡é˜²å«å…µ">Sentinel æµé‡é˜²å«å…µ</a>
          <ul>
            <li><a href="#å®‰è£…ä¸éƒ¨ç½²-1">å®‰è£…ä¸éƒ¨ç½²</a></li>
            <li><a href="#æµé‡æ§åˆ¶">æµé‡æ§åˆ¶</a></li>
            <li><a href="#é™æµå’Œå¼‚å¸¸å¤„ç†">é™æµå’Œå¼‚å¸¸å¤„ç†</a></li>
            <li><a href="#çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ</a></li>
            <li><a href="#æœåŠ¡ç†”æ–­å’Œé™çº§">æœåŠ¡ç†”æ–­å’Œé™çº§</a></li>
          </ul>
        </li>
        <li><a href="#seataä¸åˆ†å¸ƒå¼äº‹åŠ¡">Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡</a>
          <ul>
            <li><a href="#é¡¹ç›®ç¯å¢ƒæ­å»º">é¡¹ç›®ç¯å¢ƒæ­å»º</a></li>
            <li><a href="#åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ">åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</a></li>
            <li><a href="#seataæœºåˆ¶ç®€ä»‹">Seataæœºåˆ¶ç®€ä»‹</a></li>
            <li><a href="#ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²">ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²</a></li>
            <li><a href="#ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²">ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

 
<script>
  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = e.attr('id');
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();
</script>
  
        </div>
        </div>
        

        
        <div class="min-w-0 min-h-0 max-w-fit" style="width: 100%">
            
<details style="margin-left:0px" class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5"  open >
    
    <summary
        class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">
        cloud - è¿™æ˜¯ç³»åˆ—æ–‡ç« ä¹‹ä¸€.
    </summary>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%B8%80/">
            éƒ¨åˆ† 1: SpringCloud 1
        </a>
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        éƒ¨åˆ† 2: æœ¬æ–‡
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%BA%8C/">
            éƒ¨åˆ† 3: SpringCloud 3
        </a>
    </div>
    
    


</details>



            <div class="article-content max-w-prose mb-20">
                <p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/V1dFqQMR7T2GzSJ.png" alt="image-20230306230950443" />
    
  </figure>

</p>


<h1 class="relative group">å¾®æœåŠ¡è¿›é˜¶ 
    <div id="%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%BF%9B%E9%98%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%BF%9B%E9%98%B6" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h1>
<p>å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š</p>
<ul>
<li><strong>æ³¨å†Œä¸­å¿ƒï¼š</strong> Eurekaï¼ˆå±äº<em>Netflix</em>ï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æºï¼Œ1.xç‰ˆæœ¬ä»åœ¨æ›´æ–°ï¼‰</li>
<li><strong>æœåŠ¡è°ƒç”¨ï¼š</strong> Ribbonï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€SpringCloud Loadbalancerï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼Œç›®å‰çš„é»˜è®¤æ–¹æ¡ˆï¼‰</li>
<li><strong>æœåŠ¡é™çº§ï¼š</strong> Hystrixï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰</li>
<li><strong>è·¯ç”±ç½‘å…³ï¼š</strong> Zuulï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€Gatewayï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼Œæ¨èæ–¹æ¡ˆï¼‰</li>
<li><strong>é…ç½®ä¸­å¿ƒï¼š</strong> Configï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼‰</li>
</ul>
<p>å¯è§ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•´å¥—è§£å†³æ–¹æ¡ˆä¸­ï¼Œè¶…è¿‡åŠæ•°çš„ç»„ä»¶éƒ½å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”éƒ¨åˆ†ç»„ä»¶éƒ½æ˜¯SpringCloudå®˜æ–¹å‡ºæ‰‹æä¾›æ¡†æ¶è¿›è¡Œè§£å†³ï¼Œå› æ­¤ï¼Œå¯»æ‰¾ä¸€å¥—æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠ¿åœ¨å¿…è¡Œï¼Œä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼š<strong>SpringCloud Alibaba</strong></p>
<p>é˜¿é‡Œå·´å·´ä½œä¸ºä¸šç•Œçš„äº’è”ç½‘å¤§å‚ï¼Œç»™å‡ºäº†ä¸€å¥—å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹ç½‘ç«™ï¼ˆä¸­æ–‡ï¼‰ï¼šhttps://spring-cloud-alibaba-group.github.io/github-pages/2021/zh-cn/index.html</p>
<blockquote>
<p>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚</p>
<p>ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œåˆ†å¸ƒå¼åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚</p>
</blockquote>
<p>ç›®å‰ Spring Cloud Alibaba æä¾›äº†å¦‚ä¸‹åŠŸèƒ½:</p>
<ol>
<li><strong>æœåŠ¡é™æµé™çº§</strong>ï¼šæ”¯æŒ WebServletã€WebFlux, OpenFeignã€RestTemplateã€Dubbo é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</li>
<li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚</li>
<li><strong>åˆ†å¸ƒå¼é…ç½®ç®¡ç†</strong>ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li>
<li><strong>RpcæœåŠ¡</strong>ï¼šæ‰©å±• Spring Cloud å®¢æˆ·ç«¯ RestTemplate å’Œ OpenFeignï¼Œæ”¯æŒè°ƒç”¨ Dubbo RPC æœåŠ¡</li>
<li><strong>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›</strong>ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li>
<li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šä½¿ç”¨ @GlobalTransactional æ³¨è§£ï¼Œ é«˜æ•ˆå¹¶ä¸”å¯¹ä¸šåŠ¡é›¶ä¾µå…¥åœ°è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</li>
<li><strong>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨</strong>ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li>
<li><strong>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</strong>ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li>
<li><strong>é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡</strong>ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSpringCloudAlibabaå®é™…ä¸Šæ˜¯å¯¹æˆ‘ä»¬çš„SpringCloudç»„ä»¶å¢å¼ºåŠŸèƒ½ï¼Œæ˜¯SpringCloudçš„å¢å¼ºæ¡†æ¶ï¼Œå¯ä»¥å…¼å®¹SpringCloudåŸç”Ÿç»„ä»¶å’ŒSpringCloudAlibabaçš„ç»„ä»¶ã€‚</p>
<p>å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼ŒæŠŠæˆ‘ä»¬ä¹‹å‰æ‰“åŒ…å¥½çš„æ‹†åˆ†é¡¹ç›®è§£å‹ï¼Œæˆ‘ä»¬å°†åŸºäºå®ƒè¿›è¡Œè®²è§£ã€‚</p>
<hr>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/pQkSrLx9NZRn8Ub.png" alt="image-20230306230942876" />
    
  </figure>

</p>


<h2 class="relative group">Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ 
    <div id="nacos-%E6%9B%B4%E5%8A%A0%E5%85%A8%E8%83%BD%E7%9A%84%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nacos-%E6%9B%B4%E5%8A%A0%E5%85%A8%E8%83%BD%E7%9A%84%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p>Nacosï¼ˆ<strong>Na</strong>ming <strong>Co</strong>nfiguration <strong>S</strong>erviceï¼‰æ˜¯ä¸€æ¬¾é˜¿é‡Œå·´å·´å¼€æºçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ç®¡ç†çš„ç»„ä»¶ï¼Œç›¸å½“äºæ˜¯Eureka+Configçš„ç»„åˆå½¢æ€ã€‚</p>


<h3 class="relative group">å®‰è£…ä¸éƒ¨ç½² 
    <div id="%E5%AE%89%E8%A3%85%E4%B8%8E%E9%83%A8%E7%BD%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%83%A8%E7%BD%B2" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>NacosæœåŠ¡å™¨æ˜¯ç‹¬ç«‹å®‰è£…éƒ¨ç½²çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸‹è½½æœ€æ–°çš„NacosæœåŠ¡ç«¯ç¨‹åºï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/nacosï¼Œè¿ä¸ä¸Šå¯ä»¥åˆ°è§†é¢‘ä¸‹æ–¹äº‘ç›˜ä¸­ä¸‹è½½ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/VStPIABaXxMp2N9.png" alt="image-20230306231045825" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯<code>1.4.3</code>ç‰ˆæœ¬ï¼ˆ2022å¹´2æœˆ27æ—¥å‘å¸ƒçš„ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½<code>zip</code>æ–‡ä»¶å³å¯ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å°†æ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/wWbuXRGizrQCT8J.png" alt="image-20230306231054919" />
    
  </figure>

</p>
<p>æˆ‘ä»¬ç›´æ¥å°†å…¶æ‹–å…¥åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ï¼Œä¾¿äºæˆ‘ä»¬ä¸€ä¼šåœ¨IDEAå†…éƒ¨å¯åŠ¨ï¼Œæ¥ç€æ·»åŠ è¿è¡Œé…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/bM8doEZPth7DHfe.png" alt="image-20230306231104823" />
    
  </figure>

</p>
<p>å…¶ä¸­<code>-m standalone</code>è¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼ŒMacå’ŒLinuxä¸‹è®°å¾—å°†è§£é‡Šå™¨è®¾å®šä¸º<code>/bin/bash</code>ï¼Œç”±äºNacosåœ¨Mac/Linuxé»˜è®¤æ˜¯åå°å¯åŠ¨æ¨¡å¼ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å®ƒçš„bashæ–‡ä»¶ï¼Œè®©å®ƒå˜æˆå‰å°å¯åŠ¨ï¼Œè¿™æ ·IDEAå…³é—­äº†Nacoså°±è‡ªåŠ¨å…³é—­äº†ï¼Œå¦åˆ™å¼€å‘ç¯å¢ƒä¸‹å¾ˆå®¹æ˜“å¿˜è®°å…³ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æ³¨é‡Šæ‰ nohup $JAVA ${JAVA_OPT} nacos.nacos &gt;&gt; ${BASE_DIR}/logs/start.out 2&gt;&amp;1 &amp;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ›¿æ¢æˆä¸‹é¢çš„</span>
</span></span><span class="line"><span class="cl"><span class="nv">$JAVA</span> <span class="si">${</span><span class="nv">JAVA_OPT</span><span class="si">}</span> nacos.nacos
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬ç‚¹å‡»å¯åŠ¨ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/O3pMSvDbxPKYT5q.png" alt="image-20230306231113946" />
    
  </figure>

</p>
<p>OKï¼Œå¯åŠ¨æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„ç®¡ç†é¡µé¢åœ°å€ä¹Ÿæ˜¯ç»™æˆ‘ä»¬è´´å‡ºæ¥äº†ï¼š http://localhost:8848/nacos/index.htmlï¼Œè®¿é—®è¿™ä¸ªåœ°å€ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/sbKTUqhLViIfrmR.png" alt="image-20230306231125828" />
    
  </figure>

</p>
<p>é»˜è®¤çš„ç”¨æˆ·åå’Œç®¡ç†å‘˜å¯†ç éƒ½æ˜¯<code>nacos</code>ï¼Œç›´æ¥ç™»é™†å³å¯ï¼Œå¯ä»¥çœ‹åˆ°è¿›å…¥ç®¡ç†é¡µé¢ä¹‹ååŠŸèƒ½ä¹Ÿæ˜¯ç›¸å½“ä¸°å¯Œï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/dom3WpJsiajgCE7.png" alt="image-20230306231150574" />
    
  </figure>

</p>
<p>è‡³æ­¤ï¼ŒNacosçš„å®‰è£…ä¸éƒ¨ç½²å®Œæˆã€‚</p>


<h3 class="relative group">æœåŠ¡æ³¨å†Œä¸å‘ç° 
    <div id="%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>ç°åœ¨æˆ‘ä»¬è¦å®ç°åŸºäºNacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¼å…¥SpringCloudAlibabaç›¸å…³çš„ä¾èµ–ï¼Œæˆ‘ä»¬åœ¨çˆ¶å·¥ç¨‹å°†ä¾èµ–è¿›è¡Œç®¡ç†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencyManagement&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>2.2.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      	<span class="c">&lt;!-- è¿™é‡Œå¼•å…¥æœ€æ–°çš„SpringCloudä¾èµ– --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>2021.0.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">          	<span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     	  <span class="c">&lt;!-- è¿™é‡Œå¼•å…¥æœ€æ–°çš„SpringCloudAlibabaä¾èµ–ï¼Œ2021.0.1.0ç‰ˆæœ¬æ”¯æŒSpringBoot2.6.X --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>2021.0.1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨å­é¡¹ç›®ä¸­æ·»åŠ æœåŠ¡å‘ç°ä¾èµ–äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»¥å›¾ä¹¦æœåŠ¡ä¸ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>å’Œæ³¨å†Œåˆ°Eurekaä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Nacosæ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c"># ä¹‹åæ‰€æœ‰çš„å›¾ä¹¦æœåŠ¡èŠ‚ç‚¹å°±81XXç«¯å£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8101</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/cloudstudy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># åº”ç”¨åç§° bookservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bookservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># é…ç½®Nacosæ³¨å†Œä¸­å¿ƒåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€å¯åŠ¨æˆ‘ä»¬çš„å›¾ä¹¦æœåŠ¡ï¼Œå¯ä»¥åœ¨Nacosçš„æœåŠ¡åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/9PLBGOXoaERnUwM.png" alt="image-20230306231202683" />
    
  </figure>

</p>
<p>æŒ‰ç…§åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€å°†å¦å¤–ä¸¤ä¸ªæœåŠ¡ä¹Ÿæ³¨å†Œåˆ°Nacosä¸­ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/K6VBtqEWSLnMp21.png" alt="image-20230306231211930" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨OpenFeignï¼Œå®ç°æœåŠ¡å‘ç°è¿œç¨‹è°ƒç”¨ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- è¿™é‡Œéœ€è¦å•ç‹¬å¯¼å…¥LoadBalancerä¾èµ– --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ç¼–å†™æ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;userservice&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;bookservice&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Book</span><span class="w"> </span><span class="nf">getBookById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BorrowService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BorrowMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserClient</span><span class="w"> </span><span class="n">userClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BookClient</span><span class="w"> </span><span class="n">bookClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">getUserBorrowDetailByUid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Borrow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrowsByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userClient</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borrow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bookClient</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">getBid</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">bookList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableFeignClients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">BorrowApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/HIGvXAad1EOVPt6.png" alt="image-20230306231226300" />
    
  </figure>

</p>
<p>æµ‹è¯•æ­£å¸¸ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°æœåŠ¡ï¼Œæ¥ç€æˆ‘ä»¬æ¥å¤šé…ç½®å‡ ä¸ªå®ä¾‹ï¼Œå»æ‰å›¾ä¹¦æœåŠ¡å’Œç”¨æˆ·æœåŠ¡çš„ç«¯å£é…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/WZGdJ5BYpmbMuNT.png" alt="image-20230306231234119" />
    
  </figure>

</p>
<p>ç„¶åæˆ‘ä»¬åœ¨å›¾ä¹¦æœåŠ¡å’Œç”¨æˆ·æœåŠ¡ä¸­æ·»åŠ ä¸€å¥æ‰“å°æ–¹ä¾¿ä¹‹åæŸ¥çœ‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findUserById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è°ƒç”¨ç”¨æˆ·æœåŠ¡&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨å°†å…¨éƒ¨æœåŠ¡å¯åŠ¨ï¼š





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/GCrm8wgWXLzYhtK.png" alt="image-20230306231244149" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°Nacosä¸­çš„å®ä¾‹æ•°é‡å·²ç»æ˜¾ç¤ºä¸º<code>2</code>ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/p6iYrPa8e1btZkl.png" alt="image-20230306231251732" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬è°ƒç”¨å€Ÿé˜…æœåŠ¡ï¼Œçœ‹çœ‹èƒ½å¦è´Ÿè½½å‡è¡¡è¿œç¨‹è°ƒç”¨ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/jCl8RGhaIiUDBgm.png" alt="image-20230306231259820" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/2bWdfmnVOyGzlZr.png" alt="image-20230306231306653" />
    
  </figure>

</p>
<p>OKï¼Œè´Ÿè½½å‡è¡¡è¿œç¨‹è°ƒç”¨æ²¡æœ‰é—®é¢˜ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†åŸºäºNacosçš„æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œå®é™…ä¸Šå¤§è‡´æµç¨‹ä¸Eurekaä¸€è‡´ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒNacosåŒºåˆ†äº†ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/cF5MoVX6vNnzx9j.png" alt="image-20230306231317971" />
    
  </figure>

</p>
<p>é‚£ä¹ˆä¸´æ—¶å’Œéä¸´æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<ul>
<li>ä¸´æ—¶å®ä¾‹ï¼šå’ŒEurekaä¸€æ ·ï¼Œé‡‡ç”¨å¿ƒè·³æœºåˆ¶å‘Nacoså‘é€è¯·æ±‚ä¿æŒåœ¨çº¿çŠ¶æ€ï¼Œä¸€æ—¦å¿ƒè·³åœæ­¢ï¼Œä»£è¡¨å®ä¾‹ä¸‹çº¿ï¼Œä¸ä¿ç•™å®ä¾‹ä¿¡æ¯ã€‚</li>
<li>éä¸´æ—¶å®ä¾‹ï¼šç”±Nacosä¸»åŠ¨è¿›è¡Œè”ç³»ï¼Œå¦‚æœè¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆä¸ä¼šç§»é™¤å®ä¾‹ä¿¡æ¯ï¼Œè€Œæ˜¯å°†å¥åº·çŠ¶æ€è®¾å®šä¸ºfalseï¼Œç›¸å½“äºä¼šå¯¹æŸä¸ªå®ä¾‹çŠ¶æ€æŒç»­åœ°è¿›è¡Œç›‘æ§ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ä¸´æ—¶å®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">borrowservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># å°†ephemeralä¿®æ”¹ä¸ºfalseï¼Œè¡¨ç¤ºéä¸´æ—¶å®ä¾‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ephemeral</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åœ¨Nacosä¸­æŸ¥çœ‹ï¼Œå¯ä»¥å‘ç°å®ä¾‹å·²ç»ä¸æ˜¯ä¸´æ—¶çš„äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/FdRTjlKszDoOPU3.png" alt="image-20230306231328378" />
    
  </figure>

</p>
<p>å¦‚æœè¿™æ—¶æˆ‘ä»¬å…³é—­æ­¤å®ä¾‹ï¼Œé‚£ä¹ˆä¼šå˜æˆè¿™æ ·ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/R5Jyhl29UcvuOCb.png" alt="image-20230306231337931" />
    
  </figure>

</p>
<p>åªæ˜¯å°†å¥åº·çŠ¶æ€å˜ä¸ºfalseï¼Œè€Œä¸ä¼šåˆ é™¤å®ä¾‹çš„ä¿¡æ¯ã€‚</p>


<h3 class="relative group">é›†ç¾¤åˆ†åŒº 
    <div id="%E9%9B%86%E7%BE%A4%E5%88%86%E5%8C%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%9B%86%E7%BE%A4%E5%88%86%E5%8C%BA" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å®é™…ä¸Šé›†ç¾¤åˆ†åŒºæ¦‚å¿µåœ¨ä¹‹å‰çš„Eurekaä¸­ä¹Ÿæœ‰å‡ºç°ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">eureka</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nt">fetch-registry</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">register-with-eureka</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">service-url</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">defaultZone</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8888/eureka</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># è¿™ä¸ªdefaultZoneæ˜¯ä¸ªå•¥ç©æ„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªåç§°ï¼Ÿä¸ºä»€ä¹ˆè¦è¦ç”¨è¿™æ ·çš„å½¢å¼æ¥å£°æ˜æ³¨å†Œä¸­å¿ƒï¼Ÿ</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œç›¸åŒæœåŠ¡çš„å®ä¾‹å¯èƒ½ä¼šåœ¨ä¸åŒçš„æœºå™¨ã€ä½ç½®ä¸Šå¯åŠ¨ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†æœåŠ¡ï¼Œå¯èƒ½åœ¨æˆéƒ½æœ‰1å°æœåŠ¡å™¨éƒ¨ç½²ã€é‡åº†æœ‰ä¸€å°æœåŠ¡å™¨éƒ¨ç½²ï¼Œè€Œè¿™æ—¶ï¼Œæˆ‘ä»¬åœ¨æˆéƒ½çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†å€Ÿé˜…æœåŠ¡ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„å€Ÿé˜…æœåŠ¡ç°åœ¨è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼Œå°±åº”è¯¥ä¼˜å…ˆé€‰æ‹©åŒä¸€ä¸ªåŒºåŸŸçš„ç”¨æˆ·æœåŠ¡è¿›è¡Œè°ƒç”¨ï¼Œè¿™æ ·ä¼šä½¿å¾—å“åº”é€Ÿåº¦æ›´å¿«ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/szyGRrEfZ1KWmpj.png" alt="image-20230306231411711" />
    
  </figure>

</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹éƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿çš„æœåŠ¡è¿›è¡Œåˆ†åŒºï¼Œå¯ä»¥çœ‹åˆ°å®ä¾‹çš„åˆ†åŒºæ˜¯é»˜è®¤ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/wlO9dQ1NtKCxFTi.png" alt="image-20230306231402008" />
    
  </figure>

</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">borrowservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># ä¿®æ”¹ä¸ºé‡åº†åœ°åŒºçš„é›†ç¾¤</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cluster-name</span><span class="p">:</span><span class="w"> </span><span class="l">Chongqing</span><span class="w">
</span></span></span></code></pre></div><p>å½“ç„¶ç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸åŒçš„å¯åŠ¨é…ç½®ï¼Œç›´æ¥åœ¨å¯åŠ¨é…ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡<code>spring.cloud.nacos.discovery.cluster-name</code>ä¹Ÿè¡Œï¼Œè¿™é‡Œæˆ‘ä»¬å°†ç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡ä¸¤ä¸ªåŒºåŸŸéƒ½åˆ†é…ä¸€ä¸ªï¼Œå€Ÿé˜…æœåŠ¡å°±é…ç½®ä¸ºæˆéƒ½åœ°åŒºï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/cwIhdCMmATELvlN.png" alt="image-20230306231435388" />
    
  </figure>

</p>
<p>ä¿®æ”¹å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ¥å°è¯•é‡æ–°å¯åŠ¨ä¸€ä¸‹ï¼ˆNacosä¹Ÿè¦é‡å¯ï¼‰ï¼Œè§‚å¯ŸNacosä¸­é›†ç¾¤åˆ†å¸ƒæƒ…å†µï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/jrYo3epaLMyQnu4.png" alt="image-20230306231443247" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ç°åœ¨æœ‰ä¸¤ä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”éƒ½æœ‰ä¸€ä¸ªå®ä¾‹æ­£åœ¨è¿è¡Œã€‚æˆ‘ä»¬æ¥ç€å»è°ƒç”¨å€Ÿé˜…æœåŠ¡ï¼Œä½†æ˜¯å‘ç°å¹¶æ²¡æœ‰æŒ‰ç…§åŒºåŸŸè¿›è¡Œä¼˜å…ˆè°ƒç”¨ï¼Œè€Œä¾ç„¶ä½¿ç”¨çš„æ˜¯è½®è¯¢æ¨¡å¼çš„è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»è¦æä¾›Nacosçš„è´Ÿè½½å‡è¡¡å®ç°æ‰èƒ½å¼€å¯åŒºåŸŸä¼˜å…ˆè°ƒç”¨æœºåˆ¶ï¼Œåªéœ€è¦åœ¨é…åˆ¶æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">borrowservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cluster-name</span><span class="p">:</span><span class="w"> </span><span class="l">Chengdu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># å°†loadbalancerçš„nacosæ”¯æŒå¼€å¯ï¼Œé›†æˆNacosè´Ÿè½½å‡è¡¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">loadbalancer</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬é‡å¯å€Ÿé˜…æœåŠ¡ï¼Œä¼šå‘ç°ä¼˜å…ˆè°ƒç”¨çš„æ˜¯åŒåŒºåŸŸçš„ç”¨æˆ·å’Œå›¾ä¹¦æœåŠ¡ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æˆéƒ½åœ°åŒºçš„æœåŠ¡ä¸‹çº¿ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/s1ko9UcD4mMQ5fW.png" alt="image-20230306231453470" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸‹çº¿ä¹‹åï¼Œç”±äºæœ¬åŒºåŸŸå†…æ²¡æœ‰å¯ç”¨æœåŠ¡äº†ï¼Œå€Ÿé˜…æœåŠ¡å°†ä¼šè°ƒç”¨é‡åº†åŒºåŸŸçš„ç”¨æˆ·æœåŠ¡ã€‚</p>
<p>é™¤äº†æ ¹æ®åŒºåŸŸä¼˜å…ˆè°ƒç”¨ä¹‹å¤–ï¼ŒåŒä¸€ä¸ªåŒºåŸŸå†…çš„å®ä¾‹ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æƒé‡ï¼ŒNacosä¼šä¼˜å…ˆé€‰æ‹©æƒé‡æ›´å¤§çš„å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç®¡ç†é¡µé¢ä¸­è¿›è¡Œé…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/1pAckEZN5ltXKWG.png" alt="image-20230306231500731" />
    
  </figure>

</p>
<p>æˆ–æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">borrowservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cluster-name</span><span class="p">:</span><span class="w"> </span><span class="l">Chengdu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># æƒé‡å¤§å°ï¼Œè¶Šå¤§è¶Šä¼˜å…ˆè°ƒç”¨ï¼Œé»˜è®¤ä¸º1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">0.5</span><span class="w">
</span></span></span></code></pre></div><p>é€šè¿‡é…ç½®æƒé‡ï¼ŒæŸäº›æ€§èƒ½ä¸å¤ªå¥½çš„æœºå™¨å°±èƒ½å¤Ÿæ›´å°‘åœ°è¢«ä½¿ç”¨ï¼Œè€Œæ›´å¤šçš„ä½¿ç”¨é‚£äº›ç½‘ç»œè‰¯å¥½æ€§èƒ½æ›´é«˜çš„ä¸»æœºä¸Šçš„å®ä¾‹ã€‚</p>


<h3 class="relative group">é…ç½®ä¸­å¿ƒ 
    <div id="%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†SpringCloud Configï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æœåŠ¡æ¥åŠ è½½è¿œç¨‹é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿œç«¯é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶ã€‚</p>
<p>å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥åœ¨<code>bootstrap.yml</code>ä¸­é…ç½®è¿œç¨‹é…ç½®æ–‡ä»¶è·å–ï¼Œç„¶åå†è¿›å…¥åˆ°é…ç½®æ–‡ä»¶åŠ è½½ç¯èŠ‚ï¼Œè€ŒNacosä¹Ÿæ”¯æŒè¿™æ ·çš„æ“ä½œï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦å°†å€Ÿé˜…æœåŠ¡çš„é…ç½®æ–‡ä»¶æ”¾åˆ°Nacosè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨Nacosä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/6j2pAmdfyIGz9Cu.png" alt="image-20230306231534251" />
    
  </figure>

</p>
<p>å°†å€Ÿé˜…æœåŠ¡çš„é…ç½®æ–‡ä»¶å…¨éƒ¨ï¼ˆå½“ç„¶æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå…¨éƒ¨CVçš„ï¼Œåªä¼šå¤åˆ¶é‚£äº›éœ€è¦ç»å¸¸ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œè¿™é‡Œä¸ºäº†çœäº‹å°±ç›´æ¥å…¨éƒ¨CVäº†ï¼‰å¤åˆ¶è¿‡æ¥ï¼Œæ³¨æ„<strong>Data ID</strong>çš„æ ¼å¼è·Ÿæˆ‘ä»¬ä¹‹å‰ä¸€æ ·ï¼Œ<code>åº”ç”¨åç§°-ç¯å¢ƒ.yml</code>ï¼Œå¦‚æœåªç¼–å†™åº”ç”¨åç§°ï¼Œé‚£ä¹ˆä»£è¡¨æ­¤é…ç½®æ–‡ä»¶æ— è®ºåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹éƒ½ä¼šä½¿ç”¨ï¼Œç„¶åæ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½å¯ä»¥è¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§åˆ†ç±»æ–¹å¼ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/7ACoW3txIsjLzu2.png" alt="image-20230306231514151" />
    
  </figure>

</p>
<p>å®Œæˆä¹‹åç‚¹å‡»å‘å¸ƒå³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/alFpWGfNejImQEw.png" alt="image-20230306231522828" />
    
  </figure>

</p>
<p>ç„¶ååœ¨é¡¹ç›®ä¸­å¯¼å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bootstrap<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åœ¨å€Ÿé˜…æœåŠ¡ä¸­æ·»åŠ <code>bootstrap.yml</code>æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c"># æœåŠ¡åç§°å’Œé…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">borrowservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">profiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c"># ç¯å¢ƒä¹Ÿæ˜¯å’Œé…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c"># é…ç½®æ–‡ä»¶åç¼€å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">file-extension</span><span class="p">:</span><span class="w"> </span><span class="l">yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># é…ç½®ä¸­å¿ƒæœåŠ¡å™¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯Nacosåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å¯åŠ¨æœåŠ¡è¯•è¯•çœ‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/5J4FfMgtGwZhP3C.png" alt="image-20230306231605960" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè¯»å–é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨äº†ï¼Œå®é™…ä¸Šä½¿ç”¨ä¸Šæ¥è¯´è·Ÿä¹‹å‰çš„Configæ˜¯åŸºæœ¬ä¸€è‡´çš„ã€‚</p>
<p>Nacosè¿˜æ”¯æŒé…ç½®æ–‡ä»¶çš„çƒ­æ›´æ–°ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œè€Œè¿™ä¸ªæ—¶å€™å¯èƒ½éœ€è¦å®æ—¶ä¿®æ”¹ï¼Œå¹¶åœ¨åç«¯å®æ—¶æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ç§è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„Controllerï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${test.txt}&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">//æˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–test.txtçš„å­—ç¬¦ä¸²å€¼ï¼Œä½œä¸ºtestæ¥å£çš„è¿”å›å€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">txt</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/test&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">test</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">txt</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/9xthuBpgFs4PTSq.png" alt="image-20230306231616512" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥æ­£å¸¸è¯»å–äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/kacrSVGYMpwK2jx.png" alt="image-20230306231626447" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬å°†é…ç½®æ–‡ä»¶çš„å€¼è¿›è¡Œä¿®æ”¹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/YLC2H6yGoVi5z1f.png" alt="image-20230306231634007" />
    
  </figure>

</p>
<p>å†æ¬¡è®¿é—®æ¥å£ï¼Œä¼šå‘ç°æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/isTaOUQwMVWGCY9.png" alt="image-20230306231641913" />
    
  </figure>

</p>
<p>ä½†æ˜¯åå°æ˜¯æˆåŠŸæ£€æµ‹åˆ°å€¼æ›´æ–°äº†ï¼Œä½†æ˜¯å€¼å´æ²¡æ”¹å˜ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/dR4thB5JTk1cGjm.png" alt="image-20230306231656905" />
    
  </figure>

</p>
<p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å®ç°é…ç½®çƒ­æ›´æ–°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RefreshScope</span><span class="w">   </span><span class="c1">//æ·»åŠ æ­¤æ³¨è§£å°±èƒ½å®ç°è‡ªåŠ¨åˆ·æ–°äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${test.txt}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">txt</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/test&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">test</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">txt</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>é‡å¯æœåŠ¡å™¨ï¼Œå†æ¬¡é‡å¤ä¸Šè¿°å®éªŒï¼ŒæˆåŠŸã€‚</p>


<h3 class="relative group">å‘½åç©ºé—´ 
    <div id="%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å°†é…ç½®æ–‡ä»¶æˆ–æ˜¯æœåŠ¡å®ä¾‹åˆ’åˆ†åˆ°ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œå…¶å®å°±æ˜¯åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒæˆ–æ˜¯å¼•ç”¨å½’å±ä¹‹ç±»çš„ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/7itUIhz3NupRdr6.png" alt="image-20230306231706215" />
    
  </figure>

</p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/DC2I1MvVFjYmPEq.png" alt="image-20230306231713676" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°åœ¨devå‘½åç©ºé—´ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é…ç½®æ–‡ä»¶å’ŒæœåŠ¡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Ek4APjgGcqbitNm.png" alt="image-20230306231723164" />
    
  </figure>

</p>
<p>æˆ‘ä»¬åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸‹ï¼Œå®ä¾‹å’Œé…ç½®éƒ½æ˜¯ç›¸äº’ä¹‹é—´éš”ç¦»çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå½“å‰çš„å‘½åç©ºé—´ã€‚</p>


<h3 class="relative group">å®ç°é«˜å¯ç”¨ 
    <div id="%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>ç”±äºNacosæš‚ä¸æ”¯æŒArmæ¶æ„èŠ¯ç‰‡çš„Macé›†ç¾¤æ­å»ºï¼Œæœ¬å°èŠ‚ç”¨Linxuäº‘ä¸»æœºï¼ˆNacosæ¯”è¾ƒåƒå†…å­˜ï¼Œ2ä¸ªNacosæœåŠ¡å™¨é›†ç¾¤ï¼Œè‡³å°‘2Gå†…å­˜ï¼‰ç¯å¢ƒæ¼”ç¤ºã€‚</p>
<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨Nacosä»¥åŠNacosçš„åŠŸèƒ½ç­‰ï¼Œæœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚æœåƒä¹‹å‰Eurekaä¸€æ ·ï¼Œæ­å»ºNacosé›†ç¾¤ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p>
<p>å®˜æ–¹æ–¹æ¡ˆï¼šhttps://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/H1AvxOK78yspP5k.jpg" alt="deployDnsVipMode.jpg" />
    
  </figure>

</p>
<blockquote>
<p>http://ip1:port/openAPI ç›´è¿ipæ¨¡å¼ï¼Œæœºå™¨æŒ‚åˆ™éœ€è¦ä¿®æ”¹ipæ‰å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>http://SLB:port/openAPI æŒ‚è½½SLBæ¨¡å¼(å†…ç½‘SLBï¼Œä¸å¯æš´éœ²åˆ°å…¬ç½‘ï¼Œä»¥å…å¸¦æ¥å®‰å…¨é£é™©)ï¼Œç›´è¿SLBå³å¯ï¼Œä¸‹é¢æŒ‚serverçœŸå®ipï¼Œå¯è¯»æ€§ä¸å¥½ã€‚</p>
<p><a href="http://nacos.com"   target="_blank">
    http://nacos.com</a>:port/openAPI åŸŸå + SLBæ¨¡å¼(å†…ç½‘SLBï¼Œä¸å¯æš´éœ²åˆ°å…¬ç½‘ï¼Œä»¥å…å¸¦æ¥å®‰å…¨é£é™©)ï¼Œå¯è¯»æ€§å¥½ï¼Œè€Œä¸”æ¢ipæ–¹ä¾¿ï¼Œæ¨èæ¨¡å¼</p>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æ¶æ„è®¾è®¡ï¼Œå®ƒæ¨èæˆ‘ä»¬åœ¨æ‰€æœ‰çš„NacosæœåŠ¡ç«¯ä¹‹å‰å»ºç«‹ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—®è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ¥é—´æ¥è®¿é—®åˆ°å„ä¸ªNacosæœåŠ¡å™¨ã€‚å®é™…ä¸Šå°±ï¼Œæ˜¯æ¯”å¦‚æœ‰ä¸‰ä¸ªNacosæœåŠ¡å™¨åšé›†ç¾¤ï¼Œä½†æ˜¯æ¯ä¸ªæœåŠ¡ä¸å¯èƒ½æŠŠæ¯ä¸ªNacoséƒ½å»è®¿é—®ä¸€æ¬¡è¿›è¡Œæ³¨å†Œï¼Œå®é™…ä¸Šåªéœ€è¦åœ¨ä»»æ„ä¸€å°NacosæœåŠ¡å™¨ä¸Šæ³¨å†Œå³å¯ï¼ŒNacosæœåŠ¡å™¨ä¹‹é—´ä¼šè‡ªåŠ¨åŒæ­¥ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éšä¾¿æŒ‡å®šä¸€å°NacosæœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœè¿™å°NacosæœåŠ¡å™¨æŒ‚äº†ï¼Œä½†æ˜¯å…¶ä»–NacosæœåŠ¡å™¨æ²¡æŒ‚ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å®Œæˆæ³¨å†Œäº†ï¼Œä½†æ˜¯å®é™…ä¸Šæ•´ä¸ªé›†ç¾¤è¿˜æ˜¯å¯ç”¨çš„çŠ¶æ€ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œå°±éœ€è¦åœ¨æ‰€æœ‰NacosæœåŠ¡å™¨ä¹‹å‰æ­å»ºä¸€ä¸ªSLBï¼ˆæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¸Šé¢çš„é—®é¢˜äº†ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœè¦å®ç°å¤–ç•Œå¯¹æœåŠ¡è®¿é—®çš„è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬å°±å¾—ç”¨æ¯”å¦‚ä¹‹å‰è¯´åˆ°çš„Gatewayæ¥å®ç°ï¼Œè€Œè¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„å·¥å…·ï¼šNginxï¼Œæ¥å®ç°ï¼ˆä¹‹å‰æˆ‘ä»¬æ²¡è®²è¿‡ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ”¾å¿ƒåé¢ä¼šå¸¦ç€å¤§å®¶ä½¿ç”¨ï¼‰</p>
<p>å…³äºSLBæœ€ä¸Šæ–¹è¿˜æœ‰ä¸€ä¸ªDNSï¼ˆæˆ‘ä»¬åœ¨<code>è®¡ç®—æœºç½‘ç»œ</code>è¿™é—¨è¯¾ç¨‹ä¸­å­¦ä¹ è¿‡ï¼‰ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºSLBæ˜¯è£¸IPï¼Œå¦‚æœSLBæœåŠ¡å™¨ä¿®æ”¹äº†åœ°å€ï¼Œé‚£ä¹ˆæ‰€æœ‰å¾®æœåŠ¡æ³¨å†Œçš„åœ°å€ä¹Ÿå¾—æ”¹ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯é€šè¿‡åŠ åŸŸåï¼Œé€šè¿‡åŸŸåæ¥è®¿é—®ï¼Œè®©DNSå»è§£æçœŸå®IPï¼Œè¿™æ ·å°±ç®—æ”¹å˜IPï¼Œåªéœ€è¦ä¿®æ”¹åŸŸåè§£æè®°å½•å³å¯ï¼ŒåŸŸååœ°å€æ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚</p>
<p>æœ€åå°±æ˜¯Nacosçš„æ•°æ®å­˜å‚¨æ¨¡å¼ï¼Œåœ¨å•èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼ŒNacoså®é™…ä¸Šæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨è‡ªå¸¦çš„ä¸€ä¸ªåµŒå…¥å¼æ•°æ®åº“ä¸­ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Fuxq9Dl3rGfnTZA.png" alt="image-20230306231744022" />
    
  </figure>

</p>
<p>è€Œè¿™ç§æ¨¡å¼åªé€‚ç”¨äºå•èŠ‚ç‚¹ï¼Œåœ¨å¤šèŠ‚ç‚¹é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œè‚¯å®šæ˜¯ä¸èƒ½å„å­˜å„çš„ï¼Œæ‰€ä»¥ï¼ŒNacosæä¾›äº†MySQLç»Ÿä¸€å­˜å‚¨æ”¯æŒï¼Œæˆ‘ä»¬åªéœ€è¦è®©æ‰€æœ‰çš„NacosæœåŠ¡å™¨è¿æ¥MySQLè¿›è¡Œæ•°æ®å­˜å‚¨å³å¯ï¼Œå®˜æ–¹ä¹Ÿæä¾›å¥½äº†SQLæ–‡ä»¶ã€‚</p>
<p>ç°åœ¨å°±å¯ä»¥å¼€å§‹äº†ï¼Œç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬ç›´æ¥å¯¼å…¥æ•°æ®åº“å³å¯ï¼Œæ–‡ä»¶åœ¨confç›®å½•ä¸­ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/97suBpfdeF54rc2.png" alt="image-20230306231753589" />
    
  </figure>

</p>
<p>æˆ‘ä»¬æ¥å°†å…¶å¯¼å…¥åˆ°æ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†å¾ˆå¤šçš„è¡¨ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/cf76RJ9VUiQBlje.png" alt="image-20230306231802722" />
    
  </figure>

</p>
<p>ç„¶åæˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªNacosæœåŠ¡å™¨ï¼Œåšä¸€ä¸ªè¿·ä½ çš„é›†ç¾¤ï¼Œè¿™é‡Œä½¿ç”¨<code>scp</code>å‘½ä»¤å°†nacosæœåŠ¡ç«¯ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨ï¼ˆæ³¨æ„éœ€è¦æå‰å®‰è£…å¥½JRE 8æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¯å¢ƒï¼‰ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/RW4JIBKVXSbG3lZ.png" alt="image-20230306231811912" />
    
  </figure>

</p>
<p>è§£å‹ä¹‹åï¼Œæˆ‘ä»¬å¯¹å…¶é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œé¦–å…ˆæ˜¯<code>application.properties</code>é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼ŒåŒ…æ‹¬MySQLæœåŠ¡å™¨çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1">### Default web server port:</span>
</span></span><span class="line"><span class="cl"><span class="na">server.port</span><span class="o">=</span><span class="s">8801</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#*************** Config Module Related Configurations ***************#</span>
</span></span><span class="line"><span class="cl"><span class="c1">### If use MySQL as datasource:</span>
</span></span><span class="line"><span class="cl"><span class="na">spring.datasource.platform</span><span class="o">=</span><span class="s">mysql</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Count of DB:</span>
</span></span><span class="line"><span class="cl"><span class="na">db.num</span><span class="o">=</span><span class="s">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Connect URL of DB:</span>
</span></span><span class="line"><span class="cl"><span class="na">db.url.0</span><span class="o">=</span><span class="s">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span>
</span></span><span class="line"><span class="cl"><span class="na">db.user.0</span><span class="o">=</span><span class="s">nacos</span>
</span></span><span class="line"><span class="cl"><span class="na">db.password.0</span><span class="o">=</span><span class="s">nacos</span>
</span></span></code></pre></div><p>ç„¶åä¿®æ”¹é›†ç¾¤é…ç½®ï¼Œè¿™é‡Œéœ€è¦é‡å‘½åä¸€ä¸‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/2pe51dHQsJkPVY7.png" alt="image-20230306231821488" />
    
  </figure>

</p>
<p>ç«¯å£è®°å¾—ä½¿ç”¨å†…ç½‘IPåœ°å€ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/5CbEGQ7rX2StUkR.png" alt="image-20230306231828707" />
    
  </figure>

</p>
<p>æœ€åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹Nacosçš„å†…å­˜åˆ†é…ä»¥åŠå‰å°å¯åŠ¨ï¼Œç›´æ¥ä¿®æ”¹<code>startup.sh</code>æ–‡ä»¶ï¼ˆå†…å­˜æœ‰é™ï¼Œç©ä¸èµ·é«˜çš„ï¼‰ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/kQF3lN24vcBqzDi.png" alt="image-20230306231836711" />
    
  </figure>

</p>
<p>ä¿å­˜ä¹‹åï¼Œå°†nacoså¤åˆ¶ä¸€ä»½ï¼Œå¹¶å°†ç«¯å£ä¿®æ”¹ä¸º8802ï¼Œæ¥ç€å¯åŠ¨è¿™ä¸¤ä¸ªNacosæœåŠ¡å™¨ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/PQYi69aKZUXrNlJ.png" alt="image-20230306231845850" />
    
  </figure>

</p>
<p>ç„¶åæˆ‘ä»¬æ‰“å¼€ç®¡ç†é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å·²ç»å¯åŠ¨äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Lbf14V39SCdghvO.png" alt="image-20230306231854072" />
    
  </figure>

</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ç¬¬äºŒæ­¥å°±å®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªSLBï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨Nginxåšåå‘ä»£ç†ï¼š</p>
<blockquote>
<p><em>Nginx</em> (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<a href="https://baike.baidu.com/item/HTTP"   target="_blank">
    HTTP</a>å’Œ<a href="https://baike.baidu.com/item/%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86/7793488"   target="_blank">
    åå‘ä»£ç†</a>webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚å®ƒç›¸å½“äºåœ¨å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´å½¢æˆä¸€ä¸ªç½‘å…³ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½å¯ä»¥ç”±NginxæœåŠ¡å™¨è½¬äº¤ç»™å†…ç½‘çš„å…¶ä»–æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"> sudo apt install nginx
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ç›´æ¥è¯·æ±‚80ç«¯å£ä¹‹åå¾—åˆ°ï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/gVuMlAXcY34Ka2C.png" alt="image-20230306231903833" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦è®©å…¶ä»£ç†æˆ‘ä»¬åˆšåˆšå¯åŠ¨çš„ä¸¤ä¸ªNacosæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œä¸€äº›é…ç½®ã€‚é…ç½®æ–‡ä»¶ä½äº<code>/etc/nginx/nginx.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">#æ·»åŠ æˆ‘ä»¬åœ¨ä¸Šæ¸¸åˆšåˆšåˆ›å»ºå¥½çš„ä¸¤ä¸ªnacosæœåŠ¡å™¨
upstream nacos-server {
        server 10.0.0.12:8801;
        server 10.0.0.12:8802;
}

server {
        listen   80;
        server_name  1.14.121.107;

        location /nacos {
                proxy_pass http://nacos-server;
        }
}
</code></pre><p>é‡å¯NginxæœåŠ¡å™¨ï¼ŒæˆåŠŸè¿æ¥ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/2hrxcizHPvSq8be.png" alt="image-20230306231912734" />
    
  </figure>

</p>
<p>ç„¶åæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨ä¿®æ”¹ä¸ºäº‘æœåŠ¡å™¨ä¸ŠNacosçš„åœ°å€ï¼Œå¯åŠ¨è¯•è¯•çœ‹ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/gdh43ciamLnBRFV.png" alt="image-20230306231925001" />
    
  </figure>

</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ­å»ºå¥½äº†Nacosé›†ç¾¤ã€‚</p>
<hr>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/xnmustzRkFZJWIP.png" alt="image-20230306231932929" />
    
  </figure>

</p>


<h2 class="relative group">Sentinel æµé‡é˜²å«å…µ 
    <div id="sentinel-%E6%B5%81%E9%87%8F%E9%98%B2%E5%8D%AB%E5%85%B5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#sentinel-%E6%B5%81%E9%87%8F%E9%98%B2%E5%8D%AB%E5%85%B5" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p><strong>æ³¨æ„ï¼š</strong> è¿™ä¸€ç« æœ‰ç‚¹å°ç»•ï¼Œæ€è·¯ç†æ¸…ã€‚</p>
<p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡å­˜åœ¨çš„é›ªå´©é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå¾®æœåŠ¡å‡ºç°é—®é¢˜ï¼Œæœ‰å¯èƒ½å¯¼è‡´æ•´ä¸ªé“¾è·¯ç›´æ¥ä¸å¯ç”¨ï¼Œè¿™ç§æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡ŒåŠæ—¶çš„ç†”æ–­å’Œé™çº§ï¼Œè¿™äº›ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹‹å‰é€šè¿‡ä½¿ç”¨Hystrixæ¥å®ç°ã€‚</p>
<p>SpringCloud Alibabaä¹Ÿæœ‰è‡ªå·±çš„å¾®æœåŠ¡å®¹é”™ç»„ä»¶ï¼Œä½†æ˜¯å®ƒç›¸æ¯”Hystrixæ›´åŠ çš„å¼ºå¤§ã€‚</p>
<blockquote>
<p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
</blockquote>
<p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p>
<ul>
<li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li>
<li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li>
<li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Apache Dubboã€gRPCã€Quarkus çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚åŒæ—¶ Sentinel æä¾› Java/Go/C++ ç­‰å¤šè¯­è¨€çš„åŸç”Ÿå®ç°ã€‚</li>
<li><strong>å®Œå–„çš„ SPI æ‰©å±•æœºåˆ¶</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li>
</ul>


<h3 class="relative group">å®‰è£…ä¸éƒ¨ç½² 
    <div id="%E5%AE%89%E8%A3%85%E4%B8%8E%E9%83%A8%E7%BD%B2-1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%83%A8%E7%BD%B2-1" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å’ŒNacosä¸€æ ·ï¼Œå®ƒæ˜¯ç‹¬ç«‹å®‰è£…å’Œéƒ¨ç½²çš„ï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/Sentinel/releases</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/oZdLMAJaCD3Uw9F.png" alt="image-20230306231950297" />
    
  </figure>

</p>
<p>æ³¨æ„ä¸‹è½½ä¸‹æ¥ä¹‹åæ˜¯ä¸€ä¸ª<code>jar</code>æ–‡ä»¶ï¼ˆå…¶å®å°±æ˜¯ä¸ªSpringBooté¡¹ç›®ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨IDEAä¸­æ·»åŠ ä¸€äº›è¿è¡Œé…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Hjm4Z38s95YiFvI.png" alt="image-20230306232001525" />
    
  </figure>

</p>
<p>æ¥ç€å°±å¯ä»¥ç›´æ¥å¯åŠ¨å•¦ï¼Œå½“ç„¶é»˜è®¤ç«¯å£å ç”¨8080ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/RfVAdtOqJjWlx6E.png" alt="image-20230306232012301" />
    
  </figure>

</p>
<p>å¯åŠ¨ä¹‹åï¼Œå°±å¯ä»¥è®¿é—®åˆ°Sentinelçš„ç›‘æ§é¡µé¢äº†ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯<code>sentinel</code>ï¼Œåœ°å€ï¼šhttp://localhost:8858/#/dashboard</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/QpVRTYtBX6kvj2b.png" alt="image-20230306232020492" />
    
  </figure>

</p>
<p>è¿™æ ·å°±æˆåŠŸå¼€å¯ç›‘æ§é¡µé¢äº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„æœåŠ¡è¿æ¥åˆ°Sentinelæ§åˆ¶å°ï¼Œè€è§„çŸ©ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ Sentinelç›¸å…³ä¿¡æ¯ï¼ˆå®é™…ä¸ŠSentinelæ˜¯æœ¬åœ°åœ¨è¿›è¡Œç®¡ç†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°ç›‘æ§é¡µé¢ï¼Œè¿™æ ·å°±å¯ä»¥å›¾å½¢åŒ–æ“ä½œäº†ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">userservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transport</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c"># æ·»åŠ ç›‘æ§é¡µé¢åœ°å€å³å¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8858</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡ï¼Œç„¶åè®¿é—®ä¸€æ¬¡æœåŠ¡ï¼Œè¿™æ ·Sentinelä¸­å°±ä¼šå­˜åœ¨ä¿¡æ¯äº†ï¼ˆæ‡’åŠ è½½æœºåˆ¶ï¼Œä¸ä¼šä¸€ä¸Šæ¥å°±åŠ è½½ï¼‰ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/p4KTaDd1wc5BR92.png" alt="image-20230306232031800" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/pzOus21AWqLfr9k.png" alt="image-20230306232038728" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åœ¨Sentinelæ§åˆ¶å°ä¸­å¯¹æˆ‘ä»¬çš„æœåŠ¡è¿è¡Œæƒ…å†µè¿›è¡Œå®æ—¶ç›‘æ§äº†ï¼Œå¯ä»¥çœ‹åˆ°ç›‘æ§çš„å†…å®¹éå¸¸çš„å¤šï¼ŒåŒ…æ‹¬æ—¶é—´ç‚¹ã€QPS(æ¯ç§’æŸ¥è¯¢ç‡)ã€å“åº”æ—¶é—´ç­‰æ•°æ®ã€‚</p>
<p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨è¿æ¥åˆ°Sentinelç®¡ç†é¢æ¿ä¸­ã€‚</p>


<h3 class="relative group">æµé‡æ§åˆ¶ 
    <div id="%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬å®Œæˆäº†å¯¹Sentinelçš„æ­å»ºä¸è¿æ¥ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹Sentinelçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œæµé‡æ§åˆ¶ã€‚</p>
<p>æˆ‘ä»¬çš„æœºå™¨ä¸å¯èƒ½æ— é™åˆ¶çš„æ¥å—å’Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œå½“å‘ç”Ÿé«˜å¹¶å‘æƒ…å†µæ—¶ï¼Œç³»ç»Ÿèµ„æºå°†å¾ˆå¿«è¢«è€—å°½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ æµé‡æ§åˆ¶ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯é™æµï¼‰å½“ä¸€æ®µæ—¶é—´å†…çš„æµé‡åˆ°è¾¾ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œæ–°çš„è¯·æ±‚å°†ä¸å†è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥åˆç†åœ°åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤æœåŠ¡å™¨ä¸å—åˆ°å¤–ç•Œçš„æ¶æ„æ”»å‡»ã€‚</p>
<p>é‚£ä¹ˆè¦å®ç°é™æµï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯¥é‡‡å–ä»€ä¹ˆæ ·çš„ç­–ç•¥å‘¢ï¼Ÿ</p>
<ul>
<li>æ–¹æ¡ˆä¸€ï¼š<strong>å¿«é€Ÿæ‹’ç»</strong>ï¼Œæ—¢ç„¶ä¸å†æ¥å—æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªæ‹’ç»ä¿¡æ¯ï¼Œå‘Šè¯‰ç”¨æˆ·è®¿é—®é¢‘ç‡è¿‡é«˜ã€‚</li>
<li>æ–¹æ¡ˆäºŒï¼š<strong>é¢„çƒ­</strong>ï¼Œä¾ç„¶åŸºäºæ–¹æ¡ˆä¸€ï¼Œä½†æ˜¯ç”±äºæŸäº›æƒ…å†µä¸‹é«˜å¹¶å‘è¯·æ±‚æ˜¯åœ¨æŸä¸€æ—¶åˆ»çªç„¶åˆ°æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“æ…¢åœ°å°†é˜ˆå€¼æé«˜åˆ°æŒ‡å®šé˜ˆå€¼ï¼Œå½¢æˆä¸€ä¸ªç¼“å†²ä¿æŠ¤ã€‚</li>
<li>æ–¹æ¡ˆä¸‰ï¼š<strong>æ’é˜Ÿç­‰å¾…</strong>ï¼Œä¸æ¥å—æ–°çš„è¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿä¸ç›´æ¥æ‹’ç»ï¼Œè€Œæ˜¯è¿›é˜Ÿåˆ—å…ˆç­‰ä¸€ä¸‹ï¼Œå¦‚æœè§„å®šæ—¶é—´å†…èƒ½å¤Ÿæ‰§è¡Œï¼Œé‚£ä¹ˆå°±æ‰§è¡Œï¼Œè¦æ˜¯è¶…æ—¶å°±ç®—äº†ã€‚</li>
</ul>
<p>é’ˆå¯¹äºæ˜¯å¦è¶…è¿‡æµé‡é˜ˆå€¼çš„åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘ä»¬æ4ç§ç®—æ³•ï¼š</p>
<ol>
<li>
<p><strong>æ¼æ¡¶ç®—æ³•</strong></p>
<p>é¡¾åæ€ä¹‰ï¼Œå°±åƒä¸€ä¸ªæ¡¶å¼€äº†ä¸€ä¸ªå°å­”ï¼Œæ°´æµè¿›æ¡¶ä¸­çš„é€Ÿåº¦è‚¯å®šæ˜¯è¿œå¤§äºæ°´æµå‡ºæ¡¶çš„é€Ÿåº¦çš„ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§é™æµæ€è·¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/dMZVz3kDRxYaHg5.png" alt="image-20230306232054430" />
    
  </figure>

</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¡¶æ˜¯æœ‰å®¹é‡çš„ï¼Œæ‰€ä»¥å½“æ¡¶çš„å®¹é‡å·²æ»¡æ—¶ï¼Œå°±è£…ä¸ä¸‹æ°´äº†ï¼Œè¿™æ—¶å°±åªæœ‰ä¸¢å¼ƒè¯·æ±‚äº†ã€‚</p>
<p>åˆ©ç”¨è¿™ç§æ€æƒ³ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä¸€ä¸ªç®€å•çš„é™æµç®—æ³•ã€‚</p>
</li>
<li>
<p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•</strong></p>
<p>åªèƒ½è¯´æœ‰ç‚¹åƒä¿¡å·é‡æœºåˆ¶ã€‚ç°åœ¨æœ‰ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œè¿™ä¸ªæ¡¶æ˜¯ä¸“é—¨å­˜æ”¾ä»¤ç‰Œçš„ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±å‘æ¡¶ä¸­ä¸¢å…¥ä¸€ä¸ªä»¤ç‰Œï¼ˆé€Ÿåº¦ç”±æˆ‘ä»¬æŒ‡å®šï¼‰å½“æ–°çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå°†ä»æ¡¶ä¸­åˆ é™¤ä»¤ç‰Œï¼Œæ¥ç€è¯·æ±‚å°±å¯ä»¥é€šè¿‡å¹¶ç»™åˆ°æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œæ•°é‡ä¸è¶³ï¼Œé‚£ä¹ˆä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œè€Œæ˜¯è®©æ­¤æ•°æ®åŒ…ç­‰å¾…ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/F1RxtgBZNQvWpw8.png" alt="image-20230306232102462" />
    
  </figure>

</p>
<p>å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå½“æµé‡ä¸‹é™æ—¶ï¼Œä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œä¼šé€æ¸ç§¯ç´¯ï¼Œè¿™æ ·å¦‚æœçªç„¶å‡ºç°é«˜å¹¶å‘ï¼Œé‚£ä¹ˆå°±èƒ½åœ¨çŸ­æ—¶é—´å†…æ‹¿åˆ°å¤§é‡çš„ä»¤ç‰Œã€‚</p>
</li>
<li>
<p><strong>å›ºå®šæ—¶é—´çª—å£ç®—æ³•</strong></p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸€ä¸ªæ—¶é—´æ®µå†…çš„è¯·æ±‚è¿›è¡Œç»Ÿè®¡å’Œè®¡æ•°ï¼Œæ¯”å¦‚åœ¨<code>14:15</code>åˆ°<code>14:16</code>è¿™ä¸€åˆ†é’Ÿå†…ï¼Œè¯·æ±‚é‡ä¸èƒ½è¶…è¿‡<code>100</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€åˆ†é’Ÿä¹‹å†…ä¸èƒ½è¶…è¿‡<code>100</code>æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è¿›è¡Œåˆ’åˆ†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/XRnKgCivsqFE2ax.png" alt="image-20230306232111506" />
    
  </figure>

</p>
<p>è™½ç„¶è¿™ç§æ¨¡å¼çœ‹ä¼¼æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯è¯•æƒ³ä¸€ä¸‹è¿™ç§æƒ…å†µï¼š</p>
<ul>
<li>14:15:59çš„æ—¶å€™æ¥äº†100ä¸ªè¯·æ±‚</li>
<li>14:16:01çš„æ—¶å€™åˆæ¥äº†100ä¸ªè¯·æ±‚</li>
</ul>
<p>å‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µï¼Œç¬¦åˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•çš„è§„åˆ™ï¼Œæ‰€ä»¥è¿™200ä¸ªè¯·æ±‚éƒ½èƒ½æ­£å¸¸æ¥å—ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ ååº”æ¯”è¾ƒå¿«ï¼Œåº”è¯¥å‘ç°äº†ï¼Œæˆ‘ä»¬å…¶å®å¸Œæœ›çš„æ˜¯60ç§’å†…åªæœ‰100ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå´æ˜¯åœ¨3ç§’å†…å‡ºç°äº†200ä¸ªè¯·æ±‚ï¼Œå¾ˆæ˜æ˜¾å·²ç»è¿èƒŒäº†æˆ‘ä»¬çš„åˆè¡·ã€‚</p>
<p>å› æ­¤ï¼Œå½“é‡åˆ°ä¸´ç•Œç‚¹æ—¶ï¼Œå›ºå®šæ—¶é—´çª—å£ç®—æ³•å­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p>
</li>
<li>
<p><strong>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</strong></p>
<p>ç›¸å¯¹äºå›ºå®šçª—å£ç®—æ³•ï¼Œæ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•æ›´åŠ çµæ´»ï¼Œå®ƒä¼šåŠ¨æ€ç§»åŠ¨çª—å£ï¼Œé‡æ–°è¿›è¡Œè®¡ç®—ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/8MyG3WDo1wSBb5Y.png" alt="image-20230306232118585" />
    
  </figure>

</p>
<p>è™½ç„¶è¿™æ ·èƒ½å¤Ÿé¿å…å›ºå®šæ—¶é—´çª—å£çš„ä¸´ç•Œé—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯æ¯”å›ºå®šçª—å£æ›´åŠ è€—æ—¶çš„ã€‚</p>
</li>
</ol>
<p>å¥½äº†ï¼Œäº†è§£å®Œäº†æˆ‘ä»¬çš„é™æµç­–ç•¥å’Œåˆ¤å®šæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åœ¨Sentinelä¸­è¿›è¡Œå®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰“å¼€ç®¡ç†é¡µé¢çš„ç°‡ç‚¹é“¾è·¯æ¨¡å—ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/4fPg72OJiwhDycL.png" alt="image-20230306232127628" />
    
  </figure>

</p>
<p>è¿™é‡Œæ¼”ç¤ºå¯¹æˆ‘ä»¬çš„å€Ÿé˜…æ¥å£è¿›è¡Œé™æµï¼Œç‚¹å‡»<code>æµæ§</code>ï¼Œä¼šçœ‹åˆ°è®©æˆ‘ä»¬æ·»åŠ æµæ§è§„åˆ™ï¼š</p>
<ul>
<li>é˜ˆå€¼ç±»å‹ï¼šQPSå°±æ˜¯æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼Œå¹¶å‘çº¿ç¨‹æ•°æ˜¯æŒ‰æœåŠ¡å½“å‰ä½¿ç”¨çš„çº¿ç¨‹æ•°æ®è¿›è¡Œç»Ÿè®¡çš„ã€‚</li>
<li>æµæ§æ¨¡å¼ï¼šå½“è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œæµæ§çš„å¯¹è±¡ï¼Œè¿™é‡Œæš‚æ—¶åªç”¨ç›´æ¥ã€‚</li>
<li>æµæ§æ•ˆæœï¼šå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ä¸‰ç§æ–¹æ¡ˆã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>QPS</code>ã€é˜ˆå€¼è®¾å®šä¸º<code>1</code>ï¼Œæµæ§æ¨¡å¼é€‰æ‹©<code>ç›´æ¥</code>ã€æµæ§æ•ˆæœé€‰æ‹©<code>å¿«é€Ÿå¤±è´¥</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬å¿«é€Ÿåœ°è¿›è¡Œè¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Lrw7ZJNzyDUoYG8.png" alt="image-20230306232135482" />
    
  </figure>

</p>
<p>è¿™é‡Œå„ä½æœ€å¥½è‡ªè¡Œå°è¯•ä¸€ä¸‹å…¶ä»–çš„æµæ§æ•ˆæœï¼Œç†Ÿæ‚‰å’ŒåŠ æ·±å°è±¡ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›æµæ§æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>
<ul>
<li>ç›´æ¥ï¼šåªé’ˆå¯¹äºå½“å‰æ¥å£ã€‚</li>
<li>å…³è”ï¼šå½“å…¶ä»–æ¥å£è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šå¯¼è‡´å½“å‰æ¥å£è¢«é™æµã€‚</li>
<li>é“¾è·¯ï¼šæ›´ç»†ç²’åº¦çš„é™æµï¼Œèƒ½ç²¾ç¡®åˆ°å…·ä½“çš„æ–¹æ³•ã€‚</li>
</ul>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å…³è”ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¯¹è‡ªå¸¦çš„<code>/error</code>æ¥å£è¿›è¡Œé™æµï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/E9vnJRTPZmzaW8V.png" alt="image-20230306232145053" />
    
  </figure>

</p>
<p>æ³¨æ„é™æµæ˜¯ä½œç”¨äºå…³è”èµ„æºçš„ï¼Œä¸€æ—¦å‘ç°å…³è”èµ„æºè¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å½“å‰çš„èµ„æºè¿›è¡Œé™æµï¼Œæˆ‘ä»¬ç°åœ¨æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œä½¿ç”¨PostMançš„Runnerè¿ç»­å¯¹å…³è”èµ„æºå‘èµ·è¯·æ±‚ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/QgqsxdvYF59P7ne.png" alt="image-20230306232239339" />
    
  </figure>

</p>
<p>å¼€å¯Postmanï¼Œç„¶åæˆ‘ä»¬ä¼šå‘ç°å€Ÿé˜…æœåŠ¡å·²ç»å‡‰å‡‰ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/tnKXB2JUarehk5T.png" alt="image-20230306232253804" />
    
  </figure>

</p>
<p>å½“æˆ‘ä»¬å…³é—­æ‰Postmançš„ä»»åŠ¡åï¼Œæ¢å¤æ­£å¸¸ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥è®²è§£ä¸€ä¸‹é“¾è·¯æ¨¡å¼ï¼Œå®ƒèƒ½å¤Ÿæ›´åŠ ç²¾å‡†çš„è¿›è¡Œæµé‡æ§åˆ¶ï¼Œé“¾è·¯æµæ§æ¨¡å¼æŒ‡çš„æ˜¯ï¼Œå½“ä»æŒ‡å®šæ¥å£è¿‡æ¥çš„èµ„æºè¯·æ±‚è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œå¼€å¯é™æµï¼Œè¿™é‡Œå¾—å…ˆè®²è§£ä¸€ä¸‹<code>@SentinelResource</code>çš„ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸€ä¸ªæ–¹æ³•è¿›è¡Œé™æµæ§åˆ¶ï¼Œæ— è®ºæ˜¯è°åœ¨ä½•å¤„è°ƒç”¨äº†å®ƒï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°<code>@SentinelResource</code>ï¼Œä¸€æ—¦æ–¹æ³•è¢«æ ‡æ³¨ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œç›‘æ§ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œåˆ›å»ºä¸¤ä¸ªè¯·æ±‚æ˜ å°„ï¼Œéƒ½æ¥è°ƒç”¨Serviceçš„è¢«ç›‘æ§æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BorrowService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">findUserBorrows</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getUserBorrowDetailByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow2/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">findUserBorrows2</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getUserBorrowDetailByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BorrowService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BorrowMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserClient</span><span class="w"> </span><span class="n">userClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BookClient</span><span class="w"> </span><span class="n">bookClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="s">&#34;getBorrow&#34;</span><span class="p">)</span><span class="w">   </span><span class="c1">//ç›‘æ§æ­¤æ–¹æ³•ï¼Œæ— è®ºè¢«è°æ‰§è¡Œéƒ½åœ¨ç›‘æ§èŒƒå›´å†…ï¼Œè¿™é‡Œç»™çš„valueæ˜¯è‡ªå®šä¹‰åç§°ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥åŠ åœ¨ä»»ä½•æ–¹æ³•ä¸Šï¼ŒåŒ…æ‹¬Controllerä¸­çš„è¯·æ±‚æ˜ å°„æ–¹æ³•ï¼Œè·ŸHystrixCommandè´¼åƒ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">getUserBorrowDetailByUid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Borrow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrowsByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userClient</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borrow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bookClient</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">getBid</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">bookList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æ·»åŠ é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">borrowservice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transport</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8858</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># å…³é—­Contextæ”¶æ•›ï¼Œè¿™æ ·è¢«ç›‘æ§æ–¹æ³•å¯ä»¥è¿›è¡Œä¸åŒé“¾è·¯çš„å•ç‹¬æ§åˆ¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">web-context-unify</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬åœ¨Sentinelæ§åˆ¶å°ä¸­æ·»åŠ æµæ§è§„åˆ™ï¼Œæ³¨æ„æ˜¯é’ˆå¯¹æ­¤æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»è‡ªåŠ¨è¯†åˆ«åˆ°borrowæ¥å£ä¸‹è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/FOzJdtoieAxIvPq.png" alt="image-20230306232304858" />
    
  </figure>

</p>
<p>æœ€åæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¯¹è¿™ä¸¤ä¸ªæ¥å£éƒ½è¿›è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°ï¼Œæ— è®ºè¯·æ±‚å“ªä¸ªæ¥å£ï¼Œåªè¦è°ƒç”¨äº†Serviceä¸­çš„<code>getUserBorrowDetailByUid</code>è¿™ä¸ªæ–¹æ³•ï¼Œéƒ½ä¼šè¢«é™æµã€‚æ³¨æ„é™æµçš„å½¢å¼æ˜¯åå°ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè‡³äºæ€ä¹ˆå¤„ç†æˆ‘ä»¬åé¢å†è¯´ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªé“¾è·¯é€‰é¡¹å®é™…ä¸Šå°±æ˜¯å†³å®šåªé™æµä»å“ªä¸ªæ–¹å‘æ¥çš„è°ƒç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åªå¯¹<code>borrow2</code>è¿™ä¸ªæ¥å£å¯¹<code>getUserBorrowDetailByUid</code>æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œé™æµï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸ºå…¶æŒ‡å®šé“¾è·¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/UHbcgSWV2exNCu1.png" alt="image-20230306232315010" />
    
  </figure>

</p>
<p>ç„¶åæˆ‘ä»¬ä¼šå‘ç°ï¼Œé™æµæ•ˆæœåªå¯¹æˆ‘ä»¬é…ç½®çš„é“¾è·¯æ¥å£æœ‰æ•ˆï¼Œè€Œå…¶ä»–é“¾è·¯æ˜¯ä¸ä¼šè¢«é™æµçš„ã€‚</p>
<p>é™¤äº†ç›´æ¥å¯¹æ¥å£è¿›è¡Œé™æµè§„åˆ™æ§åˆ¶ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å½“å‰ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå†³å®šæ˜¯å¦è¿›è¡Œé™æµï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/MHiDyU54L3QsNrc.png" alt="image-20230306232323438" />
    
  </figure>

</p>
<p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š</p>
<ul>
<li><strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li>
<li><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li>
<li><strong>å¹³å‡ RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li>
<li><strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li>
<li><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li>
</ul>
<p>è¿™é‡Œå°±ä¸è¿›è¡Œæ¼”ç¤ºäº†ã€‚</p>


<h3 class="relative group">é™æµå’Œå¼‚å¸¸å¤„ç† 
    <div id="%E9%99%90%E6%B5%81%E5%92%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%99%90%E6%B5%81%E5%92%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•è¿›è¡Œé™æµæ“ä½œï¼Œé‚£ä¹ˆé™æµçŠ¶æ€ä¸‹çš„è¿”å›ç»“æœè¯¥æ€ä¹ˆä¿®æ”¹å‘¢ï¼Œæˆ‘ä»¬çœ‹åˆ°è¢«é™æµä¹‹åè¿”å›çš„æ˜¯Sentinelé»˜è®¤çš„æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ›è‡ªå®šä¹‰æ”¹å¦‚ä½•æ“ä½œï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºå¥½è¢«é™æµçŠ¶æ€ä¸‹éœ€è¦è¿”å›çš„å†…å®¹ï¼Œå®šä¹‰ä¸€ä¸ªè¯·æ±‚æ˜ å°„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/blocked&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">JSONObject</span><span class="w"> </span><span class="nf">blocked</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">JSONObject</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSONObject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">object</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;code&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">403</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">object</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;success&#34;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">object</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;massage&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;æ‚¨çš„è¯·æ±‚é¢‘ç‡è¿‡å¿«ï¼Œè¯·ç¨åå†è¯•ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">object</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å°†æ­¤é¡µé¢è®¾å®šä¸ºé™æµé¡µé¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transport</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8858</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># å°†åˆšåˆšç¼–å†™çš„è¯·æ±‚æ˜ å°„è®¾å®šä¸ºé™æµé¡µé¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">block-page</span><span class="p">:</span><span class="w"> </span><span class="l">/blocked</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·ï¼Œå½“è¢«é™æµæ—¶ï¼Œå°±ä¼šè¢«é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/PfVOQWJrTiZGqh7.png" alt="image-20230306232335949" />
    
  </figure>

</p>
<p>é‚£ä¹ˆï¼Œå¯¹äºæ–¹æ³•çº§åˆ«çš„é™æµå‘¢ï¼Ÿç»è¿‡å‰é¢çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œå½“æŸä¸ªæ–¹æ³•è¢«é™æµæ—¶ï¼Œä¼šç›´æ¥åœ¨åå°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µæˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨Hystrixä¸­å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œè¿™æ ·å½“å‡ºç°å¼‚å¸¸æ—¶ä¼šç›´æ¥æ‰§è¡Œæˆ‘ä»¬çš„æ›¿ä»£æ–¹æ³•å¹¶è¿”å›ï¼ŒSentinelä¹Ÿå¯ä»¥ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¿˜æ˜¯åœ¨<code>getUserBorrowDetailByUid</code>æ–¹æ³•ä¸Šè¿›è¡Œé…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;getBorrow&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blocked&#34;</span><span class="p">)</span><span class="w">   </span><span class="c1">//æŒ‡å®šblockHandlerï¼Œä¹Ÿå°±æ˜¯è¢«é™æµä¹‹åçš„æ›¿ä»£è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·å°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„æŠ›å‡ºå¼‚å¸¸çš„å½¢å¼äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">getUserBorrowDetailByUid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Borrow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrowsByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userClient</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borrow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bookClient</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">getBid</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">bookList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ›¿ä»£æ–¹æ¡ˆï¼Œæ³¨æ„å‚æ•°å’Œè¿”å›å€¼éœ€è¦ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”å‚æ•°æœ€åè¿˜éœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªBlockException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">blocked</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦è¢«é™æµå°†æ‰§è¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œæœ€åè¿”å›çš„ç»“æœå°±æ˜¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/p1Y53LPihOGZjBV.png" alt="image-20230306232346185" />
    
  </figure>

</p>
<p>æ³¨æ„<code>blockHandler</code>åªèƒ½å¤„ç†é™æµæƒ…å†µä¸‹æŠ›å‡ºçš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬ä¸‹é¢å³å°†è¦ä»‹ç»çš„çƒ­ç‚¹å‚æ•°é™æµä¹Ÿæ˜¯åŒç†ï¼Œå¦‚æœæ˜¯æ–¹æ³•æœ¬èº«æŠ›å‡ºçš„å…¶ä»–ç±»å‹å¼‚å¸¸ï¼Œä¸åœ¨ç®¡æ§èŒƒå›´å†…ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–å‚æ•°è¿›è¡Œå¤„ç†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/test&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;test&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">fallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;except&#34;</span><span class="p">,</span><span class="w">    </span><span class="c1">//fallbackæŒ‡å®šå‡ºç°å¼‚å¸¸æ—¶çš„æ›¿ä»£æ–¹æ¡ˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">exceptionsToIgnore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IOException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">  </span><span class="c1">//å¿½ç•¥é‚£äº›å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å¼‚å¸¸å‡ºç°æ—¶ä¸ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="nf">test</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;HelloWorldï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//æ›¿ä»£æ–¹æ³•å¿…é¡»å’ŒåŸæ–¹æ³•è¿”å›å€¼å’Œå‚æ•°ä¸€è‡´ï¼Œæœ€åå¯ä»¥æ·»åŠ ä¸€ä¸ªThrowableä½œä¸ºå‚æ•°æ¥å—å¼‚å¸¸</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="nf">except</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="na">getMessage</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·ï¼Œå…¶ä»–çš„å¼‚å¸¸ä¹Ÿå¯ä»¥æœ‰æ›¿ä»£æ–¹æ¡ˆäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/pk1HjSi9VyxwOJQ.png" alt="image-20230306232354931" />
    
  </figure>

</p>
<p>ç‰¹åˆ«æ³¨æ„è¿™ç§æ–¹å¼ä¼šåœ¨æ²¡æœ‰é…ç½®<code>blockHandler</code>çš„æƒ…å†µä¸‹ï¼Œå°†Sentinelæœºåˆ¶å†…ï¼ˆä¹Ÿå°±æ˜¯é™æµçš„å¼‚å¸¸ï¼‰çš„å¼‚å¸¸ä¹Ÿä¸€å¹¶å¤„ç†äº†ï¼Œå¦‚æœé…ç½®äº†<code>blockHandler</code>ï¼Œé‚£ä¹ˆåœ¨å‡ºç°é™æµæ—¶ï¼Œä¾ç„¶åªä¼šæ‰§è¡Œ<code>blockHandler</code>æŒ‡å®šçš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå› ä¸ºé™æµæ˜¯åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿›è¡Œçš„ï¼‰</p>


<h3 class="relative group">çƒ­ç‚¹å‚æ•°é™æµ 
    <div id="%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹æŸä¸€çƒ­ç‚¹æ•°æ®è¿›è¡Œç²¾å‡†é™æµï¼Œæ¯”å¦‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œä¸åŒå‚æ•°è¢«æºå¸¦è®¿é—®çš„é¢‘ç‡æ˜¯ä¸ä¸€æ ·çš„ï¼š</p>
<ul>
<li>http://localhost:8301/test?a=10  è®¿é—®100æ¬¡</li>
<li>http://localhost:8301/test?b=10  è®¿é—®0æ¬¡</li>
<li>http://localhost:8301/test?c=10  è®¿é—®3æ¬¡</li>
</ul>
<p>ç”±äºæºå¸¦å‚æ•°<code>a</code>çš„è¯·æ±‚æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°±å¯ä»¥åªå¯¹æºå¸¦å‚æ•°<code>a</code>çš„è¯·æ±‚è¿›è¡Œé™æµã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•è¯·æ±‚æ˜ å°„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/test&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="s">&#34;test&#34;</span><span class="p">)</span><span class="w">   </span><span class="c1">//æ³¨æ„è¿™é‡Œéœ€è¦æ·»åŠ @SentinelResourceæ‰å¯ä»¥ï¼Œç”¨æˆ·èµ„æºåç§°å°±ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„èµ„æºåç§°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="nf">findUserBorrows2</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;c&#34;</span><span class="p">,</span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;è¯·æ±‚æˆåŠŸï¼a = &#34;</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="s">&#34;, b = &#34;</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="s">&#34;, c = &#34;</span><span class="o">+</span><span class="n">c</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬åœ¨Sentinelé‡Œé¢è¿›è¡Œçƒ­ç‚¹é…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/fIlhGM3jPxb7wgS.png" alt="image-20230306232406587" />
    
  </figure>

</p>
<p>ç„¶åå¼€å§‹è®¿é—®æˆ‘ä»¬çš„æµ‹è¯•æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æºå¸¦å‚æ•°aæ—¶ï¼Œå½“è®¿é—®é¢‘ç‡è¶…è¿‡è®¾å®šå€¼ï¼Œå°±ä¼šç›´æ¥è¢«é™æµï¼Œè¿™é‡Œæ˜¯ç›´æ¥åœ¨åå°æŠ›å‡ºå¼‚å¸¸ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/hskQVKnE2y5PftO.png" alt="image-20230306232452209" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/nC6W5T4OGcJNypA.png" alt="image-20230306232500754" />
    
  </figure>

</p>
<p>è€Œæˆ‘ä»¬ä½¿ç”¨å…¶ä»–å‚æ•°æˆ–æ˜¯ä¸å¸¦<code>a</code>å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/WVguflyZ43NxE7j.png" alt="image-20230306232514532" />
    
  </figure>

</p>
<p>é™¤äº†ç›´æ¥å¯¹æŸä¸ªå‚æ•°ç²¾å‡†é™æµå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å‚æ•°æºå¸¦çš„æŒ‡å®šå€¼å•ç‹¬è®¾å®šé˜ˆå€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨ä¸ä»…å¸Œæœ›å¯¹å‚æ•°<code>a</code>é™æµï¼Œè€Œä¸”è¿˜å¸Œæœ›å½“å‚æ•°<code>a</code>çš„å€¼ä¸º10æ—¶ï¼ŒQPSè¾¾åˆ°5å†è¿›è¡Œé™æµï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾å®šä¾‹å¤–ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/oipjTJBHsMSdDvc.png" alt="image-20230306232525342" />
    
  </figure>

</p>
<p>è¿™æ ·ï¼Œå½“è¯·æ±‚æºå¸¦å‚æ•°<code>a</code>ï¼Œä¸”å‚æ•°<code>a</code>çš„å€¼ä¸º10æ—¶ï¼Œé˜ˆå€¼å°†æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„ç‰¹ä¾‹è¿›è¡Œè®¡ç®—ã€‚</p>


<h3 class="relative group">æœåŠ¡ç†”æ–­å’Œé™çº§ 
    <div id="%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E5%92%8C%E9%99%8D%E7%BA%A7" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E5%92%8C%E9%99%8D%E7%BA%A7" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>è¿˜è®°å¾—æˆ‘ä»¬å‰æ‰€è¯´çš„æœåŠ¡é™çº§å—ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦åœ¨æ•´ä¸ªå¾®æœåŠ¡è°ƒç”¨é“¾è·¯å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼ŒåŠæ—¶å¯¹æœåŠ¡è¿›è¡Œé™çº§ï¼Œä»¥é˜²æ­¢é—®é¢˜è¿›ä¸€æ­¥æ¶åŒ–ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/AxrzjvtPWJ2YCZI.png" alt="image-20230306232538279" />
    
  </figure>

</p>
<p>é‚£ä¹ˆï¼Œå„ä½æ˜¯å¦æœ‰æ€è€ƒè¿‡ï¼Œå¦‚æœåœ¨æŸä¸€æ—¶åˆ»ï¼ŒæœåŠ¡Bå‡ºç°æ•…éšœï¼ˆå¯èƒ½å°±å¡åœ¨é‚£é‡Œäº†ï¼‰ï¼Œè€Œè¿™æ—¶æœåŠ¡Aä¾ç„¶æœ‰å¤§é‡çš„è¯·æ±‚ï¼Œåœ¨è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆï¼Œç”±äºæœåŠ¡Aæ²¡åŠæ³•å†çŸ­æ—¶é—´å†…å®Œæˆå¤„ç†ï¼Œæ–°æ¥çš„è¯·æ±‚å°±ä¼šå¯¼è‡´çº¿ç¨‹æ•°ä¸æ–­åœ°å¢åŠ ï¼Œè¿™æ ·ï¼ŒCPUçš„èµ„æºå¾ˆå¿«å°±ä¼šè¢«è€—å°½ã€‚</p>
<p>é‚£ä¹ˆè¦é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå°±åªèƒ½è¿›è¡Œéš”ç¦»äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æä¸¤ç§éš”ç¦»æ–¹æ¡ˆï¼š</p>
<ol>
<li>
<p><strong>çº¿ç¨‹æ± éš”ç¦»</strong></p>
<p>çº¿ç¨‹æ± éš”ç¦»å®é™…ä¸Šå°±æ˜¯å¯¹æ¯ä¸ªæœåŠ¡çš„è¿œç¨‹è°ƒç”¨å•ç‹¬å¼€æ”¾çº¿ç¨‹æ± ï¼Œæ¯”å¦‚æœåŠ¡Aè¦è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆåªåŸºäºå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œè¿™æ ·å³ä½¿åœ¨çŸ­æ—¶é—´å†…å‡ºç°å¤§é‡è¯·æ±‚ï¼Œç”±äºæ²¡æœ‰çº¿ç¨‹å¯ä»¥åˆ†é…ï¼Œæ‰€ä»¥å°±ä¸ä¼šå¯¼è‡´èµ„æºè€—å°½äº†ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/CbYxA3d7w46OlMm.png" alt="image-20230306232549778" />
    
  </figure>

</p>
</li>
<li>
<p><strong>ä¿¡å·é‡éš”ç¦»</strong></p>
<p>ä¿¡å·é‡éš”ç¦»æ˜¯ä½¿ç”¨<code>Semaphore</code>ç±»å®ç°çš„ï¼ˆå¦‚æœä¸äº†è§£ï¼Œå¯ä»¥è§‚çœ‹æœ¬ç³»åˆ— å¹¶å‘ç¼–ç¨‹ç¯‡ è§†é¢‘æ•™ç¨‹ï¼‰ï¼Œæ€æƒ³åŸºæœ¬ä¸Šä¸ä¸Šé¢æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿæ˜¯é™å®šæŒ‡å®šçš„çº¿ç¨‹æ•°é‡èƒ½å¤ŸåŒæ—¶è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯å®ƒç›¸å¯¹äºçº¿ç¨‹æ± éš”ç¦»ï¼Œå¼€é”€ä¼šæ›´å°ä¸€äº›ï¼Œä½¿ç”¨æ•ˆæœåŒæ ·ä¼˜ç§€ï¼Œä¹Ÿæ”¯æŒè¶…æ—¶ç­‰ã€‚</p>
<p>Sentinelä¹Ÿæ­£æ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹æ¡ˆå®ç°éš”ç¦»çš„ã€‚</p>
</li>
</ol>
<p>å¥½äº†ï¼Œè¯´å›æˆ‘ä»¬çš„ç†”æ–­å’Œé™çº§ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› ä¸ºæŸç§åŸå› å˜å¾—ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢æ—¶ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿è¯è‡ªå·±æ•´ä½“æœåŠ¡çš„å¯ç”¨æ€§ï¼Œä¸å†ç»§ç»­è°ƒç”¨ç›®æ ‡æœåŠ¡è€Œæ˜¯å¿«é€Ÿè¿”å›æˆ–æ˜¯æ‰§è¡Œè‡ªå·±çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè¿™ä¾¿æ˜¯æœåŠ¡é™çº§ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/gY62LD3vw157WiU.png" alt="image-20230306232602853" />
    
  </figure>

</p>
<p>æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li>å…³é—­ï¼šç†”æ–­å™¨ä¸å·¥ä½œï¼Œæ‰€æœ‰è¯·æ±‚å…¨éƒ¨è¯¥å¹²å˜›å¹²å˜›ã€‚</li>
<li>æ‰“å¼€ï¼šç†”æ–­å™¨å·¥ä½œï¼Œæ‰€æœ‰è¯·æ±‚ä¸€å¾‹é™çº§å¤„ç†ã€‚</li>
<li>åŠå¼€ï¼šå°è¯•è¿›è¡Œä¸€ä¸‹ä¸‹æ­£å¸¸æµç¨‹ï¼Œè¦æ˜¯è¿˜ä¸è¡Œç»§ç»­ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¦åˆ™å…³é—­ã€‚</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹Sentinelä¸­å¦‚ä½•è¿›è¡Œç†”æ–­å’Œé™çº§æ“ä½œï¼Œæ‰“å¼€ç®¡ç†é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±æ–°å¢ç†”æ–­è§„åˆ™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/7BW6LGXQNl5b1Iv.png" alt="image-20230306232618547" />
    
  </figure>

</p>
<p>å…¶ä¸­ï¼Œç†”æ–­ç­–ç•¥æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p>
<ol>
<li>
<p><strong>æ…¢è°ƒç”¨æ¯”ä¾‹ï¼š</strong> å¦‚æœå‡ºç°é‚£ç§åŠå¤©éƒ½å¤„ç†ä¸å®Œçš„è°ƒç”¨ï¼Œæœ‰å¯èƒ½å°±æ˜¯æœåŠ¡å‡ºç°æ•…éšœï¼Œå¯¼è‡´å¡é¡¿ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯æŒ‰ç…§æœ€å¤§å“åº”æ—¶é—´ï¼ˆRTï¼‰è¿›è¡Œåˆ¤å®šï¼Œå¦‚æœä¸€æ¬¡è¯·æ±‚çš„å¤„ç†æ—¶é—´è¶…è¿‡äº†æŒ‡å®šçš„RTï¼Œé‚£ä¹ˆå°±è¢«åˆ¤å®šä¸º<code>æ…¢è°ƒç”¨</code>ï¼Œåœ¨ä¸€ä¸ªç»Ÿè®¡æ—¶é•¿å†…ï¼Œå¦‚æœè¯·æ±‚æ•°ç›®å¤§äºæœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”è¢«åˆ¤å®šä¸º<code>æ…¢è°ƒç”¨</code>çš„è¯·æ±‚æ¯”ä¾‹å·²ç»è¶…è¿‡é˜ˆå€¼ï¼Œå°†è§¦å‘ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿ä¹‹åï¼Œå°†ä¼šè¿›å…¥åˆ°åŠå¼€çŠ¶æ€è¿›è¡Œè¯•æ¢ï¼ˆè¿™é‡Œå’ŒHystrixä¸€è‡´ï¼‰</p>
<p>ç„¶åä¿®æ”¹ä¸€ä¸‹æ¥å£çš„æ‰§è¡Œï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹æ…¢è°ƒç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow2/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">findUserBorrows2</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">1000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>é‡å¯ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç†”æ–­è§„åˆ™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/ExWIKFSNpPoksiT.png" alt="image-20230306232632385" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¶…æ—¶ç›´æ¥è§¦å‘äº†ç†”æ–­ï¼Œè¿›å…¥åˆ°é˜»æ­¢é¡µé¢ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/CmdPgcqvX4a2u9p.png" alt="image-20230306232642387" />
    
  </figure>

</p>
</li>
<li>
<p><strong>å¼‚å¸¸æ¯”ä¾‹ï¼š</strong> è¿™ä¸ªä¸æ…¢è°ƒç”¨æ¯”ä¾‹ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œåˆ¤æ–­çš„æ˜¯å‡ºç°å¼‚å¸¸çš„æ¬¡æ•°ï¼Œä¸ä¸Šé¢ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿæ¥è¿›è¡Œä¸€äº›å°æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow2/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">findUserBorrows2</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å¯åŠ¨æœåŠ¡å™¨ï¼Œæ¥ç€æ·»åŠ æˆ‘ä»¬çš„ç†”æ–­è§„åˆ™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Dz3EgG9eH4UXTkJ.png" alt="image-20230306232652092" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬è¿›è¡Œè®¿é—®ï¼Œä¼šå‘ç°åå°ç–¯ç‹‚æŠ¥é”™ï¼Œç„¶åå°±ç†”æ–­äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/jSp92ODTRhlxJsn.png" alt="image-20230306232702794" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/FfhalnZdS2ujm1t.png" alt="image-20230306232711467" />
    
  </figure>

</p>
</li>
<li>
<p><strong>å¼‚å¸¸æ•°ï¼š</strong> è¿™ä¸ªå’Œä¸Šé¢çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œåªè¦è¾¾åˆ°æŒ‡å®šçš„å¼‚å¸¸æ•°é‡ï¼Œå°±ç†”æ–­ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ç†”æ–­è§„åˆ™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/CugOUozGA6inB3R.png" alt="image-20230306232720801" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬å†æ¬¡ä¸æ–­è®¿é—®æ­¤æ¥å£ï¼Œå¯ä»¥å‘ç°ï¼Œæ•ˆæœè·Ÿä¹‹å‰å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯åˆ¤æ–­çš„ç­–ç•¥ç¨å¾®ä¸åŒç½¢äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/XC1VekDfainIpv6.png" alt="image-20230306232738961" />
    
  </figure>

</p>
</li>
</ol>
<p>é‚£ä¹ˆç†”æ–­è§„åˆ™å¦‚ä½•è®¾å®šæˆ‘ä»¬äº†è§£äº†ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è‡ªå®šä¹‰æœåŠ¡é™çº§å‘¢ï¼Ÿä¹‹å‰åœ¨ä½¿ç”¨Hystrixçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒSentinelä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>@SentinelResource</code>ä¸­é…ç½®<code>blockHandler</code>å‚æ•°ï¼ˆé‚£è¿™é‡Œè·Ÿå‰é¢é‚£ä¸ªæ–¹æ³•é™æµçš„é…ç½®ä¸æ˜¯ä¸€æ¯›ä¸€æ ·å—ï¼Ÿæ²¡é”™ï¼Œå› ä¸ºå¦‚æœæ·»åŠ äº†<code>@SentinelResource</code>æ³¨è§£ï¼Œé‚£ä¹ˆè¿™é‡Œä¼šè¿›è¡Œæ–¹æ³•çº§åˆ«ç»†ç²’åº¦çš„é™åˆ¶ï¼Œå’Œä¹‹å‰æ–¹æ³•çº§åˆ«é™æµä¸€æ ·ï¼Œä¼šåœ¨é™çº§ä¹‹åç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸æ·»åŠ åˆ™è¿”å›é»˜è®¤çš„é™æµé¡µé¢ï¼Œ<code>blockHandler</code>çš„ç›®çš„å°±æ˜¯å¤„ç†è¿™ç§Sentinelæœºåˆ¶ä¸Šçš„å¼‚å¸¸ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®å’Œä¹‹å‰çš„é™æµé…ç½®æ˜¯ä¸€ä¸ªé“ç†ï¼Œå› æ­¤ä¸‹é¢ç†”æ–­é…ç½®ä¹Ÿåº”è¯¥å¯¹<code>value</code>è‡ªå®šä¹‰åç§°çš„èµ„æºè¿›è¡Œé…ç½®ï¼Œæ‰èƒ½ä½œç”¨åˆ°æ­¤æ–¹æ³•ä¸Šï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow2/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;findUserBorrows2&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;test&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">findUserBorrows2</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(),</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å¯¹è¿›è¡Œç†”æ–­é…ç½®ï¼Œæ³¨æ„æ˜¯å¯¹æˆ‘ä»¬æ·»åŠ çš„<code>@SentinelResource</code>ä¸­æŒ‡å®šåç§°çš„<code>findUserBorrows2</code>è¿›è¡Œé…ç½®ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/QkofY5gzwSr6WGn.png" alt="image-20230306232759448" />
    
  </figure>

</p>
<p>OKï¼Œå¯ä»¥çœ‹åˆ°ç†”æ–­ä¹‹åï¼ŒæœåŠ¡é™çº§ä¹‹åçš„æ•ˆæœï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/5kLcAaT6wJgYXGx.png" alt="image-20230306232809712" />
    
  </figure>

</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•è®©Feignçš„ä¹Ÿæ”¯æŒSentinelï¼Œå‰é¢æˆ‘ä»¬ä½¿ç”¨Hystrixçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥å¯¹Feignçš„æ¯ä¸ªæ¥å£è°ƒç”¨å•ç‹¬è¿›è¡ŒæœåŠ¡é™çº§ï¼Œè€Œä½¿ç”¨Sentinelï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯æ”¯æŒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">feign</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>ä¹‹åçš„æ­¥éª¤å…¶å®å’Œä¹‹å‰æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œé¦–å…ˆåˆ›å»ºå®ç°ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserClientFallback</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserClient</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&#34;æˆ‘æ˜¯æ›¿ä»£æ–¹æ¡ˆ&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">user</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åç›´æ¥å¯åŠ¨å°±å¯ä»¥äº†ï¼Œä¸­é€”çš„æ—¶å€™æˆ‘ä»¬å§ç”¨æˆ·æœåŠ¡å…¨éƒ¨ä¸‹æ‰ï¼Œå¯ä»¥çœ‹åˆ°æ­£å¸¸ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/M2yZpJLfs1i9adC.png" alt="image-20230306232821953" />
    
  </figure>

</p>
<p>è¿™æ ·Feignçš„é…ç½®å°±OKäº†ï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„RestTemplateå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@SentinelRestTemplate</code>æ³¨è§£å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@LoadBalanced</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@SentinelRestTemplate</span><span class="p">(</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;handleException&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExceptionUtil</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">fallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;fallback&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallbackClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExceptionUtil</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w"> </span><span class="c1">//è¿™é‡ŒåŒæ ·å¯ä»¥è®¾å®šfallbackç­‰å‚æ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™é‡Œå°±ä¸å¤šåšèµ˜è¿°äº†ã€‚</p>
<hr>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/8OCeNap2Vy6X7WH.png" alt="image-20230306232833262" />
    
  </figure>

</p>


<h2 class="relative group">Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡ 
    <div id="seata%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#seata%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h2>
<p>é‡éš¾ç‚¹å†…å®¹ï¼Œå‘ä¹Ÿå¤šå¾—ç¦»è°±ï¼Œæœ€å¥½ä¿æŒè·ŸUPä¸€æ ·çš„ç‰ˆæœ¬ï¼Œ<strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong> <a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html"   target="_blank">
    https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p>
<p>åœ¨å‰é¢çš„é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ è¿‡äº‹åŠ¡ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„æ•°æ®åº“äº‹åŠ¡çš„ç‰¹æ€§å—ï¼Ÿ</p>
<ul>
<li><strong>åŸå­æ€§ï¼š</strong> ä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</li>
<li><strong>ä¸€è‡´æ€§ï¼š</strong> åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</li>
<li><strong>éš”ç¦»æ€§ï¼š</strong> æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»å·²æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</li>
<li><strong>æŒä¹…æ€§ï¼š</strong> äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li>
</ul>
<p>é‚£ä¹ˆå„ä½è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½å‡ºç°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸‹å•è´­ç‰©ï¼Œé‚£ä¹ˆæ•´ä¸ªæµç¨‹å¯èƒ½æ˜¯è¿™æ ·çš„ï¼šå…ˆè°ƒç”¨åº“å­˜æœåŠ¡å¯¹åº“å­˜è¿›è¡Œå‡æ‰£ -&gt; ç„¶åè®¢å•æœåŠ¡å¼€å§‹ä¸‹å• -&gt; æœ€åç”¨æˆ·è´¦æˆ·æœåŠ¡è¿›è¡Œæ‰£æ¬¾ï¼Œè™½ç„¶çœ‹ä¼¼æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¸€ä¸ªæµç¨‹ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰äº‹åŠ¡çš„åŠ æŒï¼Œå¾ˆæœ‰å¯èƒ½ä¼šç”±äºä¸­é€”å‡ºé”™ï¼Œæ¯”å¦‚æ•´ä¸ªæµç¨‹ä¸­è®¢å•æœåŠ¡å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åº“å­˜æ‰£äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªè®¢å•å¹¶æ²¡æœ‰ç”Ÿæˆï¼Œç”¨æˆ·ä¹Ÿæ²¡æœ‰ä»˜æ¬¾ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/AiEXC3wBflPxHGT.png" alt="image-20230306233055869" />
    
  </figure>

</p>
<p>ä¸Šé¢è¿™ç§æƒ…å†µæ—¶é—´å°±æ˜¯ä¸€ç§å¤šæœåŠ¡å¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ï¼ˆæ¯”è¾ƒå¸¸è§ï¼‰ï¼Œå› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¾—å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè®©è¿™æ•´ä¸ªæµç¨‹ä¿è¯åŸå­æ€§ã€‚</p>
<p>SpringCloud Alibabaä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ç»„ä»¶Seataã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/jDAy7osQ5YIqruP.png" alt="image-20230306233108567" />
    
  </figure>

</p>
<p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å®é™…ä¸Šï¼Œå°±æ˜¯å¤šäº†ä¸€ä¸ªä¸­é—´äººæ¥åè°ƒæ‰€æœ‰æœåŠ¡çš„äº‹åŠ¡ã€‚</p>


<h3 class="relative group">é¡¹ç›®ç¯å¢ƒæ­å»º 
    <div id="%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>è¿™é‡Œæˆ‘ä»¬å¯¹æˆ‘ä»¬ä¹‹å‰çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿè¿›è¡Œå‡çº§ï¼š</p>
<ul>
<li>æ¯ä¸ªç”¨æˆ·æœ€å¤šåªèƒ½åŒæ—¶å€Ÿé˜…2æœ¬ä¸åŒçš„ä¹¦ã€‚</li>
<li>å›¾ä¹¦é¦†ä¸­æ‰€æœ‰çš„ä¹¦éƒ½æœ‰3æœ¬ã€‚</li>
<li>ç”¨æˆ·å€Ÿä¹¦æµç¨‹ï¼šå…ˆè°ƒç”¨å›¾ä¹¦æœåŠ¡ä¹¦ç±æ•°é‡-1 -&gt;  æ·»åŠ å€Ÿé˜…è®°å½•  -&gt;  è°ƒç”¨ç”¨æˆ·æœåŠ¡ç”¨æˆ·å¯å€Ÿé˜…æ•°é‡-1</li>
</ul>
<p>é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œä¸ºäº†ç®€ä¾¿ï¼Œå°±ç›´æ¥åœ¨ç”¨æˆ·è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µç”¨äºå­˜å‚¨ç”¨æˆ·èƒ½å¤Ÿå€Ÿé˜…çš„ä¹¦ç±æ•°é‡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/TvJL2PiWFU4XoaZ.png" alt="image-20230306232857302" />
    
  </figure>

</p>
<p>ç„¶åä¿®æ”¹ä¹¦ç±ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ç›´æ¥æ·»åŠ ä¸€ä¸ªå­—æ®µç”¨äºè®°å½•å‰©ä½™æ•°é‡ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/WjEcGbtkNrZi1CL.png" alt="image-20230306232904202" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬å»ç¼–å†™ä¸€ä¸‹å¯¹åº”çš„æœåŠ¡å§ï¼Œé¦–å…ˆæ˜¯ç”¨æˆ·æœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Mapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserMapper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select * from DB_USER where uid = #{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select book_count from DB_USER where uid = #{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getUserBookRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Update</span><span class="p">(</span><span class="s">&#34;update DB_USER set book_count = #{count} where uid = #{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">updateBookCount</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getUserBookRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">setRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">updateBookCount</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findUserById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/remain/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">userRemain</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/borrow/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">userBorrow</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">remain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">setRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">remain</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åæ˜¯å›¾ä¹¦æœåŠ¡ï¼Œå…¶å®è·Ÿç”¨æˆ·æœåŠ¡å·®ä¸å¤šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Mapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookMapper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select * from DB_BOOK where bid = #{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Book</span><span class="w"> </span><span class="nf">getBookById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select count from DB_BOOK  where bid = #{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Update</span><span class="p">(</span><span class="s">&#34;update DB_BOOK set count = #{count}  where bid = #{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">setRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BookMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="nf">getBookById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">setRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">setRemain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getRemain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getRemain</span><span class="p">(</span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BookService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Book</span><span class="w"> </span><span class="nf">findBookById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/remain/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">bookRemain</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/borrow/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">bookBorrow</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">remain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">setRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">remain</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æœ€åå®Œå–„æˆ‘ä»¬çš„å€Ÿé˜…æœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;userservice&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/borrow/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">userBorrow</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/user/remain/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">userRemain</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;bookservice&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Book</span><span class="w"> </span><span class="nf">getBookById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/borrow/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">bookBorrow</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/book/remain/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">bookRemain</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BorrowService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow/{uid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">findUserBorrows</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getUserBorrowDetailByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/borrow/take/{uid}/{bid}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">JSONObject</span><span class="w"> </span><span class="nf">borrow</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;uid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;bid&#34;</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">service</span><span class="p">.</span><span class="na">doBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">bid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">JSONObject</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSONObject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;code&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;200&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;success&#34;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;message&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;å€Ÿé˜…æˆåŠŸï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">object</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BorrowServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BorrowService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BorrowMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserClient</span><span class="w"> </span><span class="n">userClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BookClient</span><span class="w"> </span><span class="n">bookClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="w"> </span><span class="nf">getUserBorrowDetailByUid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Borrow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrowsByUid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userClient</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borrow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bookClient</span><span class="p">.</span><span class="na">getBookById</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">getBid</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserBorrowDetail</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">bookList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">doBorrow</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c1">//1. åˆ¤æ–­å›¾ä¹¦å’Œç”¨æˆ·æ˜¯å¦éƒ½æ”¯æŒå€Ÿé˜…</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">bookClient</span><span class="p">.</span><span class="na">bookRemain</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;å›¾ä¹¦æ•°é‡ä¸è¶³&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">userClient</span><span class="p">.</span><span class="na">userRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c1">//2. é¦–å…ˆå°†å›¾ä¹¦çš„æ•°é‡-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">bookClient</span><span class="p">.</span><span class="na">bookBorrow</span><span class="p">(</span><span class="n">bid</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c1">//3. æ·»åŠ å€Ÿé˜…ä¿¡æ¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;æ­¤ä¹¦ç±å·²ç»è¢«æ­¤ç”¨æˆ·å€Ÿé˜…äº†ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">addBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å½•å…¥å€Ÿé˜…ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c1">//4. ç”¨æˆ·å¯å€Ÿé˜…-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">userClient</span><span class="p">.</span><span class="na">userBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å€Ÿé˜…æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      	</span><span class="c1">//å®Œæˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·ï¼Œåªè¦æˆ‘ä»¬çš„å›¾ä¹¦å€Ÿé˜…è¿‡ç¨‹ä¸­ä»»ä½•ä¸€æ­¥å‡ºç°é—®é¢˜ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/MPkZb1dA2Khjcty.png" alt="image-20230306233138135" />
    
  </figure>

</p>
<p>å†æ¬¡å°è¯•å€Ÿé˜…ï¼Œåå°ä¼šç›´æ¥æŠ¥é”™ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/H43Fy9z76LIvJGd.png" alt="image-20230306233147990" />
    
  </figure>

</p>
<p>æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå€Ÿé˜…ä¿¡æ¯æ·»åŠ å¤±è´¥äº†ï¼Œä½†æ˜¯å›¾ä¹¦çš„æ•°é‡ä¾ç„¶è¢«-1ï¼Œä¹Ÿå°±æ˜¯è¯´æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›ä¸­é€”å‡ºç°å¼‚å¸¸ä¹‹åï¼Œä¹‹å‰çš„æ“ä½œå…¨éƒ¨å›æ»šçš„ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/l9D8aXBxkvnZejw.png" alt="image-20230306233201664" />
    
  </figure>

</p>
<p>è€Œè¿™é‡Œç”±äºæ˜¯åœ¨å¦ä¸€ä¸ªæœåŠ¡ä¸­è¿›è¡Œçš„æ•°æ®åº“æ“ä½œï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„<code>@Transactional</code>æ³¨è§£æ— æ•ˆï¼Œè¿™æ—¶å°±å¾—å€ŸåŠ©Seataæä¾›åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p>


<h3 class="relative group">åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ 
    <div id="%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>è¦å¼€å§‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬å¾—å…ˆä»ç†è®ºä¸Šå¼€å§‹ä¸‹æ‰‹ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<ol>
<li>
<p><strong>XAåˆ†å¸ƒå¼äº‹åŠ¡åè®® - 2PCï¼ˆä¸¤é˜¶æ®µæäº¤å®ç°ï¼‰</strong></p>
<p>è¿™é‡Œçš„PCå®é™…ä¸ŠæŒ‡çš„æ˜¯Prepareå’ŒCommitï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å‡†å¤‡ä¸€ä¸ªæ˜¯æäº¤ï¼Œæ•´ä¸ªè¿‡ç¨‹çš„å‚ä¸è€…ä¸€å…±æœ‰ä¸¤ä¸ªè§’è‰²ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡çš„æ‰§è¡Œè€…ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡çš„åè°ƒè€…ï¼Œå®é™…ä¸Šæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„è¿ä½œéƒ½éœ€è¦ä¾é åè°ƒè€…æ¥ç»´æŒï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/BWiUzFrjHAao1kJ.png" alt="image-20230306233211675" />
    
  </figure>

</p>
<p>åœ¨å‡†å¤‡å’Œæäº¤é˜¶æ®µï¼Œä¼šè¿›è¡Œï¼š</p>
<ul>
<li>
<p><strong>å‡†å¤‡é˜¶æ®µï¼š</strong></p>
<p>ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ç”±åè°ƒè€…æ¥å¼€å¯çš„ï¼Œé¦–å…ˆåè°ƒè€…ä¼šå‘æ‰€æœ‰çš„äº‹åŠ¡æ‰§è¡Œè€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œç­‰å¾…æ‰€æœ‰çš„äº‹åŠ¡æ‰§è¡Œè€…ç­”å¤ã€‚</p>
<p>å„ä¸ªäº‹åŠ¡æ‰§è¡Œè€…å¼€å§‹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œä½†æ˜¯ä¸è¿›è¡Œæäº¤ï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚</p>
<p>å¦‚æœäº‹åŠ¡æ‰§è¡Œè€…æ‰§è¡Œäº‹åŠ¡æˆåŠŸï¼Œé‚£ä¹ˆå°±å‘Šè¯‰åè°ƒè€…æˆåŠŸYesï¼Œå¦åˆ™å‘Šè¯‰åè°ƒè€…å¤±è´¥Noï¼Œä¸èƒ½æäº¤äº‹åŠ¡ã€‚</p>
</li>
<li>
<p><strong>æäº¤é˜¶æ®µï¼š</strong></p>
<p>å½“æ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½åé¦ˆå®Œæˆä¹‹åï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚</p>
<p>åè°ƒè€…ä¼šæ£€æŸ¥å„ä¸ªæ‰§è¡Œè€…çš„åé¦ˆå†…å®¹ï¼Œå¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½è¿”å›æˆåŠŸï¼Œé‚£ä¹ˆå°±å‘Šè¯‰æ‰€æœ‰çš„æ‰§è¡Œè€…å¯ä»¥æäº¤äº‹åŠ¡äº†ï¼Œæœ€åå†é‡Šæ”¾é”èµ„æºã€‚</p>
<p>å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªæ‰§è¡Œè€…è¿”å›å¤±è´¥æˆ–æ˜¯è¶…æ—¶ï¼Œé‚£ä¹ˆå°±è®©æ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½å›æ»šï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚</p>
</li>
</ul>
<p>è™½ç„¶è¿™ç§æ–¹å¼çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>äº‹åŠ¡åè°ƒè€…æ˜¯éå¸¸æ ¸å¿ƒçš„è§’è‰²ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå°†å¯¼è‡´æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</li>
<li>å¦‚æœæäº¤é˜¶æ®µå‘ç”Ÿç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´æŸäº›äº‹åŠ¡æ‰§è¡Œè€…æ²¡æœ‰æ”¶åˆ°åè°ƒè€…å‘æ¥çš„æäº¤å‘½ä»¤ï¼Œå°†å¯¼è‡´æŸäº›æ‰§è¡Œè€…æäº¤æŸäº›æ‰§è¡Œè€…æ²¡æäº¤ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</li>
</ul>
</li>
<li>
<p><strong>XAåˆ†å¸ƒå¼äº‹åŠ¡åè®® - 3PCï¼ˆä¸‰é˜¶æ®µæäº¤å®ç°ï¼‰</strong></p>
<p>ä¸‰é˜¶æ®µæäº¤æ˜¯åœ¨äºŒé˜¶æ®µæäº¤åŸºç¡€ä¸Šçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯åŠ å…¥äº†è¶…æ—¶æœºåˆ¶ï¼ŒåŒæ—¶åœ¨åè°ƒè€…å’Œæ‰§è¡Œè€…ä¸­éƒ½å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ã€‚</p>
<p>ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«è¿›è¡Œï¼š</p>
<ul>
<li>
<p><strong>CanCommité˜¶æ®µï¼š</strong></p>
<p>åè°ƒè€…å‘æ‰§è¡Œè€…å‘é€CanCommitè¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œç„¶åå¼€å§‹ç­‰å¾…æ‰§è¡Œè€…çš„å“åº”ã€‚</p>
<p>æ‰§è¡Œè€…æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™è¿”å›Yeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™è¿”å›No</p>
</li>
<li>
<p><strong>PreCommité˜¶æ®µï¼š</strong></p>
<p>åè°ƒè€…æ ¹æ®æ‰§è¡Œè€…çš„ååº”æƒ…å†µæ¥å†³å®šæ˜¯å¦å¯ä»¥è¿›å…¥ç¬¬äºŒé˜¶æ®µäº‹åŠ¡çš„PreCommitæ“ä½œã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½è¿”å›Yesï¼Œåˆ™åè°ƒè€…å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€PreCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥Preparedé˜¶æ®µï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å›æˆåŠŸå“åº”ã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…è‡³å°‘æœ‰ä¸€ä¸ªè¿”å›Noï¼Œåˆ™åè°ƒè€…å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€abortè¯·æ±‚ï¼Œæ‰€æœ‰çš„æ‰§è¡Œè€…åœ¨æ”¶åˆ°è¯·æ±‚æˆ–æ˜¯è¶…è¿‡ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥ä¸­æ–­äº‹åŠ¡ã€‚</p>
</li>
<li>
<p><strong>DoCommité˜¶æ®µï¼š</strong></p>
<p>è¯¥é˜¶æ®µè¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ã€‚</p>
<p>åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰æ‰§è¡Œè€…å‘é€çš„æˆåŠŸå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»PreCommitçŠ¶æ€è¿›å…¥åˆ°DoCommitçŠ¶æ€ï¼Œå¹¶å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€doCommitè¯·æ±‚ï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åï¼Œå¼€å§‹æ‰§è¡Œäº‹åŠ¡æäº¤ï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºï¼Œå¹¶æœ€åå‘åè°ƒè€…å‘é€ç¡®è®¤å“åº”ï¼Œåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰æ‰§è¡Œè€…çš„ç¡®è®¤å“åº”ä¹‹åï¼Œå®Œæˆäº‹åŠ¡ï¼ˆå¦‚æœå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´æ‰§è¡Œè€…æ²¡æœ‰æ”¶åˆ°doCommitè¯·æ±‚ï¼Œæ‰§è¡Œè€…ä¼šåœ¨è¶…æ—¶ä¹‹åç›´æ¥æäº¤äº‹åŠ¡ï¼Œè™½ç„¶æ‰§è¡Œè€…åªæ˜¯çŒœæµ‹åè°ƒè€…è¿”å›çš„æ˜¯doCommitè¯·æ±‚ï¼Œä½†æ˜¯å› ä¸ºå‰é¢çš„ä¸¤ä¸ªæµç¨‹éƒ½æ­£å¸¸æ‰§è¡Œï¼Œæ‰€ä»¥èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šè®¤ä¸ºæœ¬æ¬¡äº‹åŠ¡æ˜¯æˆåŠŸçš„ï¼Œå› æ­¤ä¼šç›´æ¥æäº¤ï¼‰</p>
<p>åè°ƒè€…æ²¡æœ‰æ¥æ”¶è‡³å°‘ä¸€ä¸ªæ‰§è¡Œè€…å‘é€çš„æˆåŠŸå“åº”ï¼ˆä¹Ÿå¯èƒ½æ˜¯å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ï¼Œåè°ƒè€…ä¼šå‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€abortè¯·æ±‚ï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åï¼Œåˆ©ç”¨å…¶åœ¨PreCommité˜¶æ®µè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºï¼Œæ‰§è¡Œè€…å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œ åè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…åé¦ˆçš„ç¡®è®¤æ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</p>
</li>
</ul>
<p>ç›¸æ¯”ä¸¤é˜¶æ®µæäº¤ï¼Œä¸‰é˜¶æ®µæäº¤çš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p>
<ul>
<li>3PCåœ¨2PCçš„ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µä¸­æ’å…¥ä¸€ä¸ªå‡†å¤‡é˜¶æ®µï¼Œä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰å„å‚ä¸èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚</li>
<li>ä¸€æ—¦å‚ä¸è€…æ— æ³•åŠæ—¶æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ä¿¡æ¯ä¹‹åï¼Œä¼šé»˜è®¤æ‰§è¡ŒCommitï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºåè°ƒè€…å•æ–¹é¢çš„æ•…éšœå¯¼è‡´å…¨å±€å‡ºç°é—®é¢˜ã€‚</li>
<li>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå®é™…ä¸Šè¶…æ—¶ä¹‹åçš„Commitå†³ç­–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªèµŒæ³¨ç½¢äº†ï¼Œå¦‚æœæ­¤æ—¶åè°ƒè€…å‘é€çš„æ˜¯abortè¯·æ±‚ä½†æ˜¯è¶…æ—¶æœªæ¥æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥å¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>TCCï¼ˆè¡¥å¿äº‹åŠ¡ï¼‰</strong></p>
<p>è¡¥å¿äº‹åŠ¡TCCå°±æ˜¯Tryã€Confirmã€Cancelï¼Œå®ƒå¯¹ä¸šåŠ¡æœ‰ä¾µå…¥æ€§ï¼Œä¸€å…±åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥è§£è¯»ä¸€ä¸‹ã€‚</p>
<ul>
<li>
<p><strong>Tryé˜¶æ®µï¼š</strong></p>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨å€Ÿä¹¦æ—¶ï¼Œå°†ä¹¦ç±çš„åº“å­˜<code>-1</code>ï¼Œå¹¶ä¸”ç”¨æˆ·çš„å€Ÿé˜…é‡ä¹Ÿ<code>-1</code>ï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œï¼Œé™¤äº†ç›´æ¥å¯¹åº“å­˜å’Œå€Ÿé˜…é‡è¿›è¡Œä¿®æ”¹ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†å‡å»çš„å€¼ï¼Œå•ç‹¬å­˜æ”¾åˆ°å†»ç»“è¡¨ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä¸ä¼šåˆ›å»ºå€Ÿé˜…ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæ˜¯é¢„å…ˆæŠŠå…³é”®çš„ä¸œè¥¿ç»™å¤„ç†äº†ï¼Œé¢„ç•™ä¸šåŠ¡èµ„æºå‡ºæ¥ã€‚</p>
</li>
<li>
<p><strong>Confirmé˜¶æ®µï¼š</strong></p>
<p>å¦‚æœTryæ‰§è¡ŒæˆåŠŸæ— è¯¯ï¼Œé‚£ä¹ˆå°±è¿›å…¥åˆ°Confirmé˜¶æ®µï¼Œæ¥ç€ä¹‹å‰ï¼Œæˆ‘ä»¬å°±è¯¥åˆ›å»ºå€Ÿé˜…ä¿¡æ¯äº†ï¼Œåªèƒ½ä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œå¦‚æœåˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆå°±å¯¹Tryé˜¶æ®µå†»ç»“çš„å€¼ï¼Œè¿›è¡Œè§£å†»ï¼Œæ•´ä¸ªæµç¨‹å°±å®Œæˆäº†ã€‚å½“ç„¶ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œé‚£ä¹ˆè¿›å…¥åˆ°Cancelé˜¶æ®µã€‚</p>
</li>
<li>
<p><strong>Cancelé˜¶æ®µï¼š</strong></p>
<p>ä¸ç”¨çŒœäº†ï¼Œé‚£è‚¯å®šæ˜¯æŠŠå†»ç»“çš„ä¸œè¥¿è¿˜ç»™äººå®¶ï¼Œå› ä¸ºæ•´ä¸ªå€Ÿé˜…æ“ä½œå‹æ ¹å°±æ²¡æˆåŠŸã€‚å°±åƒä½ ä»˜äº†æ¬¾ä¹°äº†ä¸œè¥¿ä½†æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´äº¤æ˜“å¤±è´¥ï¼Œé’±ä¸å¯èƒ½ä¸è¿˜ç»™ä½ å§ã€‚</p>
</li>
</ul>
<p>è·ŸXAåè®®ç›¸æ¯”ï¼ŒTCCå°±æ²¡æœ‰åè°ƒè€…è¿™ä¸€è§’è‰²çš„å‚ä¸äº†ï¼Œè€Œæ˜¯è‡ªä¸»é€šè¿‡ä¸Šä¸€é˜¶æ®µçš„æ‰§è¡Œæƒ…å†µæ¥ç¡®ä¿æ­£å¸¸ï¼Œå……åˆ†åˆ©ç”¨äº†é›†ç¾¤çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ‰å¾ˆå¤§çš„æå‡ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®ƒä¸ä¸šåŠ¡å…·æœ‰ä¸€å®šçš„å…³è”æ€§ï¼Œéœ€è¦å¼€å‘è€…å»ç¼–å†™æ›´å¤šçš„è¡¥å¿ä»£ç ï¼ŒåŒæ—¶å¹¶ä¸ä¸€å®šæ‰€æœ‰çš„ä¸šåŠ¡æµç¨‹éƒ½é€‚ç”¨äºè¿™ç§å½¢å¼ã€‚</p>
</li>
</ol>


<h3 class="relative group">Seataæœºåˆ¶ç®€ä»‹ 
    <div id="seata%E6%9C%BA%E5%88%B6%E7%AE%80%E4%BB%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#seata%E6%9C%BA%E5%88%B6%E7%AE%80%E4%BB%8B" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬äº†è§£äº†ä¸€äº›åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Seataæ˜¯å¦‚ä½•è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†çš„ã€‚</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/LsUq3AvrfhQJPCz.png" alt="image-20230306233227905" />
    
  </figure>

</p>
<p>å®˜ç½‘ç»™å‡ºçš„æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¶æ„å›¾ï¼Œé‚£ä¹ˆå›¾ä¸­çš„RMã€TMã€TCä»£è¡¨ç€ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<ul>
<li>RMï¼ˆResource Managerï¼‰ï¼šç”¨äºç›´æ¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚</li>
<li>TMï¼ˆTransaction Managerï¼‰ï¼šTMæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒç®¡ç†è€…ã€‚æ¯”å¦‚ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨å€Ÿé˜…æœåŠ¡ä¸­å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œæ¥è®©å…¶è‡ªèº«ã€å›¾ä¹¦æœåŠ¡ã€ç”¨æˆ·æœåŠ¡éƒ½å‚ä¸è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€èˆ¬å…¨å±€äº‹åŠ¡å‘èµ·è€…å°±æ˜¯TMã€‚</li>
<li>TCï¼ˆTransaction Managerï¼‰è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„SeataæœåŠ¡å™¨ï¼Œç”¨äºå…¨å±€æ§åˆ¶ï¼Œæ¯”å¦‚åœ¨XAæ¨¡å¼ä¸‹å°±æ˜¯ä¸€ä¸ªåè°ƒè€…çš„è§’è‰²ï¼Œè€Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„å¯åŠ¨å°±æ˜¯ç”±TMå‘TCå‘èµ·è¯·æ±‚ï¼ŒTCå†æ¥ä¸å…¶ä»–çš„RMè¿›è¡Œåè°ƒæ“ä½œã€‚</li>
</ul>
<blockquote>
<p>TMè¯·æ±‚TCå¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼ŒTCä¼šç”Ÿæˆä¸€ä¸ªXIDä½œä¸ºè¯¥å…¨å±€äº‹åŠ¡çš„ç¼–å·ï¼ŒXIDä¼šåœ¨å¾®æœåŠ¡çš„è°ƒç”¨é“¾è·¯ä¸­ä¼ æ’­ï¼Œä¿è¯å°†å¤šä¸ªå¾®æœåŠ¡çš„å­äº‹åŠ¡å…³è”åœ¨ä¸€èµ·ï¼›RMè¯·æ±‚TCå°†æœ¬åœ°äº‹åŠ¡æ³¨å†Œä¸ºå…¨å±€äº‹åŠ¡çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé€šè¿‡å…¨å±€äº‹åŠ¡çš„XIDè¿›è¡Œå…³è”ï¼›TMè¯·æ±‚TCå‘Šè¯‰XIDå¯¹åº”çš„å…¨å±€äº‹åŠ¡æ˜¯è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šï¼›TCé©±åŠ¨RMå°†XIDå¯¹åº”çš„è‡ªå·±çš„æœ¬åœ°äº‹åŠ¡è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šï¼›</p>
</blockquote>
<p>Seataæ”¯æŒ4ç§äº‹åŠ¡æ¨¡å¼ï¼Œå®˜ç½‘æ–‡æ¡£ï¼šhttps://seata.io/zh-cn/docs/overview/what-is-seata.html</p>
<ul>
<li>
<p>ATï¼šæœ¬è´¨ä¸Šå°±æ˜¯2PCçš„å‡çº§ç‰ˆï¼Œåœ¨ AT æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åªéœ€å…³å¿ƒè‡ªå·±çš„ â€œä¸šåŠ¡SQLâ€</p>
<ol>
<li>ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œç„¶åæ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</li>
<li>äºŒé˜¶æ®µå¦‚æœç¡®è®¤æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ æ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ï¼Œå½“ç„¶å¦‚æœéœ€è¦å›æ»šï¼Œé‚£ä¹ˆå°±ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</li>
</ol>
</li>
<li>
<p>TCCï¼šå’Œæˆ‘ä»¬ä¸Šé¢è®²è§£çš„æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li>
<p>XAï¼šåŒä¸Šï¼Œä½†æ˜¯è¦æ±‚æ•°æ®åº“æœ¬èº«æ”¯æŒè¿™ç§æ¨¡å¼æ‰å¯ä»¥ã€‚</p>
</li>
<li>
<p>Sagaï¼šç”¨äºå¤„ç†é•¿äº‹åŠ¡ï¼Œæ¯ä¸ªæ‰§è¡Œè€…éœ€è¦å®ç°äº‹åŠ¡çš„æ­£å‘æ“ä½œå’Œè¡¥å¿æ“ä½œï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/vLTZFS4yn26uabA.png" alt="image-20230306233328901" />
    
  </figure>

</p>
</li>
</ul>
<p>é‚£ä¹ˆï¼Œä»¥ATæ¨¡å¼ä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¦‚ä½•æ‰èƒ½åšåˆ°ä¸å¯¹ä¸šåŠ¡è¿›è¡Œä¾µå…¥çš„æƒ…å†µä¸‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿå®é™…ä¸Šï¼ŒSeataå®¢æˆ·ç«¯ï¼Œæ˜¯é€šè¿‡å¯¹æ•°æ®æºè¿›è¡Œä»£ç†å®ç°çš„ï¼Œä½¿ç”¨çš„æ˜¯DataSourceProxyç±»ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿™è¾¹ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å¯¹åº”çš„ä»£ç†ç±»æ³¨å†Œä¸ºBeanå³å¯ï¼ˆ0.9ç‰ˆæœ¬ä¹‹åæ”¯æŒè‡ªåŠ¨è¿›è¡Œä»£ç†ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œï¼‰</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥ATæ¨¡å¼ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p>


<h3 class="relative group">ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½² 
    <div id="%E4%BD%BF%E7%94%A8file%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%BD%BF%E7%94%A8file%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>Seataä¹Ÿæ˜¯ä»¥æœåŠ¡ç«¯å½¢å¼è¿›è¡Œéƒ¨ç½²çš„ï¼Œç„¶åæ¯ä¸ªæœåŠ¡éƒ½æ˜¯å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¸‹è½½åœ°å€ï¼šhttps://github.com/seata/seata/releases/download/v1.4.2/seata-server-1.4.2.zip</p>
<p>æŠŠæºç ä¹Ÿä¸‹è½½ä¸€ä¸‹ï¼šhttps://github.com/seata/seata/archive/refs/heads/develop.zip</p>
<p>ä¸‹è½½å®Œæˆä¹‹åï¼Œæ”¾å…¥åˆ°IDEAé¡¹ç›®ç›®å½•ä¸­ï¼Œæ·»åŠ å¯åŠ¨é…ç½®ï¼Œè¿™é‡Œç«¯å£ä½¿ç”¨8868ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/ykH1BSPcxlvY4on.png" alt="image-20230306233336803" />
    
  </figure>

</p>
<p>SeataæœåŠ¡ç«¯æ”¯æŒæœ¬åœ°éƒ¨ç½²æˆ–æ˜¯åŸºäºæ³¨å†Œå‘ç°ä¸­å¿ƒéƒ¨ç½²ï¼ˆæ¯”å¦‚Nacosã€Eurekaç­‰ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹æœ€ç®€å•çš„æœ¬åœ°éƒ¨ç½²ï¼Œä¸éœ€è¦å¯¹Seataçš„é…ç½®æ–‡ä»¶åšä»»ä½•ä¿®æ”¹ã€‚</p>
<p>Seataå­˜åœ¨ç€äº‹åŠ¡åˆ†ç»„æœºåˆ¶ï¼š</p>
<ul>
<li>äº‹åŠ¡åˆ†ç»„ï¼šseataçš„èµ„æºé€»è¾‘ï¼Œå¯ä»¥æŒ‰å¾®æœåŠ¡çš„éœ€è¦ï¼Œåœ¨åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰å¯¹è‡ªè¡Œå®šä¹‰äº‹åŠ¡åˆ†ç»„ï¼Œæ¯ç»„å–ä¸€ä¸ªåå­—ã€‚</li>
<li>é›†ç¾¤ï¼šseata-serveræœåŠ¡ç«¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤clusterã€‚ åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šäº‹åŠ¡é€»è¾‘åˆ†ç»„ä¸SeataæœåŠ¡ç«¯é›†ç¾¤ï¼ˆé»˜è®¤ä¸ºdefaultï¼‰çš„æ˜ å°„å…³ç³»ã€‚</li>
</ul>
<p>ä¸ºå•¥è¦è®¾è®¡æˆé€šè¿‡äº‹åŠ¡åˆ†ç»„å†ç›´æ¥æ˜ å°„åˆ°é›†ç¾¤ï¼Ÿå¹²å˜›ä¸ç›´æ¥æŒ‡å®šé›†ç¾¤å‘¢ï¼Ÿè·å–äº‹åŠ¡åˆ†ç»„åˆ°æ˜ å°„é›†ç¾¤çš„é…ç½®ã€‚è¿™æ ·è®¾è®¡åï¼Œäº‹åŠ¡åˆ†ç»„å¯ä»¥ä½œä¸ºèµ„æºçš„é€»è¾‘éš”ç¦»å•ä½ï¼Œå‡ºç°æŸé›†ç¾¤æ•…éšœæ—¶å¯ä»¥å¿«é€Ÿfailoverï¼Œåªåˆ‡æ¢å¯¹åº”åˆ†ç»„ï¼Œå¯ä»¥æŠŠæ•…éšœç¼©å‡åˆ°æœåŠ¡çº§åˆ«ï¼Œä½†å‰æä¹Ÿæ˜¯ä½ æœ‰è¶³å¤Ÿserveré›†ç¾¤ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„å„ä¸ªæœåŠ¡ä½œä¸ºSeateçš„å®¢æˆ·ç«¯ï¼Œåªéœ€è¦å¯¼å…¥ä¾èµ–å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-seata<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ç„¶åæ·»åŠ é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">seata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">vgroup-mapping</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c"># è¿™é‡Œéœ€è¦å¯¹äº‹åŠ¡ç»„åšæ˜ å°„ï¼Œé»˜è®¤çš„åˆ†ç»„åä¸º åº”ç”¨åç§°-seata-service-groupï¼Œå°†å…¶æ˜ å°„åˆ°defaulté›†ç¾¤</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c"># è¿™ä¸ªå¾ˆå…³é”®ï¼Œä¸€å®šè¦é…ç½®å¯¹ï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°æœåŠ¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bookservice-seata-service-group</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">grouplist</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8868</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·å°±å¯ä»¥ç›´æ¥å¯åŠ¨äº†ï¼Œä½†æ˜¯æ³¨æ„ç°åœ¨åªæ˜¯å•çº¯åœ°è¿æ¥ä¸Šï¼Œå¹¶æ²¡æœ‰å¼€å¯ä»»ä½•çš„åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥ç€æ¥é…ç½®å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé¦–å…ˆåœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼Œæ­¤æ³¨è§£ä¼šæ·»åŠ ä¸€ä¸ªåç½®å¤„ç†å™¨å°†æ•°æ®æºå°è£…ä¸ºæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ä»£ç†æ•°æ®æºï¼ˆè™½ç„¶å®˜æ–¹è¡¨ç¤ºé…ç½®æ–‡ä»¶ä¸­å·²ç»é»˜è®¤å¼€å¯äº†è‡ªåŠ¨ä»£ç†ï¼Œä½†æ˜¯UPä¸»å®æµ‹1.4.2ç‰ˆæœ¬ä¸‹åªèƒ½æ‰“æ³¨è§£çš„æ–¹å¼æ‰èƒ½ç”Ÿæ•ˆï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableAutoDataSourceProxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">BookApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ³•ä¸Šæ·»åŠ <code>@GlobalTransactional</code>æ³¨è§£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GlobalTransactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">doBorrow</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c1">//è¿™é‡Œæ‰“å°ä¸€ä¸‹XIDçœ‹çœ‹ï¼Œå…¶ä»–çš„æœåŠ¡ä¸šæ·»åŠ è¿™æ ·ä¸€ä¸ªæ‰“å°ï¼Œå¦‚æœä¸€ä¼šéƒ½æ‰“å°çš„æ˜¯åŒä¸€ä¸ªXIDï¼Œè¡¨ç¤ºä½¿ç”¨çš„å°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">RootContext</span><span class="p">.</span><span class="na">getXID</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bookClient</span><span class="p">.</span><span class="na">bookRemain</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;å›¾ä¹¦æ•°é‡ä¸è¶³&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">userClient</span><span class="p">.</span><span class="na">userRemain</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">bookClient</span><span class="p">.</span><span class="na">bookBorrow</span><span class="p">(</span><span class="n">bid</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">getBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;æ­¤ä¹¦ç±å·²ç»è¢«æ­¤ç”¨æˆ·å€Ÿé˜…äº†ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">addBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">bid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å½•å…¥å€Ÿé˜…ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">userClient</span><span class="p">.</span><span class="na">userBorrow</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;åœ¨å€Ÿé˜…æ—¶å‡ºç°é”™è¯¯ï¼&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿˜æ²¡ç»“æŸï¼Œæˆ‘ä»¬å‰é¢è¯´äº†ï¼ŒSeataä¼šåˆ†æä¿®æ”¹æ•°æ®çš„sqlï¼ŒåŒæ—¶ç”Ÿæˆå¯¹åº”çš„åå‘å›æ»šSQLï¼Œè¿™ä¸ªå›æ»šè®°å½•ä¼šå­˜æ”¾åœ¨undo_log è¡¨ä¸­ã€‚æ‰€ä»¥è¦æ±‚æ¯ä¸€ä¸ªClient éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„undo_logè¡¨ï¼ˆä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæœåŠ¡è¿æ¥çš„æ•°æ®åº“éƒ½éœ€è¦åˆ›å»ºè¿™æ ·ä¸€ä¸ªè¡¨ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬ä¸‰ä¸ªæœåŠ¡éƒ½ç”¨çš„åŒä¸€ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥è¯´å°±åªç”¨åœ¨è¿™ä¸ªæ•°æ®åº“ä¸­åˆ›å»ºundo_logè¡¨å³å¯ï¼‰ï¼Œè¡¨SQLå®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">undo_log</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w">            </span><span class="nb">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w">   </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="w">     </span><span class="nb">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w">   </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w">           </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">context</span><span class="o">`</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">rollback_info</span><span class="o">`</span><span class="w"> </span><span class="n">LONGBLOB</span><span class="w">     </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">log_status</span><span class="o">`</span><span class="w">    </span><span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">log_created</span><span class="o">`</span><span class="w">   </span><span class="n">DATETIME</span><span class="w">     </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">log_modified</span><span class="o">`</span><span class="w">  </span><span class="n">DATETIME</span><span class="w">     </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">ext</span><span class="o">`</span><span class="w">           </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">ux_undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥å¯åŠ¨ä¸‰ä¸ªæœåŠ¡äº†ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å½“å‡ºç°å¼‚å¸¸çš„æ—¶å€™æ˜¯ä¸æ˜¯ä¼šæ­£å¸¸å›æ»šï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/NIe9QFW3jf1DdnV.png" alt="image-20230306233351571" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/LwcdO2HuWAhFr5p.png" alt="image-20230306233359914" />
    
  </figure>

</p>
<p>é¦–å…ˆç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯æ­£å¸¸å®Œæˆå€Ÿé˜…æ“ä½œçš„ï¼Œæ¥ç€æˆ‘ä»¬å†æ¬¡è¿›è¡Œè¯·æ±‚ï¼Œè‚¯å®šä¼šå‡ºç°å¼‚å¸¸ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/6VOfsp9UxYJzgKD.png" alt="image-20230306233408870" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/yEQa2qeiNc5npV9.png" alt="image-20230306233417576" />
    
  </figure>

</p>
<p>å¦‚æœèƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°seataç›¸å…³çš„åŒ…ï¼Œé‚£ä¹ˆè¯´æ˜åˆ†å¸ƒå¼äº‹åŠ¡å·²ç»å¼€å§‹å·¥ä½œäº†ï¼Œé€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°äº†å›æ»šæ“ä½œï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/VtBlx4U1TzcqKra.png" alt="image-20230306233428386" />
    
  </figure>

</p>
<p>å¹¶ä¸”æ•°æ®åº“ä¸­ç¡®å®æ˜¯å›æ»šäº†æ‰£é™¤æ“ä½œï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/WXn9UPgxBVhdHmb.png" alt="image-20230306233436382" />
    
  </figure>

</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡Seataç®€å•åœ°å®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>


<h3 class="relative group">ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½² 
    <div id="%E4%BD%BF%E7%94%A8nacos%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%BD%BF%E7%94%A8nacos%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2" aria-label="é”šç‚¹">#</a>
    </span>        
    
</h3>
<p>å‰é¢æˆ‘ä»¬å®ç°äº†æœ¬åœ°SeataæœåŠ¡çš„fileæ¨¡å¼éƒ¨ç½²ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è®©å…¶é…åˆNacosè¿›è¡Œéƒ¨ç½²ï¼Œåˆ©ç”¨Nacosçš„é…ç½®ç®¡ç†å’ŒæœåŠ¡å‘ç°æœºåˆ¶ï¼ŒSeataèƒ½å¤Ÿæ›´å¥½åœ°å·¥ä½œã€‚</p>
<p>æˆ‘ä»¬å…ˆå•ç‹¬ä¸ºSeataé…ç½®ä¸€ä¸ªå‘½åç©ºé—´ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/93mXN5dlC2GTLOW.png" alt="image-20230306233444767" />
    
  </figure>

</p>
<p>æˆ‘ä»¬æ‰“å¼€<code>conf</code>ç›®å½•ä¸­çš„<code>registry.conf</code>é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">registry</span> <span class="s">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># æ³¨å†Œé…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥é€‰æ‹©ç±»å‹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ™®é€šçš„fileç±»å‹ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°æ–‡ä»¶çš„å½¢å¼è¿›è¡Œæ³¨å†Œé…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># æ”¯æŒçš„ç±»å‹å¦‚ä¸‹ï¼Œå¯¹åº”çš„ç±»å‹åœ¨ä¸‹é¢éƒ½æœ‰å¯¹åº”çš„é…ç½®</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span>
</span></span><span class="line"><span class="cl">  <span class="na">type</span> <span class="o">=</span> <span class="s">&#34;nacos&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1"># é‡‡ç”¨nacosæ–¹å¼ä¼šå°†seataæœåŠ¡ç«¯ä¹Ÿæ³¨å†Œåˆ°nacosä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥åˆ©ç”¨æœåŠ¡å‘ç°è‡ªåŠ¨æ‰¾åˆ°seataæœåŠ¡</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># å°±ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šIPå’Œç«¯å£äº†ï¼Œä¸è¿‡çœ‹ä¼¼æ–¹ä¾¿ï¼Œå‘å€’æ˜¯ä¸å°‘ï¼Œåé¢å†è¯´</span>
</span></span><span class="line"><span class="cl">  <span class="na">nacos</span> <span class="s">{</span>
</span></span><span class="line"><span class="cl">  	<span class="c1"># åº”ç”¨åç§°ï¼Œè¿™é‡Œé»˜è®¤å°±è¡Œ</span>
</span></span><span class="line"><span class="cl">    <span class="na">application</span> <span class="o">=</span> <span class="s">&#34;seata-server&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NacosæœåŠ¡å™¨åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="na">serverAddr</span> <span class="o">=</span> <span class="s">&#34;localhost:8848&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿™é‡Œä½¿ç”¨çš„æ˜¯SEATA_GROUPç»„ï¼Œä¸€ä¼šæ³¨å†Œåˆ°Nacosä¸­å°±æ˜¯è¿™ä¸ªç»„</span>
</span></span><span class="line"><span class="cl">    <span class="na">group</span> <span class="o">=</span> <span class="s">&#34;SEATA_GROUP&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿™é‡Œå°±ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢å•ç‹¬ä¸ºseataé…ç½®çš„å‘½åç©ºé—´ï¼Œæ³¨æ„å¡«çš„æ˜¯ID</span>
</span></span><span class="line"><span class="cl">    <span class="na">namespace</span> <span class="o">=</span> <span class="s">&#34;89fc2145-4676-48b8-9edd-29e867879bcb&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># é›†ç¾¤åç§°ï¼Œè¿™é‡Œè¿˜æ˜¯ä½¿ç”¨default</span>
</span></span><span class="line"><span class="cl">    <span class="na">cluster</span> <span class="o">=</span> <span class="s">&#34;default&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Nacosçš„ç”¨æˆ·åå’Œå¯†ç </span>
</span></span><span class="line"><span class="cl">    <span class="na">username</span> <span class="o">=</span> <span class="s">&#34;nacos&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">password</span> <span class="o">=</span> <span class="s">&#34;nacos&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">  }</span>
</span></span><span class="line"><span class="cl">  	<span class="c1">#...</span>
</span></span></code></pre></div><p>æ³¨å†Œä¿¡æ¯é…ç½®å®Œæˆä¹‹åï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†é…ç½®æ–‡ä»¶ä¹Ÿæ”¾åˆ°Nacosä¸­ï¼Œè®©Nacosç®¡ç†é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹é…ç½®è¿›è¡Œçƒ­æ›´æ–°äº†ï¼Œä¸€æ—¦ç¯å¢ƒéœ€è¦å˜åŒ–ï¼Œåªéœ€è¦ç›´æ¥åœ¨Nacosä¸­ä¿®æ”¹å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">config</span> <span class="s">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># è¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨nacos</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># fileã€nacos ã€apolloã€zkã€consulã€etcd3</span>
</span></span><span class="line"><span class="cl">  <span class="na">type</span> <span class="o">=</span> <span class="s">&#34;nacos&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="na">nacos</span> <span class="s">{</span>
</span></span><span class="line"><span class="cl">  	<span class="c1"># è·Ÿä¸Šé¢ä¸€æ ·çš„é…æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="na">serverAddr</span> <span class="o">=</span> <span class="s">&#34;127.0.0.1:8848&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">namespace</span> <span class="o">=</span> <span class="s">&#34;89fc2145-4676-48b8-9edd-29e867879bcb&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">group</span> <span class="o">=</span> <span class="s">&#34;SEATA_GROUP&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">username</span> <span class="o">=</span> <span class="s">&#34;nacos&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">password</span> <span class="o">=</span> <span class="s">&#34;nacos&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿™ä¸ªä¸ç”¨æ”¹ï¼Œé»˜è®¤å°±è¡Œ</span>
</span></span><span class="line"><span class="cl">    <span class="na">dataId</span> <span class="o">=</span> <span class="s">&#34;seataServer.properties&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">  }</span>
</span></span></code></pre></div><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦å°†é…ç½®å¯¼å…¥åˆ°Nacosä¸­ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸€å¼€å§‹ä¸‹è½½çš„æºç <code>script/config-center/nacos</code>ç›®å½•ï¼Œè¿™æ˜¯å®˜æ–¹æä¾›çš„ä¸Šä¼ è„šæœ¬ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œå³å¯ï¼ˆwindowsä¸‹æ²¡å¯¹åº”çš„batå°±å¾ˆè›‹ç–¼ï¼Œå¯ä»¥ä½¿ç”¨gitå‘½ä»¤è¡Œæ¥è¿è¡Œä¸€ä¸‹ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå¯äº¤äº’çš„ç‰ˆæœ¬ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/1tPwBFn7u3ScCeY.png" alt="image-20230306233500474" />
    
  </figure>

</p>
<p>æŒ‰ç…§æç¤ºè¾“å…¥å°±å¯ä»¥äº†ï¼Œä¸è¾“å…¥å°±ä½¿ç”¨çš„é»˜è®¤å€¼ï¼Œä¸çŸ¥é“ä¸ºå•¥æœ€æ–°ç‰ˆæœ¬æœ‰å››ä¸ªå› ä¸ºå‚æ•°è¿‡é•¿è¿˜å¯¼å…¥å¤±è´¥äº†ï¼Œå°±ç¦»è°±ï¼Œä¸è¿‡ä¸å½±å“ã€‚</p>
<p>å¯¼å…¥æˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨å¯¹åº”çš„å‘½åç©ºé—´ä¸‹çœ‹åˆ°å¯¹åº”çš„é…ç½®ï¼ˆä¸ºå•¥éè¦ä¸€ä¸ªä¸€ä¸ªé…ç½®é¡¹å•ç‹¬æï¼Œå°±ä¸èƒ½å†™ä¸€èµ·å—ï¼‰ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/8yTQGZluYVe1cg2.png" alt="image-20230306233510973" />
    
  </figure>

</p>
<p>æ³¨æ„ï¼Œè¿˜æ²¡å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å¯¹åº”çš„äº‹åŠ¡ç»„æ˜ å°„é…ç½®ä¹Ÿæ·»åŠ ä¸Šï¼ŒDataIdæ ¼å¼ä¸º<code>service.vgroupMapping.äº‹åŠ¡ç»„åç§°</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬å°±ä½¿ç”¨é»˜è®¤çš„åç§°ï¼Œå€¼å…¨éƒ¨ä¾ç„¶ä½¿ç”¨defaultå³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/UBchb4zPjHAfCSs.png" alt="image-20230306233521002" />
    
  </figure>

</p>
<p>ç°åœ¨æˆ‘ä»¬å°±å®Œæˆäº†æœåŠ¡ç«¯çš„Nacosé…ç½®ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å¯¹å®¢æˆ·ç«¯ä¹Ÿè¿›è¡ŒNacosé…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">seata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c"># æ³¨å†Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">registry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="c"># ä½¿ç”¨Nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    	</span><span class="c"># ä½¿ç”¨Seataçš„å‘½åç©ºé—´ï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®æ‰¾åˆ°SeataæœåŠ¡ï¼Œç”±äºç»„ä½¿ç”¨çš„æ˜¯SEATA_GROUPï¼Œé…ç½®é»˜è®¤å€¼å°±æ˜¯ï¼Œå°±ä¸ç”¨é…äº†</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">89fc2145-4676-48b8-9edd-29e867879bcb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">89fc2145-4676-48b8-9edd-29e867879bcb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨è¿™ä¸‰ä¸ªæœåŠ¡äº†ï¼Œå¯ä»¥åœ¨Nacosä¸­çœ‹åˆ°Seataä»¥åŠä¸‰ä¸ªæœåŠ¡éƒ½æ­£å¸¸æ³¨å†Œäº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/PSbw5TFhm74Wu3n.png" alt="image-20230306233529255" />
    
  </figure>

</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/nZUcuM2kJ86zgBv.png" alt="image-20230306233538630" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥è®¿é—®ä¸€ä¸‹æœåŠ¡è¯•è¯•çœ‹äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Fn3R2Jrq1YyleCh.png" alt="image-20230306233545257" />
    
  </figure>

</p>
<p>å¯ä»¥çœ‹åˆ°æ•ˆæœå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬çš„æ³¨å†Œå’Œé…ç½®éƒ½ç»§æ‰¿åœ¨Nacosä¸­è¿›è¡Œäº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é…ç½®ä¸€ä¸‹äº‹åŠ¡ä¼šè¯ä¿¡æ¯çš„å­˜å‚¨æ–¹å¼ï¼Œé»˜è®¤æ˜¯fileç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿è¡Œç›®å½•ä¸‹åˆ›å»º<code>file_store</code>ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¬åˆ°æ•°æ®åº“ä¸­å­˜å‚¨ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®å³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/Cph9zPF2kaSvKdY.png" alt="image-20230306233553931" />
    
  </figure>

</p>
<p>å°†<code>store.session.mode</code>å’Œ<code>store.mode</code>çš„å€¼ä¿®æ”¹ä¸º<code>db</code></p>
<p>æ¥ç€æˆ‘ä»¬å¯¹æ•°æ®åº“ä¿¡æ¯è¿›è¡Œä¸€ä¸‹é…ç½®ï¼š</p>
<ul>
<li>æ•°æ®åº“é©±åŠ¨</li>
<li>æ•°æ®åº“URL</li>
<li>æ•°æ®åº“ç”¨æˆ·åå¯†ç </li>
</ul>
<p>å…¶ä»–çš„é»˜è®¤å³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/dlmYNnARZaxJ5MH.png" alt="image-20230306233612224" />
    
  </figure>

</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†å¯¹åº”çš„æ•°æ®åº“è¿›è¡Œåˆ›å»ºï¼Œåˆ›å»ºseataæ•°æ®åº“ï¼Œç„¶åç›´æ¥CVä»¥ä¸‹è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1">-- the table to store GlobalSession data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">global_table</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w">                       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w">            </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">status</span><span class="o">`</span><span class="w">                    </span><span class="n">TINYINT</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">application_id</span><span class="o">`</span><span class="w">            </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">transaction_service_group</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">transaction_name</span><span class="o">`</span><span class="w">          </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">timeout</span><span class="o">`</span><span class="w">                   </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">begin_time</span><span class="o">`</span><span class="w">                </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">application_data</span><span class="o">`</span><span class="w">          </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span><span class="w">                </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span><span class="w">              </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_status_gmt_modified</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">status</span><span class="o">`</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_transaction_id</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- the table to store BranchSession data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">branch_table</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="w">         </span><span class="nb">BIGINT</span><span class="w">       </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w">               </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w">    </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">resource_group_id</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">resource_id</span><span class="o">`</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">branch_type</span><span class="o">`</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">status</span><span class="o">`</span><span class="w">            </span><span class="n">TINYINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">client_id</span><span class="o">`</span><span class="w">         </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">application_data</span><span class="o">`</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span><span class="w">        </span><span class="n">DATETIME</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span><span class="w">      </span><span class="n">DATETIME</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_xid</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- the table to store lock data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">lock_table</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">row_key</span><span class="o">`</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w">            </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">transaction_id</span><span class="o">`</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="w">      </span><span class="nb">BIGINT</span><span class="w">       </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">resource_id</span><span class="o">`</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="k">table_name</span><span class="o">`</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">pk</span><span class="o">`</span><span class="w">             </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">status</span><span class="o">`</span><span class="w">         </span><span class="n">TINYINT</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;0:locked ,1:rollbacking&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span><span class="w">     </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span><span class="w">   </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">row_key</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_status</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">status</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_branch_id</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">distributed_lock</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">lock_key</span><span class="o">`</span><span class="w">       </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">lock_value</span><span class="o">`</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">expire</span><span class="o">`</span><span class="w">         </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">lock_key</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">distributed_lock</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="n">lock_key</span><span class="p">,</span><span class="w"> </span><span class="n">lock_value</span><span class="p">,</span><span class="w"> </span><span class="n">expire</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;HandleAllSession&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/7zvewSLhFmbc8G1.png" alt="image-20230306233627086" />
    
  </figure>

</p>
<p>å®Œæˆä¹‹åï¼Œé‡å¯SeataæœåŠ¡ç«¯å³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/G7qQoEy8DCX9bLJ.png" alt="image-20230306233752098" />
    
  </figure>

</p>
<p>çœ‹åˆ°äº†æ•°æ®æºåˆå§‹åŒ–æˆåŠŸï¼Œç°åœ¨å·²ç»åœ¨ä½¿ç”¨æ•°æ®åº“è¿›è¡Œä¼šè¯å­˜å‚¨äº†ã€‚</p>
<p>å¦‚æœSeataæœåŠ¡ç«¯å‡ºç°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰äº‹åŠ¡ç»„çš„åç§°å¤ªé•¿äº†ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/qoNhgzM2PXpZU9B.png" alt="image-20230306233933641" />
    
  </figure>

</p>
<p>å°†<code>globle_table</code>è¡¨çš„å­—æ®µ<code>transaction_server_group</code>é•¿åº¦é€‚å½“å¢åŠ ä¸€ä¸‹å³å¯ï¼š</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://s2.loli.net/2023/03/06/9LnaoUxHzlY1GdV.png" alt="image-20230306233940850" />
    
  </figure>

</p>
<p>åˆ°æ­¤ï¼Œå…³äºåŸºäºnacosæ¨¡å¼ä¸‹çš„Seataéƒ¨ç½²ï¼Œå°±å®Œæˆäº†ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬è¿™é‡Œå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æ˜¯ç»™å„ä½åŒå­¦æå‡ºä¸€ä¸ªé—®é¢˜ï¼ˆå¯ä»¥æŠŠè‡ªå·±æ‰€è®¤ä¸ºçš„ç»“æœæ‰“åœ¨å¼¹å¹•ä¸Šï¼‰ï¼Œå°±æˆ‘ä»¬ç›®å‰è¿™æ ·çš„ç¨‹åºè®¾è®¡ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ï¼ŒçœŸçš„å®‰å…¨å—ï¼Ÿæ¯”å¦‚åŒä¸€æ—¶é—´100ä¸ªåŒå­¦æŠ¢åŒä¸€ä¸ªä¹¦ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åŒä¸€ä¸ªä¹¦å°±åªæœ‰3æœ¬ï¼Œå¦‚æœè¿™æ—¶çœŸçš„åŒæ—¶æ¥äº†100ä¸ªè¯·æ±‚è¦å€Ÿä¹¦ï¼Œä¼šæ­£å¸¸åœ°åªå€Ÿå‡º3æœ¬ä¹¦å—ï¼Ÿå¦‚æœä¸æ­£å¸¸ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://www.itbaima.cn/document/35v1hbsfcdgagdnw</p>

            </div>
        </div>

        
        <script>
            var oid = "views_doc\\cloud\\ä¸‰\\index.md"
            var oid_likes = "likes_doc\\cloud\\ä¸‰\\index.md"
        </script>
        
        
        
        <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>

    </section>

    
    <footer style="width: 100%">
        
<details style="margin-left:0px" class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5">
    
    <summary
        class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">
        cloud - è¿™æ˜¯ç³»åˆ—æ–‡ç« ä¹‹ä¸€.
    </summary>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%B8%80/">
            éƒ¨åˆ† 1: SpringCloud 1
        </a>
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        éƒ¨åˆ† 2: æœ¬æ–‡
    </div>
    
    
    
    <div
        class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        <a href="//localhost:1313/doc/cloud/%E4%BA%8C/">
            éƒ¨åˆ† 3: SpringCloud 3
        </a>
    </div>
    
    


</details>

        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=//localhost:1313/doc/cloud/%E4%B8%89/&amp;text=SpringCloud%202"
      title="åˆ†äº«åˆ° Twitter"
      aria-label="åˆ†äº«åˆ° Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://t.me/share/url?url=//localhost:1313/doc/cloud/%E4%B8%89/&amp;resubmit=true&amp;title=SpringCloud%202"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=//localhost:1313/doc/cloud/%E4%B8%89/&amp;subject=SpringCloud%202"
      title="é€šè¿‡ç”µå­é‚®ä»¶å‘é€"
      aria-label="é€šè¿‡ç”µå­é‚®ä»¶å‘é€"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">ç›¸å…³æ–‡ç« </h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/doc/cloud/%E4%B8%80/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/doc/cloud/%E4%B8%80/featured_hu10698375666893419758.jpeg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/doc/cloud/%E4%B8%80/">SpringCloud 1</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">9 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>
  
  

  <a href="/doc/cloud/%E4%BA%8C/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/doc/cloud/%E4%BA%8C/featured_hu10698375666893419758.jpeg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/doc/cloud/%E4%BA%8C/">SpringCloud 3</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span title="é¢„è®¡é˜…è¯»">10 åˆ†é’Ÿ</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>
  
</section>


        
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/doc/cloud/%E4%BA%8C/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >SpringCloud 3</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/doc/cloud/%E4%B8%80/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >SpringCloud 1</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">1 January 0001</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


        
        
        <div class="pt-3">
            <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
            <div class="pt-3">
                















<br/>
<span style="color:rgba(var(--color-neutral-400),var(--tw-text-opacity));">
    <span class="post-meta-item-text" >&nbsp;&nbsp;:  </span>
    <span class="waline-pageview-count">â³</span><div></div><br/>
</span>






<script src='/waline/waline.js'></script>
<link href='/waline/waline.css' rel='stylesheet' />
<div id="vcomments"></div>
<script>
    if (""=="zh-CN") {
        Waline.init({
            el: '#vcomments',
            serverURL: 'https://comment-eosin.vercel.app/',
            emoji: ['https://valine-emoji.bili33.top/bilibilitv','https://valine-emoji.bili33.top/bilibiliHotKey','https://valine-emoji.bili33.top/Tieba-New','https://valine-emoji.bili33.top/weibo',],
            meta:['nick', 'mail', 'link'],
            pageview: true,
            reaction: true,
            lang: "zh-CN",
            locale: {
                reactionTitle: 'â€¢ç•…æ‰€æ¬²è¨€â€”â€”è¿™é‡Œæ˜¯å¼€æ”¾åŒºâ€¢',
                comment: 'ç•™è¨€æ¿',
                placeholder: 'ç‚¹å‡»ä¸‹æ–¹ç™»å½•åå†è¯„è®ºï¼Œä¼šæœ‰æƒŠå–œå“¦~',
                gifSearchPlaceholder: 'æœç´¢è¡¨æƒ…åŒ…...',
                admin: 'ä½œè€…',
                sofa: 'è¿˜æ²¡æœ‰äººè¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§',
                anonymous: 'åŒ¿åè€…'
            }
        });

    }
    else {
        Waline.init({
            el: '#vcomments',
            serverURL: 'https://comment-eosin.vercel.app/',
            emoji: ['https://valine-emoji.bili33.top/bilibilitv','https://valine-emoji.bili33.top/bilibiliHotKey','https://valine-emoji.bili33.top/Tieba-New','https://valine-emoji.bili33.top/weibo',],
            meta:['nick', 'mail'],
            pageview: true,
            reaction: true,
            
            lang: "zh-CN",
            locale: {
                reactionTitle: 'â€¢ç•…æ‰€æ¬²è¨€â€”â€”è¿™é‡Œæ˜¯å¼€æ”¾åŒºâ€¢',
                comment: 'ç•™è¨€æ¿',
                placeholder: 'ç‚¹å‡»ä¸‹æ–¹ç™»å½•åå†è¯„è®ºï¼Œä¼šæœ‰æƒŠå–œå“¦~',
                gifSearchPlaceholder: 'æœç´¢è¡¨æƒ…åŒ…...',
                admin: 'ä½œè€…',
                sofa: 'è¿˜æ²¡æœ‰äººè¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§',
                anonymous: 'åŒ¿åè€…'
            }
    });

    }
    document.getElementsByClassName('wl-power')[0].style.display = 'none';
    document.querySelector(".wl-actions a").style.display = 'none'
</script>
<style type="text/css">
    :root{
        --waline-color: var(--tw-prose-quotes);
        --waline-info-color: var(--tw-prose-quotes);
        --waline-info-bgcolor: var(--tw-ring-color);
        --waline-theme-color: rgba(var(--color-primary-400));
        --waline-bgcolor: transparent;
        --waline-border-color: #747474;
    }
    .wl-editor:focus, .wl-input:focus {
        background: transparent;
    }
    .wl-editor,.wl-input{
        max-width:88%;
    }
    .wl-reaction-item.active .wl-reaction-votes {
        color: white;
    }
</style>

<script type="text/javascript">
    var pagect = document.getElementById('pagec');
    var observer = new MutationObserver(function(){
        var itl,itll;
        var element = document.getElementById("pagec");
        observer.disconnect();
        itl  = element.innerText;
        itll = Number(itl).toLocaleString();
        document.getElementById('pagec').innerHTML = itll;
    });
    var article = document.getElementById('pagec');

    var options = {
        'childList': true,
        'subtree': true
    };

    observer.observe(article, options);
</script>

            </div>
        </div>
        
        
    </footer>

</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="å›åˆ°é¡¶éƒ¨" title="å›åˆ°é¡¶éƒ¨">
    &uarr;
  </a>
</div>
    </main>

<div class="busuanzi-footer" style="margin-top: 40px">
  <span id="busuanzi_container_site_pv">
    æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
  </span>
  <span id="busuanzi_container_site_uv">
    æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
  </span>
</div><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/tags/"
            title="">ç³»åˆ—æ–‡ç« </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/tasks/"
            title="">äº‹é¡¹</a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/info/"
            title="">å…³äºæˆ‘</a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/doc/"
            title="">æ–‡æ¡£</a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œ
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      ç”± <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> å¼ºåŠ›é©±åŠ¨
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="//localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="æœç´¢"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="å…³é—­ (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
